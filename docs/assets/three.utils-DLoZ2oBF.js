var V=Object.defineProperty;var J=(m,e,i)=>e in m?V(m,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[e]=i;var n=(m,e,i)=>(J(m,typeof e!="symbol"?e+"":e,i),i);import{h as E,W as K,e as Q,d as X,w as Y,j as k,l as R,O as Z,M as r,B as h}from"./OrbitControls-BG2Z3rzr.js";import"./index-Dhyqi1wC.js";function $(m="-"){if(!crypto&&crypto.randomUUID)return crypto.randomUUID();{const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",i=[];for(let p=0;p<3;p++){const u=[];for(let l=0;l<4;l++)u.push(e[Math.floor(Math.random()*52)]);i.push(u.join(""))}const c=(Date.now()+"").slice(-5)+m+(Math.random()+"").slice(-5);return i.join(m)+m+c}}const d=class d{constructor(e,i={animation:d.STATICFUNCTION}){n(this,"state",d.STATIC);n(this,"id",$());this.model=e,this.options=i,this.animation=i.animation,this.animation!==d.STATICFUNCTION&&(this.state=d.ANIMATION)}addAnimation(e){this.animation=e,this.state=d.ANIMATION}removeAnimation(){this.animation=d.STATICFUNCTION,this.state=d.STATIC}stop(){this.state=d.STATIC}play(){this.state=d.ANIMATION}update(){this.state==d.ANIMATION&&this.animation()}};n(d,"ANIMATION","animation"),n(d,"STATIC","static"),n(d,"STATICFUNCTION",()=>{});let U=d;class _{constructor(){n(this,"models",[]);n(this,"animationGroup",[]);this.update()}update(){requestAnimationFrame(this.update.bind(this)),this.models.forEach(e=>{e.animation&&e.update()})}createModel(e,i={}){this.models.push(new U(e,{animation:i.animation})),this.scene.add(e)}removeModel(e){this.models=this.models.filter(i=>i.id!=e.id),this.scene.remove(e),this.removeAnimation(e.id)}addAnimation(e,i){this.animationGroup.push({id:e,fun:i})}removeAnimation(e){this.animationGroup=this.animationGroup.filter(i=>i.id!=e)}}class nt extends _{constructor(i,c={}){super();n(this,"canvas",null);n(this,"renderer",null);n(this,"scene",null);n(this,"camera",null);n(this,"width",0);n(this,"height",0);n(this,"actions",[]);n(this,"orbitControls",null);n(this,"updateActionState",!1);n(this,"test",!1);n(this,"canvasSizeSet",()=>({width:window.innerWidth,height:window.innerHeight}));this.canvas=i,this.options=c,this.canvasSizeSet=this.options.canvasSizeSet||this.canvasSizeSet,this.updateAction()}init(){const i=this.canvas;if(!i&&i.tagName!=="CANVAS")throw new Error("Game:没有找到canvas");this.createScene(),this.updateSize()}addOrbitControls(i,c){c&&i?this.orbitControls=new E(i,c):this.orbitControls=new E(this.camera,this.renderer.domElement)}updateSize(){const{width:i,height:c}=this.canvasSizeSet();this.renderer.setSize(i,c),this.camera.aspect=i/c,this.camera.updateProjectionMatrix(),window.addEventListener("resize",()=>{if(this.canvasSizeSet){const{width:p,height:u}=this.canvasSizeSet();this.renderer.setSize(p,u),this.camera.aspect=p/u,this.camera.updateProjectionMatrix()}})}createScene(){const i=new K({canvas:this.canvas}),c=new Q,{width:p,height:u}=this.canvasSizeSet(),l=new X(75,p/u,.1,1e4);l.position.x=-4,l.position.y=2,l.position.z=5,c.add(l),this.renderer=i,this.scene=c,this.camera=l,this.camera.updateProjectionMatrix()}addAction(i){i instanceof Function&&this.actions.push(i)}updateAction(){}update(){const{renderer:i,scene:c,camera:p,models:u}=this;i&&c&&p&&(i.render(c,p),this.actions.forEach(l=>{l.bind(this)()})),this.update&&requestAnimationFrame(this.update.bind(this))}clear(){try{this.renderer.clear()}catch{}this.updateActionState=!1,this.updateAction=null,this.update=null,this.actions=null,this.scene=null,this.camera=null,this.renderer=null,this.models=null,this.orbitControls=null,this.canvas=null,this.canvasSizeSet=null,this.createScene=null,this.addAction=null,this.updateAction=null,this.createRoom=null}createRoom(i={box:{width:10,height:10,length:10,thickness:1,pillar:1},material:null,pillarMaterial:null,position:{x:0,y:0,z:0}}){const{width:c,height:p,length:u,thickness:l,pillar:t}=i.box||{width:10,height:15,length:10,thickness:1,pillar:1},{x:q,y:B,z:L}=i.position||{x:0,y:0,z:0},H=new Y(Math.random()*.5+.5,Math.random()*.5+.5,Math.random()*.5+.5);let I=i.material||new k({color:H,side:R,wireframe:!1});const S=new Z,s=c,a=p,o=u,f=new r(new h(s-t,o-t,l),I);f.rotation.x=Math.PI/2,f.position.y=-a/2;const A=new r(new h(s-t,o-t,l),I);A.rotation.x=-Math.PI/2,A.position.y=a/2;const T=new r(new h(s-t,a-t,l),I);T.position.z=o/2;const z=new r(new h(s-t,a-t,l),I);z.position.z=-o/2;const M=new r(new h(o-t,a-t,l),I);M.rotation.y=Math.PI/2,M.position.x=-s/2;const v=new r(new h(o-t,a-t,l),I);v.rotation.y=-Math.PI/2,v.position.x=s/2;const w=i.pillarMaterial||I||new k({color:16777215,side:R}),j=new r(new h(t,a+t,t),w),F=new r(new h(t,a+t,t),w),G=new r(new h(t,a+t,t),w),W=new r(new h(t,a+t,t),w);j.position.set(s/2,0,o/2),F.position.set(-s/2,0,o/2),G.position.set(s/2,0,-o/2),W.position.set(-s/2,0,-o/2),S.add(j,F,G,W);const x=new r(new h(t,s-t,t),w),C=new r(new h(t,s-t,t),w),N=new r(new h(t,s-t,t),w),b=new r(new h(t,s-t,t),w);x.position.set(0,a/2,o/2),x.rotation.z=Math.PI/2,C.position.set(0,-a/2,o/2),C.rotation.z=Math.PI/2,N.position.set(0,a/2,-o/2),N.rotation.z=Math.PI/2,b.position.set(0,-a/2,-o/2),b.rotation.z=Math.PI/2,S.add(x,C,N,b);const g=new r(new h(t,o-t,t),w),P=new r(new h(t,o-t,t),w),y=new r(new h(t,o-t,t),w),O=new r(new h(t,o-t,t),w);return g.position.set(-s/2,a/2,0),g.rotation.x=Math.PI/2,P.position.set(s/2,a/2,0),P.rotation.x=Math.PI/2,y.position.set(-s/2,-a/2,0),y.rotation.x=Math.PI/2,O.position.set(s/2,-a/2,0),O.rotation.x=Math.PI/2,S.add(g,P,y,O),S.add(f,A,T,z,M,v),this.test&&S.remove(A),this.createModel(S),S.position.set(q,B,L),S.traverse(D=>{D.castShadow=!0,D.receiveShadow=!0}),{obj:S,bottom:f,top:A,left:T,right:z,before:M,after:v}}}export{nt as W};
