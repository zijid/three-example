import{r as p,j as v}from"./index--S1ByAj9.js";import{A as N,B as V,j as q,M as I,Q as O,E as Q,b as J}from"./OrbitControls-T7DR67G2.js";import{W as K}from"./three.utils-1hpgBcPy.js";function U({onChange:b=()=>{}}){const S=p.useRef(null);return p.useEffect(()=>{const n=S.current,k=[];if(n){let w=function(){R.splice(0)},m=function(e,o){R.push({x:e,y:o})},h=function(){t.beginPath(),R.forEach(({x:e,y:o})=>{t.beginPath(),t.arc(e,o,5,0,2*Math.PI),t.stroke()})},c=function(e){return typeof e=="number"},l=function(){i={start:{x:null,y:null},end:{x:null,y:null}}},g=function(){if(t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,window.innerWidth,window.innerHeight),t.fillStyle=d.bgColor,t.fillRect(0,0,n.width,n.height),t.setTransform(1,0,0,1,s.x,s.y),t.strokeStyle="red",t.setLineDash([]),t.lineWidth=1,t.beginPath(),j.forEach(({start:e,end:o})=>{t.moveTo(e.x,e.y),t.lineTo(o.x,o.y)}),c(i.start.x)&&c(i.start.y)&&c(i.end.x)&&c(i.end.y)){{const e=n.getBoundingClientRect();let o=E.clientX-e.x,r=E.clientY-e.y;const u=s.width,C=s.height;o=u-o,r=C-r;const a=-d.movePixel;o<100?s.x+=a:o>u-100&&(s.x-=a),r<100?s.y+=a:r>C-100&&(s.y-=a)}z(E),t.moveTo(i.start.x,i.start.y),t.lineTo(i.end.x,i.end.y)}t.stroke(),h(),F()},x=function(){requestAnimationFrame(x),g()},y=function(e){return Math.round((e-s.x)/d.interval)*d.interval},L=function(e){return Math.round((e-s.y)/d.interval)*d.interval},T=function(e,o){i.end.x=e,i.end.y=o},F=function(){const e=s.x%d.interval,o=s.y%d.interval;t.setTransform(1,0,0,1,e,o),t.strokeStyle="#00ffff",t.setLineDash([2,10,10,10]),t.lineWidth=.3;for(var r=d.interval,u=window.innerHeight/r+2,C=window.innerWidth/r+2,a=0;a<=u;a++)t.beginPath(),t.moveTo(-d.interval*2,a*r),t.lineTo(n.width+d.interval*2,a*r),t.stroke();for(var a=0;a<=C;a++)t.beginPath(),t.moveTo(a*r,-d.interval*2),t.lineTo(a*r,n.height+d.interval*2),t.stroke()},Y=function(){n.width=window.innerWidth,n.height=window.innerHeight,s.width=n.width,s.height=n.height};n.width=window.innerWidth,n.height=window.innerHeight;const t=n.getContext("2d"),d={bgColor:"#282828",isSetBgColor:!0,interval:50,movePixel:10,edgeMovement:!0,pointToGrid:!0,offset:10,point:!1},j=[],R=[];t.fillStyle="red",t.lineWidth=1,t.strokeStyle="red";let s={x:0,y:0,width:window.innerWidth,height:window.innerHeight};const E={clientX:null,clientY:null};let i={start:{x:null,y:null},end:{x:null,y:null}};x();let P=!1,W=!1,M={x:null,y:null};const A=e=>{const o=n.getBoundingClientRect(),r=y(e.clientX-o.x),u=L(e.clientY-o.y);M.x=r,M.y=u,B?W=!0:(P=!0,i.start.x=r,i.start.y=u,m(r,u))},H=e=>{W=!1,P=!1;const o=n.getBoundingClientRect(),r=y(e.clientX-o.x),u=L(e.clientY-o.y);!c(i.start.x)&&!c(i.start.y)||(T(r,u),i.start.x===i.end.x&&i.start.y===i.end.y||j.push(i),l(),w(),b(j))},z=e=>{const o=n.getBoundingClientRect();E.clientX=e.clientX,E.clientY=e.clientY;const r=y(e.clientX-o.x),u=L(e.clientY-o.y);if(W)s.x-=M.x-r,s.y-=M.y-u;else{if(!c(i.start.x)&&!c(i.start.y))return;T(r,u),P&&(w(),m(i.start.x,i.start.y),m(i.end.x,i.end.y))}};let B=!1;const D=e=>{e.code==="Space"&&(B=!0)},G=e=>{e.code==="Space"&&(B=!1)};n.addEventListener("mousedown",A),n.addEventListener("mouseup",H),n.addEventListener("mousemove",z),n.addEventListener("keydown",D),n.addEventListener("keyup",G),window.addEventListener("resize",Y),k.push(()=>{n.removeEventListener("mousedown",A),n.removeEventListener("mouseup",H),n.removeEventListener("mousemove",z),n.removeEventListener("keydown",D),n.removeEventListener("keyup",G),window.removeEventListener("resize",Y)})}return()=>{k.forEach(w=>w())}},[]),v.jsx("canvas",{ref:S,style:{display:"block",width:"100%",height:"100%"}})}let f,X,Z;function te(){const b=p.useRef(null),[S,n]=p.useState([]);p.useEffect(()=>{const h=b.current,c=[];if(h){const l=new K(h);l.init(),l.update(),l.updateSize(),l.addOrbitControls(),{scene:f,camera:X,renderer:Z}=l,X.position.set(0,0,-2e3);const g=new N(4210752,10);l.createModel(g),X.lookAt(0,0,0);const x=new V(1,1,1),y=new q({color:16711680});new I(x,y)}return()=>{c.forEach(l=>l())}},[]),f==null||f.children.forEach(h=>{h.type==="Mesh"&&f.remove(h)}),S.forEach(({start:h,end:c})=>{const l=new O;let g=window.innerWidth/2,x=window.innerHeight/2;l.moveTo(-h.x+g,-h.y+x),l.lineTo(-c.x+g,-c.y+x);const y={depth:100,bevelEnabled:!0,bevelSegments:2,steps:2,bevelSize:1,bevelThickness:1},L=new Q(l,y),T=new I(L,new J({color:"red"}));f==null||f.add(T),console.log("scene:",f)});function k(h){n(h)}const[w,m]=p.useState("画线");return v.jsxs(v.Fragment,{children:[v.jsxs("div",{className:"control",style:{position:"fixed",top:0,left:0,zIndex:2,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[v.jsx("button",{onClick:()=>m("画线"),children:"画线"}),v.jsx("button",{onClick:()=>m("渲染"),children:"渲染"})]}),v.jsx("canvas",{style:{display:"block",width:"100vw",height:"100vh"},ref:b}),v.jsx("div",{style:{display:w==="画线"?"block":"none",width:"100vw",height:"100vh",position:"absolute",top:0,left:0,zIndex:1},children:v.jsx(U,{onChange:k})})]})}export{te as default};
