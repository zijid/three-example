import{r as L,j as C}from"./index-Dhyqi1wC.js";import{W as I}from"./three.utils-DLoZ2oBF.js";import{f as j,B as k,j as w,M as f,A as G,k as A,O as R,C as T}from"./OrbitControls-BG2Z3rzr.js";import{W as O,V as c,b as V,B as y,M as q,R as D,C as Q,Q as U,c as z}from"./cannon-es-ByA38PEp.js";var P=new q("groundMaterial"),W=new q("wheelMaterial");const u=[],b=[];function K(r,o){const l=new R,m=1,g=2,d=4,M=.5,h=new f(new k(d,m,g),new w({color:255}));h.position.y=2,l.add(h);const B=new V(new c(d/2,m/2,g/2));var t=new y({mass:150});t.addShape(B),t.position.set(0,4,0),t.angularVelocity.set(0,.5,0);const e=new D({chassisBody:t}),a={radius:M,radius:.5,directionLocal:new c(0,-1,0),suspensionStiffness:30,suspensionRestLength:.3,frictionSlip:1.4,dampingRelaxation:2.3,dampingCompression:4.4,maxSuspensionForce:1e5,rollInfluence:.01,axleLocal:new c(0,0,1),chassisConnectionPointLocal:new c(-1,0,1),maxSuspensionTravel:.3,customSlidingRotationalSpeed:-30,useCustomSlidingRotationalSpeed:!0};a.chassisConnectionPointLocal.set(-1,0,1),e.addWheel(a),a.chassisConnectionPointLocal.set(-1,0,-1),e.addWheel(a),a.chassisConnectionPointLocal.set(1,0,1),e.addWheel(a),a.chassisConnectionPointLocal.set(1,0,-1),e.addWheel(a);const p=[];e.wheelInfos.forEach(n=>{const i=new Q(n.radius,n.radius,n.radius,5),s=new y({mass:0,material:W});s.type=y.KINEMATIC,s.collisionFilterGroup=0;const E=new U().setFromEuler(-Math.PI/2,0,0);s.addShape(i,new c,E);const v=new f(new T(n.radius,n.radius,n.radius,5,5),new w({color:16777215})),S=new R;v.rotation.x=Math.PI/2,S.add(v),o.add(S),b.push(s),p.push(S),u.push(S)}),r.defaultContactMaterial.friction=0;var F=window.wheelGroundContactMaterial=new z(W,P,{friction:.3,restitution:0,contactEquationStiffness:1e3});r.addContactMaterial(F),e.addToWorld(r),u.push(h),b.push(t),document.onkeydown=x,document.onkeyup=n=>{switch(n.key){case"w":case"ArrowUp":e.applyEngineForce(0,2),e.applyEngineForce(0,3);break;case"s":case"ArrowDown":e.applyEngineForce(0,2),e.applyEngineForce(0,3);break;case"a":case"ArrowLeft":e.setSteeringValue(0,0),e.setSteeringValue(0,1);break;case"d":case"ArrowRight":e.setSteeringValue(0,0),e.setSteeringValue(0,1);break;case"b":e.setBrake(0,0),e.setBrake(0,1),e.setBrake(0,2),e.setBrake(0,3);break}},r.addEventListener("postStep",()=>{for(let n=0;n<e.wheelInfos.length;n++){e.updateWheelTransform(n);const i=e.wheelInfos[n].worldTransform,s=p[n];s.position.copy(i.position),s.quaternion.copy(i.quaternion)}});function x(n){switch(n.key){case"w":case"ArrowUp":e.applyEngineForce(-1e3,2),e.applyEngineForce(-1e3,3);break;case"s":case"ArrowDown":e.applyEngineForce(1e3,2),e.applyEngineForce(1e3,3);break;case"a":case"ArrowLeft":e.setSteeringValue(.5,0),e.setSteeringValue(.5,1);break;case"d":case"ArrowRight":e.setSteeringValue(-.5,0),e.setSteeringValue(-.5,1);break;case"b":e.setBrake(1e6,0),e.setBrake(1e6,1),e.setBrake(1e6,2),e.setBrake(1e6,3);break}}return setInterval(()=>{for(let n=0;n<u.length;n++)u[n].position.copy(b[n].position),u[n].quaternion.copy(b[n].quaternion)}),l}function N(r){const o=new I(r);o.init(),o.update(),o.addOrbitControls();const l=new O({gravity:new c(0,-9.82,0)});o.addAction(()=>{l.fixedStep()}),o.renderer.shadowMap.enabled=!0,o.renderer.shadowMap.type=j;const m=new k(1,1,1),g=new w({color:16777215,shininess:0}),d=new f(m,g);d.castShadow=!0,d.position.y=.5,o.createModel(K(l,o.scene),{animation:()=>{d.rotation.x+=.01,d.rotation.y+=.01}});const M=1,h=1,B=1,t=new f(new k(1,1,1),new w({color:"red"}));t.position.z=-1.5,t.position.y=10.5;const e=new V(new c(M/2,h/2,B/2)),a=new y({mass:1,shape:e});a.position.copy(t.position),a.quaternion.copy(t.quaternion),l.addBody(a),o.createModel(t,{animation:()=>{t.position.copy(a.position),t.quaternion.copy(a.quaternion)}});const p=new f(new k(100,1,100),new w({color:16777215,shininess:0}));p.receiveShadow=!0,o.createModel(p);const F=new V(new c(50,.5,50)),x=new y({mass:0,shape:F,material:P});x.position.copy(p.position),l.addBody(x);const n=new G(6710886,1);o.scene.add(n);const i=new A(255,1,0);i.position.set(-2,2,0),i.castShadow=!0,o.createModel(i),o.scene.add(i);const s=new A(65535,1,0);s.position.set(2,2,0),o.createModel(s),o.scene.add(s)}function Y(){const r=L.useRef(null);return L.useEffect(()=>{r.current&&N(r.current)},[]),C.jsx(C.Fragment,{children:C.jsx("canvas",{style:{width:"100vw",height:"100vh",display:"block"},ref:r})})}export{Y as default};
