import{r as Uo,j as vn}from"./index-Dhyqi1wC.js";import{w as en,u as $e,V as W,aa as St,ab as Uc,Y as tn,ac as Ii,ad as Oi,ae as mo,af as kc,ag as Gc,ah as Wc,ai as Hc,i as Wn,aj as qc,ak as $c,al as jc,q as Xc,am as zi,an as fo,N as ko,ao as Yc,ap as Bs,aq as Di,ar as Pi,as as Zc,at as Kc,n as Jc,au as Hn,av as Fi,aw as Lt,ax as Go,ay as Qc,a5 as el,Z as tl,a6 as sl,a7 as nl,a8 as ol,H as il,$ as rl,M as ys,K as qn,a0 as yt,k as fs,D as al,g as go,A as cl,az as ll,aA as Bt,c as zs,aB as Bi,z as ul,b as dl,a as hl,j as Us,aC as $n,aD as pl,aE as ml,aF as fl,aG as Ui,aH as gl,aI as Wo,X as Nl,aJ as yl,aK as xl,J as Tl,G as vl,aL as Ho,aM as Sn,O as ki,aN as Sl,f as wl,aO as qo,B as $o,x as Vl}from"./OrbitControls-BG2Z3rzr.js";import{W as Al}from"./three.utils-DLoZ2oBF.js";const jo={VERTEX:"vertex",FRAGMENT:"fragment"},J={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},sn=["x","y","z","w"];function Gi(o,e=!1){let t="{";o.isNode===!0&&(t+=o.id);for(const{property:s,childNode:n}of ks(o))t+=","+s.slice(0,-4)+":"+n.getCacheKey(e);return t+="}",t}function*ks(o,e=!1){for(const t in o){if(t.startsWith("_")===!0)continue;const s=o[t];if(Array.isArray(s)===!0)for(let n=0;n<s.length;n++){const i=s[n];i&&(i.isNode===!0||e&&typeof i.toJSON=="function")&&(yield{property:t,index:n,childNode:i})}else if(s&&s.isNode===!0)yield{property:t,childNode:s};else if(typeof s=="object")for(const n in s){const i=s[n];i&&(i.isNode===!0||e&&typeof i.toJSON=="function")&&(yield{property:t,index:n,childNode:i})}}}function Tt(o){if(o==null)return null;const e=typeof o;return o.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":o.isVector2===!0?"vec2":o.isVector3===!0?"vec3":o.isVector4===!0?"vec4":o.isMatrix3===!0?"mat3":o.isMatrix4===!0?"mat4":o.isColor===!0?"color":o instanceof ArrayBuffer?"ArrayBuffer":null}function Wi(o,...e){const t=o?o.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),o==="color"?new en(...e):t==="vec2"?new $e(...e):t==="vec3"?new W(...e):t==="vec4"?new St(...e):t==="mat3"?new Uc(...e):t==="mat4"?new tn(...e):o==="bool"?e[0]||!1:o==="float"||o==="int"||o==="uint"?e[0]||0:o==="string"?e[0]||"":o==="ArrayBuffer"?qi(e[0]):null}function Hi(o){let e="";const t=new Uint8Array(o);for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function qi(o){return Uint8Array.from(atob(o),e=>e.charCodeAt(0)).buffer}const Xo=new Map;let _l=0;class P extends Ii{constructor(e=null){super(),this.nodeType=e,this.updateType=J.NONE,this.updateBeforeType=J.NONE,this.uuid=Oi.generateUUID(),this.version=0,this._cacheKey=null,this._cacheKeyVersion=0,this.isNode=!0,Object.defineProperty(this,"id",{value:_l++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,J.FRAME)}onRenderUpdate(e){return this.onUpdate(e,J.RENDER)}onObjectUpdate(e){return this.onUpdate(e,J.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return!1}*getChildren(){for(const{childNode:e}of ks(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=Gi(this,e),this._cacheKeyVersion=this.version),this._cacheKey}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);for(const s of this.getChildren())t["_node"+s.id]=s;return null}construct(e){return console.warn("THREE.Node: construct() is deprecated. Use setup() instead."),this.setup(e)}increaseUsage(e){const t=e.getDataFromNode(this);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}analyze(e){if(this.increaseUsage(e)===1){const s=e.getNodeProperties(this);for(const n of Object.values(s))n&&n.isNode===!0&&n.build(e)}}generate(e,t){const{outputNode:s}=e.getNodeProperties(this);if(s&&s.isNode===!0)return s.build(e,t)}updateBefore(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const s=this.getShared(e);if(this!==s)return s.build(e,t);e.addNode(this),e.addChain(this);let n=null;const i=e.getBuildStage();if(i==="setup"){this.updateReference(e);const r=e.getNodeProperties(this);if(r.initialized!==!0||e.context.tempRead===!1){const a=e.stack.nodes.length;r.initialized=!0,r.outputNode=this.setup(e),r.outputNode!==null&&e.stack.nodes.length!==a&&(r.outputNode=e.stack);for(const c of Object.values(r))c&&c.isNode===!0&&c.build(e)}}else if(i==="analyze")this.analyze(e);else if(i==="generate")if(this.generate.length===1){const a=this.getNodeType(e),c=e.getDataFromNode(this);n=c.snippet,n===void 0&&(n=this.generate(e)||"",c.snippet=n),n=e.format(n,a,t)}else n=this.generate(e,t)||"";return e.removeChain(this),n}getSerializeChildren(){return ks(this)}serialize(e){const t=this.getSerializeChildren(),s={};for(const{property:n,index:i,childNode:r}of t)i!==void 0?(s[n]===void 0&&(s[n]=Number.isInteger(i)?[]:{}),s[n][i]=r.toJSON(e.meta).uuid):s[n]=r.toJSON(e.meta).uuid;Object.keys(s).length>0&&(e.inputNodes=s)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const s in e.inputNodes)if(Array.isArray(e.inputNodes[s])){const n=[];for(const i of e.inputNodes[s])n.push(t[i]);this[s]=n}else if(typeof e.inputNodes[s]=="object"){const n={};for(const i in e.inputNodes[s]){const r=e.inputNodes[s][i];n[i]=t[r]}this[s]=n}else{const n=e.inputNodes[s];this[s]=t[n]}}}toJSON(e){const{uuid:t,type:s}=this,n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{},nodes:{}});let i=e.nodes[t];i===void 0&&(i={uuid:t,type:s,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},n!==!0&&(e.nodes[i.uuid]=i),this.serialize(i),delete i.meta);function r(a){const c=[];for(const l in a){const u=a[l];delete u.metadata,c.push(u)}return c}if(n){const a=r(e.textures),c=r(e.images),l=r(e.nodes);a.length>0&&(i.textures=a),c.length>0&&(i.images=c),l.length>0&&(i.nodes=l)}return i}}function A(o,e){if(typeof e!="function"||!o)throw new Error(`Node class ${o} is not a class`);if(Xo.has(o)){console.warn(`Redefinition of node class ${o}`);return}Xo.set(o,e),e.type=o}class ee extends P{constructor(e){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const n=e.getVectorType(this.getNodeType(e,t)),i=e.getDataFromNode(this);if(e.context.tempRead!==!1&&i.propertyName!==void 0)return e.format(i.propertyName,n,t);if(e.context.tempWrite!==!1&&n!=="void"&&t!=="void"&&this.hasDependencies(e)){const r=super.build(e,n),a=e.getVarFromNode(this,null,n),c=e.getPropertyName(a);return e.addLineFlowCode(`${c} = ${r}`),i.snippet=r,i.propertyName=c,e.format(i.propertyName,n,t)}}return super.build(e,t)}}A("TempNode",ee);class Qt extends P{constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getNodeType(e)}generate(e){const t=this.node.build(e),s=this.indexNode.build(e,"uint");return`${t}[ ${s} ]`}}A("ArrayElementNode",Qt);class No extends P{constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let s=null;for(const n of this.convertTo.split("|"))(s===null||e.getTypeLength(t)===e.getTypeLength(n))&&(s=n);return s}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const s=this.node,n=this.getNodeType(e),i=s.build(e,n);return e.format(i,n,t)}}A("ConvertNode",No);class $i extends ee{constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,s)=>t+e.getTypeLength(s.getNodeType(e)),0))}generate(e,t){const s=this.getNodeType(e),n=this.nodes,i=e.getComponentType(s),r=[];for(const c of n){let l=c.build(e);const u=e.getComponentType(c.getNodeType(e));u!==i&&(l=e.format(l,u,i)),r.push(l)}const a=`${e.getType(s)}( ${r.join(", ")} )`;return e.format(a,s,t)}}A("JoinNode",$i);const Ml=sn.join("");class jn extends P{constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(sn.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const s=this.node,n=e.getTypeLength(s.getNodeType(e));let i=null;if(n>1){let r=null;this.getVectorLength()>=n&&(r=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const c=s.build(e,r);this.components.length===n&&this.components===Ml.slice(0,this.components.length)?i=e.format(c,r,t):i=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else i=s.build(e,t);return i}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}A("SplitNode",jn);class ji extends ee{constructor(e,t,s){super(),this.sourceNode=e,this.components=t,this.targetNode=s}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:s,targetNode:n}=this,i=this.getNodeType(e),r=e.getTypeFromLength(s.length),a=n.build(e,r),c=t.build(e,i),l=e.getTypeLength(i),u=[];for(let d=0;d<l;d++){const m=sn[d];m===s[0]?(u.push(a),d+=s.length-1):u.push(c+"."+m)}return`${e.getType(i)}( ${u.join(", ")} )`}}A("SetNode",ji);class nn extends P{constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?Tt(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=Tt(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=Hi(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?Wi(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}A("InputNode",nn);class je extends nn{constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const s=this.getNodeType(e);return e.format(this.generateConst(e),s,t)}}A("ConstNode",je);let Zt=null;const Ut=new Map;function N(o,e){if(Ut.has(o)){console.warn(`Redefinition of node element ${o}`);return}if(typeof e!="function")throw new Error(`Node element ${o} is not a function`);Ut.set(o,e)}const Yo=o=>o.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),Xi={setup(o,e){const t=e.shift();return o(an(t),...e)},get(o,e,t){if(typeof e=="string"&&o[e]===void 0){if(o.isStackNode!==!0&&e==="assign")return(...s)=>(Zt.assign(t,...s),t);if(Ut.has(e)){const s=Ut.get(e);return o.isStackNode?(...n)=>t.add(s(...n)):(...n)=>s(t,...n)}else{if(e==="self")return o;if(e.endsWith("Assign")&&Ut.has(e.slice(0,e.length-6))){const s=Ut.get(e.slice(0,e.length-6));return o.isStackNode?(...n)=>t.assign(n[0],s(...n)):(...n)=>t.assign(s(t,...n))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=Yo(e),R(new jn(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=Yo(e.slice(3).toLowerCase()),e=e.split("").sort().join(""),s=>R(new ji(o,e,s));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),R(new jn(o,e));if(/^\d+$/.test(e)===!0)return R(new Qt(t,new je(Number(e),"uint")))}}}return Reflect.get(o,e,t)},set(o,e,t,s){return typeof e=="string"&&o[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(s[e].assign(t),!0):Reflect.set(o,e,t,s)}},wn=new WeakMap,Zo=new WeakMap,Rl=function(o,e=null){const t=Tt(o);if(t==="node"){let s=wn.get(o);return s===void 0&&(s=new Proxy(o,Xi),wn.set(o,s),wn.set(s,s)),s}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return R(Xn(o,e));if(t==="shader")return w(o)}return o},El=function(o,e=null){for(const t in o)o[t]=R(o[t],e);return o},Cl=function(o,e=null){const t=o.length;for(let s=0;s<t;s++)o[s]=R(o[s],e);return o},Ll=function(o,e=null,t=null,s=null){const n=i=>R(s!==null?Object.assign(i,s):i);return e===null?(...i)=>n(new o(...Ht(i))):t!==null?(t=R(t),(...i)=>n(new o(e,...Ht(i),t))):(...i)=>n(new o(e,...Ht(i)))},bl=function(o,...e){return R(new o(...Ht(e)))};class Il extends P{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){const{outputNode:t}=e.getNodeProperties(this);return t?t.getNodeType(e):super.getNodeType(e)}call(e){const{shaderNode:t,inputNodes:s}=this;if(t.layout){let r=Zo.get(e.constructor);r===void 0&&(r=new WeakMap,Zo.set(e.constructor,r));let a=r.get(t);return a===void 0&&(a=R(e.buildFunctionNode(t)),r.set(t,a)),e.currentFunctionNode!==null&&e.currentFunctionNode.includes.push(a),R(a.call(s))}const n=t.jsFunc,i=s!==null?n(s,e.stack,e):n(e.stack,e);return R(i)}setup(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){const{outputNode:s}=e.getNodeProperties(this);return s===null?this.call(e).build(e,t):super.generate(e,t)}}class Ol extends P{constructor(e){super(),this.jsFunc=e,this.layout=null}get isArrayInput(){return/^\((\s+)?\[/.test(this.jsFunc.toString())}setLayout(e){return this.layout=e,this}call(e=null){return an(e),R(new Il(this,e))}setup(){return this.call()}}const zl=[!1,!0],Dl=[0,1,2,3],Pl=[-1,-2],Yi=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],yo=new Map;for(const o of zl)yo.set(o,new je(o));const xo=new Map;for(const o of Dl)xo.set(o,new je(o,"uint"));const To=new Map([...xo].map(o=>new je(o.value,"int")));for(const o of Pl)To.set(o,new je(o,"int"));const on=new Map([...To].map(o=>new je(o.value)));for(const o of Yi)on.set(o,new je(o));for(const o of Yi)on.set(-o,new je(-o));const rn={bool:yo,uint:xo,ints:To,float:on},Ko=new Map([...yo,...on]),Xn=(o,e)=>Ko.has(o)?Ko.get(o):o.isNode===!0?o:new je(o,e),Fl=o=>{try{return o.getNodeType()}catch{return}},Z=function(o,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(o)&&t.every(n=>typeof n!="object"))&&(t=[Wi(o,...t)]),t.length===1&&e!==null&&e.has(t[0]))return R(e.get(t[0]));if(t.length===1){const n=Xn(t[0],o);return Fl(n)===o?R(n):R(new No(n,o))}const s=t.map(n=>Xn(n));return R(new $i(s,o))}},Jo=o=>o&&o.value,Bl=o=>o!=null?o.nodeType||o.convertTo||(typeof o=="string"?o:null):null;function gs(o){return new Proxy(new Ol(o),Xi)}const R=(o,e=null)=>Rl(o,e),an=(o,e=null)=>new El(o,e),Ht=(o,e=null)=>new Cl(o,e),T=(...o)=>new Ll(...o),_=(...o)=>new bl(...o),w=o=>{const e=new gs(o),t=(...s)=>{let n;return an(s),s[0]&&s[0].isNode?n=[...s]:n=s[0],e.call(n)};return t.shaderNode=e,t.setLayout=s=>(e.setLayout(s),t),t};A("ShaderNode",gs);const Qo=o=>{Zt=o},Ul=()=>Zt,H=(...o)=>Zt.if(...o);function kl(o){return Zt&&Zt.add(o),o}N("append",kl);const Gl=new Z("color"),h=new Z("float",rn.float),p=new Z("int",rn.ints),E=new Z("uint",rn.uint),bt=new Z("bool",rn.bool),z=new Z("vec2"),Ct=new Z("ivec2"),Wl=new Z("uvec2"),Hl=new Z("bvec2"),g=new Z("vec3"),ql=new Z("ivec3"),As=new Z("uvec3"),Zi=new Z("bvec3"),O=new Z("vec4"),$l=new Z("ivec4"),jl=new Z("uvec4"),Xl=new Z("bvec4"),vo=new Z("mat2"),Yl=new Z("imat2"),Zl=new Z("umat2"),Kl=new Z("bmat2"),et=new Z("mat3"),Jl=new Z("imat3"),Ql=new Z("umat3"),eu=new Z("bmat3"),qt=new Z("mat4"),tu=new Z("imat4"),su=new Z("umat4"),nu=new Z("bmat4"),ou=(o="")=>R(new je(o,"string")),iu=o=>R(new je(o,"ArrayBuffer"));N("color",Gl);N("float",h);N("int",p);N("uint",E);N("bool",bt);N("vec2",z);N("ivec2",Ct);N("uvec2",Wl);N("bvec2",Hl);N("vec3",g);N("ivec3",ql);N("uvec3",As);N("bvec3",Zi);N("vec4",O);N("ivec4",$l);N("uvec4",jl);N("bvec4",Xl);N("mat2",vo);N("imat2",Yl);N("umat2",Zl);N("bmat2",Kl);N("mat3",et);N("imat3",Jl);N("umat3",Ql);N("bmat3",eu);N("mat4",qt);N("imat4",tu);N("umat4",su);N("bmat4",nu);N("string",ou);N("arrayBuffer",iu);const ru=T(Qt),au=(o,e)=>R(new No(R(o),e));N("element",ru);N("convert",au);class Ki extends ee{constructor(e,t){super(),this.targetNode=e,this.sourceNode=t}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const s=e.getTypeLength(t.node.getNodeType(e));return sn.join("").slice(0,s)!==t.components}return!1}generate(e,t){const{targetNode:s,sourceNode:n}=this,i=this.needsSplitAssign(e),r=s.getNodeType(e),a=s.context({assign:!0}).build(e),c=n.build(e,r),l=n.getNodeType(e),u=e.getDataFromNode(this);let d;if(u.initialized===!0)t!=="void"&&(d=a);else if(i){const m=e.getVarFromNode(this,null,r),v=e.getPropertyName(m);e.addLineFlowCode(`${v} = ${c}`);const S=s.node.context({assign:!0}).build(e);for(let x=0;x<s.components.length;x++){const y=s.components[x];e.addLineFlowCode(`${S}.${y} = ${v}[ ${x} ]`)}t!=="void"&&(d=a)}else d=`${a} = ${c}`,(t==="void"||l==="void")&&(e.addLineFlowCode(d),t!=="void"&&(d=a));return u.initialized=!0,e.format(d,r,t)}}const cu=T(Ki);A("AssignNode",Ki);N("assign",cu);class Ji extends P{constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{name:t,node:s}=this,n=this.getNodeType(e),i=e.getVaryingFromNode(this,t,n);i.needsInterpolation||(i.needsInterpolation=e.shaderStage==="fragment");const r=e.getPropertyName(i,jo.VERTEX);return e.flowNodeFromShaderStage(jo.VERTEX,s,n,r),e.getPropertyName(i)}}const re=T(Ji);N("varying",re);A("VaryingNode",Ji);class cn extends P{constructor(e,t=null){super(t),this._attributeName=e}isGlobal(){return!0}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=super.getNodeType(e);if(t===null){const s=this.getAttributeName(e);if(e.hasGeometryAttribute(s)){const n=e.geometry.getAttribute(s);t=e.getTypeFromAttribute(n)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),s=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const i=e.geometry.getAttribute(t),r=e.getTypeFromAttribute(i),a=e.getAttribute(t,r);return e.shaderStage==="vertex"?e.format(a.name,r,s):re(this).build(e,s)}else return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(s)}}const Se=(o,e)=>R(new cn(o,e));A("AttributeNode",cn);class Qi extends P{constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t),this.outputNode.build(e)}}const er=T(Qi);N("bypass",er);A("BypassNode",Qi);let lu=0;class uu{constructor(){this.id=lu++,this.nodesData=new WeakMap}getNodeData(e){return this.nodesData.get(e)}setNodeData(e,t){this.nodesData.set(e,t)}}class tr extends P{constructor(e,t=new uu){super(),this.isCacheNode=!0,this.node=e,this.cache=t}getNodeType(e){return this.node.getNodeType(e)}build(e,...t){const s=e.getCache(),n=this.cache||e.globalCache;e.setCache(n);const i=this.node.build(e,...t);return e.setCache(s),i}}const Gs=T(tr),du=o=>Gs(o,null);N("cache",Gs);N("globalCache",du);A("CacheNode",tr);class So extends P{constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.context=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.context});const s=this.node.build(e);return e.setContext(t),s}generate(e,t){const s=e.getContext();e.setContext({...e.context,...this.context});const n=this.node.build(e,t);return e.setContext(s),n}}const ft=T(So),hu=(o,e)=>ft(o,{label:e});N("context",ft);N("label",hu);A("ContextNode",So);class lt extends P{constructor(e){super("uint"),this.scope=e,this.isInstanceIndexNode=!0}generate(e){const t=this.getNodeType(e),s=this.scope;let n;if(s===lt.VERTEX)n=e.getVertexIndex();else if(s===lt.INSTANCE)n=e.getInstanceIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+s);let i;return e.shaderStage==="vertex"||e.shaderStage==="compute"?i=n:i=re(this).build(e,t),i}}lt.VERTEX="vertex";lt.INSTANCE="instance";const pu=_(lt,lt.VERTEX),sr=_(lt,lt.INSTANCE);A("IndexNode",lt);class wo{start(){}finish(){}direct(){}indirectDiffuse(){}indirectSpecular(){}ambientOcclusion(){}}class nr extends P{constructor(e,t=null){super(),this.node=e,this.name=t,this.isVarNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:s}=this,n=e.getVarFromNode(this,s,e.getVectorType(this.getNodeType(e))),i=e.getPropertyName(n),r=t.build(e,n.type);return e.addLineFlowCode(`${i} = ${r}`),i}}const xs=T(nr);N("temp",xs);N("toVar",(...o)=>xs(...o).append());A("VarNode",nr);class Y extends P{constructor(e,t=null,s=!1){super(e),this.name=t,this.varying=s,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Ne=(o,e)=>R(new Y(o,e)),it=(o,e)=>R(new Y(o,e,!0)),oe=_(Y,"vec4","DiffuseColor"),vt=_(Y,"float","Roughness"),Ws=_(Y,"float","Metalness"),Yn=_(Y,"float","Clearcoat"),Hs=_(Y,"float","ClearcoatRoughness"),kt=_(Y,"vec3","Sheen"),Vo=_(Y,"float","SheenRoughness"),Ao=_(Y,"float","Iridescence"),or=_(Y,"float","IridescenceIOR"),ir=_(Y,"float","IridescenceThickness"),Zn=_(Y,"float","AlphaT"),Rt=_(Y,"float","Anisotropy"),Ds=_(Y,"vec3","AnisotropyT"),$t=_(Y,"vec3","AnisotropyB"),Ke=_(Y,"color","SpecularColor"),qs=_(Y,"float","SpecularF90"),Kn=_(Y,"float","Shininess"),mu=_(Y,"vec4","Output"),jt=_(Y,"float","dashSize"),$s=_(Y,"float","gapSize");_(Y,"float","pointWidth");const Ps=_(Y,"float","IOR"),Jn=_(Y,"float","Transmission"),rr=_(Y,"float","Thickness"),ar=_(Y,"float","AttenuationDistance"),cr=_(Y,"color","AttenuationColor");A("PropertyNode",Y);class fu extends Y{constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}A("ParameterNode",fu);class _o extends P{constructor(e="",t=[],s=""){super("code"),this.isCodeNode=!0,this.code=e,this.language=s,this.includes=t}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const n of t)n.build(e);const s=e.getCodeFromNode(this,this.getNodeType(e));return s.code=this.code,s.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}T(_o);A("CodeNode",_o);class gu extends _o{constructor(e="",t=[],s=""){super(e,t,s),this.keywords={}}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let s=t.nodeFunction;return s===void 0&&(s=e.parser.parseFunction(this.code),t.nodeFunction=s),s}generate(e,t){super.generate(e);const s=this.getNodeFunction(e),n=s.name,i=s.type,r=e.getCodeFromNode(this,i);n!==""&&(r.name=n);const a=e.getPropertyName(r);let c=this.getNodeFunction(e).getCode(a);const l=this.keywords,u=Object.keys(l);if(u.length>0)for(const d of u){const m=new RegExp(`\\b${d}\\b`,"g"),v=l[d].build(e,"property");c=c.replace(m,v)}return r.code=c+`
`,t==="property"?a:e.format(`${a}()`,i,t)}}A("FunctionNode",gu);class Mo extends P{constructor(e,t=!1){super("string"),this.name=e,this.version=0,this.shared=t,this.isUniformGroup=!0}set needsUpdate(e){e===!0&&this.version++}}const Nu=o=>new Mo(o),lr=o=>new Mo(o,!0);lr("frame");lr("render");const yu=Nu("object");A("UniformGroupNode",Mo);class zt extends nn{constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.groupNode=yu}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const s=this.getSelf();return e=e.bind(s),super.onUpdate(n=>{const i=e(n,s);i!==void 0&&(this.value=i)},t)}generate(e,t){const s=this.getNodeType(e),n=this.getUniformHash(e);let i=e.getNodeFromHash(n);i===void 0&&(e.setHashNode(this,n),i=this);const r=i.getInputType(e),a=e.getUniformFromNode(i,r,e.shaderStage,e.context.label),c=e.getPropertyName(a);return e.context.label!==void 0&&delete e.context.label,e.format(c,s,t)}}const Q=(o,e)=>{const t=Bl(e||o),s=o&&o.isNode===!0?o.node&&o.node.value||o.value:o;return R(new zt(s,t))};A("UniformNode",zt);class ur extends cn{constructor(e=0){super(null,"vec2"),this.isUVNode=!0,this.index=e}getAttributeName(){const e=this.index;return"uv"+(e>0?e:"")}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const dt=(...o)=>R(new ur(...o));A("UVNode",ur);class dr extends P{constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const s=this.textureNode.build(e,"property"),n=this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${s}, ${n} )`,this.getNodeType(e),t)}}const Ro=T(dr);N("textureSize",Ro);A("TextureSizeNode",dr);class ne extends ee{constructor(e,t,s,...n){if(super(),this.op=e,n.length>0){let i=s;for(let r=0;r<n.length;r++)i=new ne(e,i,n[r]);s=i}this.aNode=t,this.bNode=s}getNodeType(e,t){const s=this.op,n=this.aNode,i=this.bNode,r=n.getNodeType(e),a=typeof i<"u"?i.getNodeType(e):null;if(r==="void"||a==="void")return"void";if(s==="%")return r;if(s==="~"||s==="&"||s==="|"||s==="^"||s===">>"||s==="<<")return e.getIntegerType(r);if(s==="!"||s==="=="||s==="&&"||s==="||"||s==="^^")return"bool";if(s==="<"||s===">"||s==="<="||s===">="){const c=t?e.getTypeLength(t):Math.max(e.getTypeLength(r),e.getTypeLength(a));return c>1?`bvec${c}`:"bool"}else return r==="float"&&e.isMatrix(a)?a:e.isMatrix(r)&&e.isVector(a)?e.getVectorFromMatrix(r):e.isVector(r)&&e.isMatrix(a)?e.getVectorFromMatrix(a):e.getTypeLength(a)>e.getTypeLength(r)?a:r}generate(e,t){const s=this.op,n=this.aNode,i=this.bNode,r=this.getNodeType(e,t);let a=null,c=null;r!=="void"?(a=n.getNodeType(e),c=typeof i<"u"?i.getNodeType(e):null,s==="<"||s===">"||s==="<="||s===">="||s==="=="?e.isVector(a)?c=a:a=c="float":s===">>"||s==="<<"?(a=r,c=e.changeComponentType(c,"uint")):e.isMatrix(a)&&e.isVector(c)?c=e.getVectorFromMatrix(a):e.isVector(a)&&e.isMatrix(c)?a=e.getVectorFromMatrix(c):a=c=r):a=c=r;const l=n.build(e,a),u=typeof i<"u"?i.build(e,c):null,d=e.getTypeLength(t),m=e.getFunctionOperator(s);if(t!=="void")return s==="<"&&d>1?e.format(`${e.getMethod("lessThan")}( ${l}, ${u} )`,r,t):s==="<="&&d>1?e.format(`${e.getMethod("lessThanEqual")}( ${l}, ${u} )`,r,t):s===">"&&d>1?e.format(`${e.getMethod("greaterThan")}( ${l}, ${u} )`,r,t):s===">="&&d>1?e.format(`${e.getMethod("greaterThanEqual")}( ${l}, ${u} )`,r,t):s==="!"||s==="~"?e.format(`(${s}${l})`,a,t):m?e.format(`${m}( ${l}, ${u} )`,r,t):e.format(`( ${l} ${s} ${u} )`,r,t);if(a!=="void")return m?e.format(`${m}( ${l}, ${u} )`,r,t):e.format(`${l} ${s} ${u}`,r,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Be=T(ne,"+"),le=T(ne,"-"),q=T(ne,"*"),wt=T(ne,"/"),xu=T(ne,"%"),Tu=T(ne,"=="),vu=T(ne,"!="),Su=T(ne,"<"),hr=T(ne,">"),wu=T(ne,"<="),Vu=T(ne,">="),Au=T(ne,"&&"),_u=T(ne,"||"),Mu=T(ne,"!"),Ru=T(ne,"^^"),Eu=T(ne,"&"),Cu=T(ne,"~"),Lu=T(ne,"|"),bu=T(ne,"^"),Iu=T(ne,"<<"),Ou=T(ne,">>");N("add",Be);N("sub",le);N("mul",q);N("div",wt);N("remainder",xu);N("equal",Tu);N("notEqual",vu);N("lessThan",Su);N("greaterThan",hr);N("lessThanEqual",wu);N("greaterThanEqual",Vu);N("and",Au);N("or",_u);N("not",Mu);N("xor",Ru);N("bitAnd",Eu);N("bitNot",Cu);N("bitOr",Lu);N("bitXor",bu);N("shiftLeft",Iu);N("shiftRight",Ou);A("OperatorNode",ne);class f extends ee{constructor(e,t,s=null,n=null){super(),this.method=e,this.aNode=t,this.bNode=s,this.cNode=n}getInputType(e){const t=this.aNode.getNodeType(e),s=this.bNode?this.bNode.getNodeType(e):null,n=this.cNode?this.cNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),r=e.isMatrix(s)?0:e.getTypeLength(s),a=e.isMatrix(n)?0:e.getTypeLength(n);return i>r&&i>a?t:r>a?s:a>i?n:t}getNodeType(e){const t=this.method;return t===f.LENGTH||t===f.DISTANCE||t===f.DOT?"float":t===f.CROSS?"vec3":t===f.ALL?"bool":t===f.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):t===f.MOD?this.aNode.getNodeType(e):this.getInputType(e)}generate(e,t){const s=this.method,n=this.getNodeType(e),i=this.getInputType(e),r=this.aNode,a=this.bNode,c=this.cNode,l=e.renderer.isWebGLRenderer===!0;if(s===f.TRANSFORM_DIRECTION){let u=r,d=a;e.isMatrix(u.getNodeType(e))?d=O(g(d),0):u=O(g(u),0);const m=q(u,d).xyz;return Ae(m).build(e,t)}else{if(s===f.NEGATE)return e.format("( - "+r.build(e,i)+" )",n,t);if(s===f.ONE_MINUS)return le(1,r).build(e,t);if(s===f.RECIPROCAL)return wt(1,r).build(e,t);if(s===f.DIFFERENCE)return ue(le(r,a)).build(e,t);{const u=[];return s===f.CROSS||s===f.MOD?u.push(r.build(e,n),a.build(e,n)):s===f.STEP?u.push(r.build(e,e.getTypeLength(r.getNodeType(e))===1?"float":i),a.build(e,i)):l&&(s===f.MIN||s===f.MAX)||s===f.MOD?u.push(r.build(e,i),a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":i)):s===f.REFRACT?u.push(r.build(e,i),a.build(e,i),c.build(e,"float")):s===f.MIX?u.push(r.build(e,i),a.build(e,i),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":i)):(u.push(r.build(e,i)),a!==null&&u.push(a.build(e,i)),c!==null&&u.push(c.build(e,i))),e.format(`${e.getMethod(s,n)}( ${u.join(", ")} )`,n,t)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}f.ALL="all";f.ANY="any";f.EQUALS="equals";f.RADIANS="radians";f.DEGREES="degrees";f.EXP="exp";f.EXP2="exp2";f.LOG="log";f.LOG2="log2";f.SQRT="sqrt";f.INVERSE_SQRT="inversesqrt";f.FLOOR="floor";f.CEIL="ceil";f.NORMALIZE="normalize";f.FRACT="fract";f.SIN="sin";f.COS="cos";f.TAN="tan";f.ASIN="asin";f.ACOS="acos";f.ATAN="atan";f.ABS="abs";f.SIGN="sign";f.LENGTH="length";f.NEGATE="negate";f.ONE_MINUS="oneMinus";f.DFDX="dFdx";f.DFDY="dFdy";f.ROUND="round";f.RECIPROCAL="reciprocal";f.TRUNC="trunc";f.FWIDTH="fwidth";f.BITCAST="bitcast";f.ATAN2="atan2";f.MIN="min";f.MAX="max";f.MOD="mod";f.STEP="step";f.REFLECT="reflect";f.DISTANCE="distance";f.DIFFERENCE="difference";f.DOT="dot";f.CROSS="cross";f.POW="pow";f.TRANSFORM_DIRECTION="transformDirection";f.MIX="mix";f.CLAMP="clamp";f.REFRACT="refract";f.SMOOTHSTEP="smoothstep";f.FACEFORWARD="faceforward";const pr=h(1e-6);h(1e6);const ei=h(Math.PI);h(Math.PI*2);const mr=T(f,f.ALL),zu=T(f,f.ANY),Du=T(f,f.EQUALS),Pu=T(f,f.RADIANS),Fu=T(f,f.DEGREES),fr=T(f,f.EXP),Qn=T(f,f.EXP2),gr=T(f,f.LOG),ln=T(f,f.LOG2),Dt=T(f,f.SQRT),Bu=T(f,f.INVERSE_SQRT),es=T(f,f.FLOOR),Nr=T(f,f.CEIL),Ae=T(f,f.NORMALIZE),un=T(f,f.FRACT),mt=T(f,f.SIN),xt=T(f,f.COS),Uu=T(f,f.TAN),ku=T(f,f.ASIN),Gu=T(f,f.ACOS),Wu=T(f,f.ATAN),ue=T(f,f.ABS),Eo=T(f,f.SIGN),Ns=T(f,f.LENGTH),Hu=T(f,f.NEGATE),qu=T(f,f.ONE_MINUS),$u=T(f,f.DFDX),ju=T(f,f.DFDY),Xu=T(f,f.ROUND),Yu=T(f,f.RECIPROCAL),yr=T(f,f.TRUNC),Zu=T(f,f.FWIDTH);T(f,f.BITCAST);const Ku=T(f,f.ATAN2),Kt=T(f,f.MIN),Ue=T(f,f.MAX),Ju=T(f,f.MOD),Qu=T(f,f.STEP),ed=T(f,f.REFLECT),td=T(f,f.DISTANCE),sd=T(f,f.DIFFERENCE),ts=T(f,f.DOT),xr=T(f,f.CROSS),ct=T(f,f.POW),Tr=T(f,f.POW,2),nd=T(f,f.POW,3),od=T(f,f.POW,4),id=T(f,f.TRANSFORM_DIRECTION),rd=o=>q(Eo(o),ct(ue(o),1/3)),ad=o=>ts(o,o),Te=T(f,f.MIX),Jt=(o,e=0,t=1)=>R(new f(f.CLAMP,R(o),R(e),R(t))),cd=o=>Jt(o),vr=T(f,f.REFRACT),gt=T(f,f.SMOOTHSTEP),ld=T(f,f.FACEFORWARD),ud=(o,e,t)=>Te(e,t,o),dd=(o,e,t)=>gt(e,t,o);N("all",mr);N("any",zu);N("equals",Du);N("radians",Pu);N("degrees",Fu);N("exp",fr);N("exp2",Qn);N("log",gr);N("log2",ln);N("sqrt",Dt);N("inverseSqrt",Bu);N("floor",es);N("ceil",Nr);N("normalize",Ae);N("fract",un);N("sin",mt);N("cos",xt);N("tan",Uu);N("asin",ku);N("acos",Gu);N("atan",Wu);N("abs",ue);N("sign",Eo);N("length",Ns);N("lengthSq",ad);N("negate",Hu);N("oneMinus",qu);N("dFdx",$u);N("dFdy",ju);N("round",Xu);N("reciprocal",Yu);N("trunc",yr);N("fwidth",Zu);N("atan2",Ku);N("min",Kt);N("max",Ue);N("mod",Ju);N("step",Qu);N("reflect",ed);N("distance",td);N("dot",ts);N("cross",xr);N("pow",ct);N("pow2",Tr);N("pow3",nd);N("pow4",od);N("transformDirection",id);N("mix",ud);N("clamp",Jt);N("refract",vr);N("smoothstep",dd);N("faceForward",ld);N("difference",sd);N("saturate",cd);N("cbrt",rd);A("MathNode",f);const hd=w(o=>{const{value:e}=o,{rgb:t}=e,s=t.mul(.9478672986).add(.0521327014).pow(2.4),n=t.mul(.0773993808),i=t.lessThanEqual(.04045),r=Te(s,n,i);return O(r,e.a)}),pd=w(o=>{const{value:e}=o,{rgb:t}=e,s=t.pow(.41666).mul(1.055).sub(.055),n=t.mul(12.92),i=t.lessThanEqual(.0031308),r=Te(s,n,i);return O(r,e.a)}),ti=o=>{let e=null;return o===mo?e="Linear":o===kc&&(e="sRGB"),e},Sr=(o,e)=>ti(o)+"To"+ti(e);class be extends ee{constructor(e,t){super("vec4"),this.method=e,this.node=t}setup(){const{method:e,node:t}=this;return e===be.LINEAR_TO_LINEAR?t:md[e]({value:t})}}be.LINEAR_TO_LINEAR="LinearToLinear";be.LINEAR_TO_sRGB="LinearTosRGB";be.sRGB_TO_LINEAR="sRGBToLinear";const md={[be.LINEAR_TO_sRGB]:pd,[be.sRGB_TO_LINEAR]:hd},fd=(o,e)=>R(new be(Sr(mo,e),R(o))),wr=(o,e)=>R(new be(Sr(e,mo),R(o))),gd=T(be,be.LINEAR_TO_sRGB),Nd=T(be,be.sRGB_TO_LINEAR);N("linearTosRGB",gd);N("sRGBToLinear",Nd);N("linearToColorSpace",fd);N("colorSpaceToLinear",wr);A("ColorSpaceNode",be);class Vr extends P{constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const s=this.getNodeType(e),n=this.snippet;if(s==="void")e.addLineFlowCode(n);else return e.format(`( ${n} )`,s,t)}}const dn=T(Vr);A("ExpressionNode",Vr);class Ar extends zt{constructor(e){super(0),this.textureNode=e,this.updateType=J.FRAME}get texture(){return this.textureNode.value}update(){const e=this.texture,t=e.images,s=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(s&&s.width!==void 0){const{width:n,height:i}=s;this.value=Math.log2(Math.max(n,i))}}}const yd=T(Ar);A("MaxMipLevelNode",Ar);class ss extends zt{constructor(e,t=null,s=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=s,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=J.NONE,this.referenceNode=null,this._value=e,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":"vec4"}getInputType(){return"texture"}getDefaultUV(){return dt(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){const t=this.value;return Q(t.matrix).mul(g(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?J.FRAME:J.NONE,this}setupUV(e,t){const s=this.value;return e.isFlipY()&&(s.isRenderTargetTexture===!0||s.isFramebufferTexture===!0||s.isDepthTexture===!0)&&(t=t.setY(t.y.oneMinus())),t}setup(e){const t=e.getNodeProperties(this);let s=this.uvNode;(s===null||e.context.forceUVContext===!0)&&e.context.getUV&&(s=e.context.getUV(this)),s||(s=this.getDefaultUV()),this.updateMatrix===!0&&(s=this.getTransformedUV(s)),s=this.setupUV(e,s);let n=this.levelNode;n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),t.uvNode=s,t.levelNode=n,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,s,n,i,r,a){const c=this.value;let l;return n?l=e.generateTextureLevel(c,t,s,n,i):a?l=e.generateTextureGrad(c,t,s,a,i):r?l=e.generateTextureCompare(c,t,s,r,i):this.sampler===!1?l=e.generateTextureLoad(c,t,s,i):l=e.generateTexture(c,t,s,i),l}generate(e,t){const s=e.getNodeProperties(this),n=this.value;if(!n||n.isTexture!==!0)throw new Error("TextureNode: Need a three.js texture.");const i=super.generate(e,"property");if(t==="sampler")return i+"_sampler";if(e.isReference(t))return i;{const r=e.getDataFromNode(this);let a=r.propertyName;if(a===void 0){const{uvNode:u,levelNode:d,compareNode:m,depthNode:v,gradNode:S}=s,x=this.generateUV(e,u),y=d?d.build(e,"float"):null,M=v?v.build(e,"int"):null,L=m?m.build(e,"float"):null,I=S?[S[0].build(e,"vec2"),S[1].build(e,"vec2")]:null,D=e.getVarFromNode(this);a=e.getPropertyName(D);const F=this.generateSnippet(e,i,x,y,M,L,I);e.addLineFlowCode(`${a} = ${F}`),e.context.tempWrite!==!1&&(r.snippet=F,r.propertyName=a)}let c=a;const l=this.getNodeType(e);return e.needsColorSpaceToLinear(n)&&(c=wr(dn(c,l),n.colorSpace).setup(e).build(e,l)),e.format(c,l,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){const t=this.clone();return t.uvNode=e,t.referenceNode=this,R(t)}blur(e){const t=this.clone();return t.levelNode=e.mul(yd(t)),t.referenceNode=this,R(t)}level(e){const t=this.clone();return t.levelNode=e,t.referenceNode=this,t}size(e){return Ro(this,e)}compare(e){const t=this.clone();return t.compareNode=R(e),t.referenceNode=this,R(t)}grad(e,t){const s=this.clone();return s.gradNode=[R(e),R(t)],s.referenceNode=this,R(s)}depth(e){const t=this.clone();return t.depthNode=R(e),t.referenceNode=this,R(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value]}update(){const e=this.value;e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e}}const Fe=T(ss),Et=(...o)=>Fe(...o).setSampler(!1);N("texture",Fe);A("TextureNode",ss);class hn extends zt{constructor(e,t,s=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=s}getInputType(){return"buffer"}}const Co=(o,e,t)=>R(new hn(o,e,t));A("BufferNode",hn);class xd extends Qt{constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=super.generate(e),s=this.getNodeType();return e.format(t,"vec4",s)}}class _r extends hn{constructor(e,t=null){super(null,"vec4"),this.array=e,this.elementType=t,this._elementType=null,this._elementLength=0,this.updateType=J.RENDER,this.isArrayBufferNode=!0}getElementType(){return this.elementType||this._elementType}getElementLength(){return this._elementLength}update(){const{array:e,value:t}=this,s=this.getElementLength(),n=this.getElementType();if(s===1)for(let i=0;i<e.length;i++){const r=i*4;t[r]=e[i]}else if(n==="color")for(let i=0;i<e.length;i++){const r=i*4,a=e[i];t[r]=a.r,t[r+1]=a.g,t[r+2]=a.b||0}else for(let i=0;i<e.length;i++){const r=i*4,a=e[i];t[r]=a.x,t[r+1]=a.y,t[r+2]=a.z||0,t[r+3]=a.w||0}}setup(e){const t=this.array.length;return this._elementType=this.elementType===null?Tt(this.array[0]):this.elementType,this._elementLength=e.getTypeLength(this._elementType),this.value=new Float32Array(t*4),this.bufferCount=t,super.setup(e)}element(e){return R(new xd(this,R(e)))}}const eo=(o,e)=>R(new _r(o,e));A("UniformsNode",_r);class Td extends Qt{constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),s=this.referenceNode.getNodeType(),n=this.getNodeType();return e.format(t,s,n)}}class ns extends P{constructor(e,t,s=null,n=null){super(),this.property=e,this.uniformType=t,this.object=s,this.count=n,this.properties=e.split("."),this.reference=null,this.node=null,this.updateType=J.OBJECT}element(e){return R(new Td(this,R(e)))}setNodeType(e){let t=null;this.count!==null?t=Co(null,e,this.count):Array.isArray(this.getValueFromReference())?t=eo(null,e):e==="texture"?t=Fe(null):t=Q(null,e),this.node=t}getNodeType(e){return this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let s=e[t[0]];for(let n=1;n<t.length;n++)s=s[t[n]];return s}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const tt=(o,e,t)=>R(new ns(o,e,t)),vd=(o,e,t,s)=>R(new ns(o,e,s,t));A("ReferenceNode",ns);class Mr extends ns{constructor(e,t,s=null){super(e,t,s),this.material=s}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const Rr=(o,e,t)=>R(new Mr(o,e,t));A("MaterialReferenceNode",Mr);class U extends P{constructor(e=U.VIEW_MATRIX,t=null){super(),this.scope=e,this.object3d=t,this.updateType=J.OBJECT,this._uniformNode=new zt(null)}getNodeType(){const e=this.scope;if(e===U.WORLD_MATRIX||e===U.VIEW_MATRIX)return"mat4";if(e===U.NORMAL_MATRIX)return"mat3";if(e===U.POSITION||e===U.VIEW_POSITION||e===U.DIRECTION||e===U.SCALE)return"vec3"}update(e){const t=this.object3d,s=this._uniformNode,n=this.scope;if(n===U.VIEW_MATRIX)s.value=t.modelViewMatrix;else if(n===U.NORMAL_MATRIX)s.value=t.normalMatrix;else if(n===U.WORLD_MATRIX)s.value=t.matrixWorld;else if(n===U.POSITION)s.value=s.value||new W,s.value.setFromMatrixPosition(t.matrixWorld);else if(n===U.SCALE)s.value=s.value||new W,s.value.setFromMatrixScale(t.matrixWorld);else if(n===U.DIRECTION)s.value=s.value||new W,t.getWorldDirection(s.value);else if(n===U.VIEW_POSITION){const i=e.camera;s.value=s.value||new W,s.value.setFromMatrixPosition(t.matrixWorld),s.value.applyMatrix4(i.matrixWorldInverse)}}generate(e){const t=this.scope;return t===U.WORLD_MATRIX||t===U.VIEW_MATRIX?this._uniformNode.nodeType="mat4":t===U.NORMAL_MATRIX?this._uniformNode.nodeType="mat3":(t===U.POSITION||t===U.VIEW_POSITION||t===U.DIRECTION||t===U.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}U.VIEW_MATRIX="viewMatrix";U.NORMAL_MATRIX="normalMatrix";U.WORLD_MATRIX="worldMatrix";U.POSITION="position";U.SCALE="scale";U.VIEW_POSITION="viewPosition";U.DIRECTION="direction";T(U,U.DIRECTION);T(U,U.VIEW_MATRIX);T(U,U.NORMAL_MATRIX);T(U,U.WORLD_MATRIX);const to=T(U,U.POSITION);T(U,U.SCALE);const Er=T(U,U.VIEW_POSITION);A("Object3DNode",U);class k extends U{constructor(e=k.POSITION){super(e),this.updateType=J.RENDER}getNodeType(e){const t=this.scope;return t===k.PROJECTION_MATRIX||t===k.PROJECTION_MATRIX_INVERSE?"mat4":t===k.NEAR||t===k.FAR||t===k.LOG_DEPTH?"float":super.getNodeType(e)}update(e){const t=e.camera,s=this._uniformNode,n=this.scope;n===k.VIEW_MATRIX?s.value=t.matrixWorldInverse:n===k.PROJECTION_MATRIX?s.value=t.projectionMatrix:n===k.PROJECTION_MATRIX_INVERSE?s.value=t.projectionMatrixInverse:n===k.NEAR?s.value=t.near:n===k.FAR?s.value=t.far:n===k.LOG_DEPTH?s.value=2/(Math.log(t.far+1)/Math.LN2):(this.object3d=t,super.update(e))}generate(e){const t=this.scope;return t===k.PROJECTION_MATRIX||t===k.PROJECTION_MATRIX_INVERSE?this._uniformNode.nodeType="mat4":(t===k.NEAR||t===k.FAR||t===k.LOG_DEPTH)&&(this._uniformNode.nodeType="float"),super.generate(e)}}k.PROJECTION_MATRIX="projectionMatrix";k.PROJECTION_MATRIX_INVERSE="projectionMatrixInverse";k.NEAR="near";k.FAR="far";k.LOG_DEPTH="logDepth";const rt=_(k,k.PROJECTION_MATRIX);_(k,k.PROJECTION_MATRIX_INVERSE);const Vn=_(k,k.NEAR),An=_(k,k.FAR),Sd=_(k,k.LOG_DEPTH),Nt=_(k,k.VIEW_MATRIX);_(k,k.NORMAL_MATRIX);_(k,k.WORLD_MATRIX);const wd=_(k,k.POSITION);A("CameraNode",k);class ve extends U{constructor(e=ve.VIEW_MATRIX){super(e)}update(e){this.object3d=e.object,super.update(e)}}_(ve,ve.DIRECTION);const It=_(ve,ve.VIEW_MATRIX).label("modelViewMatrix").temp("ModelViewMatrix"),Cr=_(ve,ve.NORMAL_MATRIX),Ts=_(ve,ve.WORLD_MATRIX);_(ve,ve.POSITION);_(ve,ve.SCALE);_(ve,ve.VIEW_POSITION);A("ModelNode",ve);class he extends P{constructor(e=he.LOCAL){super("vec3"),this.scope=e}isGlobal(){return!0}getHash(){return`normal-${this.scope}`}generate(e){const t=this.scope;let s=null;if(t===he.GEOMETRY)e.hasGeometryAttribute("normal")===!1?s=g(0,1,0):s=Se("normal","vec3");else if(t===he.LOCAL)s=re(js);else if(t===he.VIEW){const n=Cr.mul(st);s=Ae(re(n))}else if(t===he.WORLD){const n=Vt.transformDirection(Nt);s=Ae(re(n))}return s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}he.GEOMETRY="geometry";he.LOCAL="local";he.VIEW="view";he.WORLD="world";const js=_(he,he.GEOMETRY),st=_(he,he.LOCAL).temp("Normal"),Vt=_(he,he.VIEW),Lr=_(he,he.WORLD),ae=Ne("vec3","TransformedNormalView"),br=ae.transformDirection(Nt).normalize(),Gt=Ne("vec3","TransformedClearcoatNormalView");A("NormalNode",he);const si=new Map;class V extends P{constructor(e){super(),this.scope=e}getCache(e,t){let s=si.get(e);return s===void 0&&(s=Rr(e,t),si.set(e,s)),s}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,s=this.scope;let n=null;if(s===V.COLOR){const i=this.getColor(s);t.map&&t.map.isTexture===!0?n=i.mul(this.getTexture("map")):n=i}else if(s===V.OPACITY){const i=this.getFloat(s);t.alphaMap&&t.alphaMap.isTexture===!0?n=i.mul(this.getTexture("alpha")):n=i}else if(s===V.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?n=this.getTexture("specular").r:n=h(1);else if(s===V.SPECULAR_INTENSITY){const i=this.getFloat(s);t.specularMap?n=i.mul(this.getTexture(s).a):n=i}else if(s===V.SPECULAR_COLOR){const i=this.getColor(s);t.specularColorMap&&t.specularColorMap.isTexture===!0?n=i.mul(this.getTexture(s).rgb):n=i}else if(s===V.ROUGHNESS){const i=this.getFloat(s);t.roughnessMap&&t.roughnessMap.isTexture===!0?n=i.mul(this.getTexture(s).g):n=i}else if(s===V.METALNESS){const i=this.getFloat(s);t.metalnessMap&&t.metalnessMap.isTexture===!0?n=i.mul(this.getTexture(s).b):n=i}else if(s===V.EMISSIVE){const i=this.getColor(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?n=i.mul(this.getTexture(s)):n=i}else if(s===V.NORMAL)t.normalMap?n=this.getTexture("normal").normalMap(this.getCache("normalScale","vec2")):t.bumpMap?n=this.getTexture("bump").r.bumpMap(this.getFloat("bumpScale")):n=Vt;else if(s===V.CLEARCOAT){const i=this.getFloat(s);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?n=i.mul(this.getTexture(s).r):n=i}else if(s===V.CLEARCOAT_ROUGHNESS){const i=this.getFloat(s);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?n=i.mul(this.getTexture(s).r):n=i}else if(s===V.CLEARCOAT_NORMAL)t.clearcoatNormalMap?n=this.getTexture(s).normalMap(this.getCache(s+"Scale","vec2")):n=Vt;else if(s===V.SHEEN){const i=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?n=i.mul(this.getTexture("sheenColor").rgb):n=i}else if(s===V.SHEEN_ROUGHNESS){const i=this.getFloat(s);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?n=i.mul(this.getTexture(s).a):n=i,n=n.clamp(.07,1)}else if(s===V.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const i=this.getTexture(s);n=vo(cs.x,cs.y,cs.y.negate(),cs.x).mul(i.rg.mul(2).sub(z(1)).normalize().mul(i.b))}else n=cs;else if(s===V.IRIDESCENCE_THICKNESS){const i=tt("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const r=tt("0","float",t.iridescenceThicknessRange);n=i.sub(r).mul(this.getTexture(s).g).add(r)}else n=i}else if(s===V.TRANSMISSION){const i=this.getFloat(s);t.transmissionMap?n=i.mul(this.getTexture(s).r):n=i}else if(s===V.THICKNESS){const i=this.getFloat(s);t.thicknessMap?n=i.mul(this.getTexture(s).g):n=i}else if(s===V.IOR)n=this.getFloat(s);else{const i=this.getNodeType(e);n=this.getCache(s,i)}return n}}V.ALPHA_TEST="alphaTest";V.COLOR="color";V.OPACITY="opacity";V.SHININESS="shininess";V.SPECULAR="specular";V.SPECULAR_STRENGTH="specularStrength";V.SPECULAR_INTENSITY="specularIntensity";V.SPECULAR_COLOR="specularColor";V.REFLECTIVITY="reflectivity";V.ROUGHNESS="roughness";V.METALNESS="metalness";V.NORMAL="normal";V.CLEARCOAT="clearcoat";V.CLEARCOAT_ROUGHNESS="clearcoatRoughness";V.CLEARCOAT_NORMAL="clearcoatNormal";V.EMISSIVE="emissive";V.ROTATION="rotation";V.SHEEN="sheen";V.SHEEN_ROUGHNESS="sheenRoughness";V.ANISOTROPY="anisotropy";V.IRIDESCENCE="iridescence";V.IRIDESCENCE_IOR="iridescenceIOR";V.IRIDESCENCE_THICKNESS="iridescenceThickness";V.IOR="ior";V.TRANSMISSION="transmission";V.THICKNESS="thickness";V.ATTENUATION_DISTANCE="attenuationDistance";V.ATTENUATION_COLOR="attenuationColor";V.LINE_SCALE="scale";V.LINE_DASH_SIZE="dashSize";V.LINE_GAP_SIZE="gapSize";V.LINE_WIDTH="linewidth";V.LINE_DASH_OFFSET="dashOffset";V.POINT_WIDTH="pointWidth";const Vd=_(V,V.ALPHA_TEST),vs=_(V,V.COLOR),Ad=_(V,V.SHININESS),_d=_(V,V.EMISSIVE),Ir=_(V,V.OPACITY),Md=_(V,V.SPECULAR),ni=_(V,V.SPECULAR_INTENSITY),Rd=_(V,V.SPECULAR_COLOR),Ed=_(V,V.SPECULAR_STRENGTH);_(V,V.REFLECTIVITY);const Cd=_(V,V.ROUGHNESS),Ld=_(V,V.METALNESS),bd=_(V,V.NORMAL),Id=_(V,V.CLEARCOAT),Od=_(V,V.CLEARCOAT_ROUGHNESS),zd=_(V,V.CLEARCOAT_NORMAL),Dd=_(V,V.ROTATION),Pd=_(V,V.SHEEN),Fd=_(V,V.SHEEN_ROUGHNESS),Bd=_(V,V.ANISOTROPY),Ud=_(V,V.IRIDESCENCE),kd=_(V,V.IRIDESCENCE_IOR),Gd=_(V,V.IRIDESCENCE_THICKNESS),Wd=_(V,V.TRANSMISSION),Hd=_(V,V.THICKNESS),qd=_(V,V.IOR),$d=_(V,V.ATTENUATION_DISTANCE),jd=_(V,V.ATTENUATION_COLOR),so=_(V,V.LINE_SCALE),Or=_(V,V.LINE_DASH_SIZE),zr=_(V,V.LINE_GAP_SIZE),_n=_(V,V.LINE_WIDTH),oi=_(V,V.LINE_DASH_OFFSET),Xd=_(V,V.POINT_WIDTH),cs=Q(new $e).onReference(function(o){return o.material}).onRenderUpdate(function({material:o}){this.value.set(o.anisotropy*Math.cos(o.anisotropyRotation),o.anisotropy*Math.sin(o.anisotropyRotation))});A("MaterialNode",V);class K extends P{constructor(e=K.LOCAL){super("vec3"),this.scope=e}isGlobal(){return!0}getHash(){return`position-${this.scope}`}generate(e){const t=this.scope;let s=null;if(t===K.GEOMETRY)s=Se("position","vec3");else if(t===K.LOCAL)s=re(Re);else if(t===K.WORLD){const n=Ts.mul(we);s=re(n)}else if(t===K.VIEW){const n=It.mul(we);s=re(n)}else if(t===K.VIEW_DIRECTION){const n=De.negate();s=Ae(re(n))}else if(t===K.WORLD_DIRECTION){const n=we.transformDirection(Ts);s=Ae(re(n))}return s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}K.GEOMETRY="geometry";K.LOCAL="local";K.WORLD="world";K.WORLD_DIRECTION="worldDirection";K.VIEW="view";K.VIEW_DIRECTION="viewDirection";const Re=_(K,K.GEOMETRY),we=_(K,K.LOCAL).temp("Position"),no=_(K,K.WORLD),Yd=_(K,K.WORLD_DIRECTION),De=_(K,K.VIEW),ie=_(K,K.VIEW_DIRECTION);A("PositionNode",K);class Dr extends ee{constructor(e=null){super("vec4"),this.positionNode=e}setup(e){if(e.shaderStage==="fragment")return re(e.context.mvp);const t=this.positionNode||we;return rt.mul(It).mul(t)}}const ii=T(Dr);A("ModelViewProjectionNode",Dr);class Pr extends nn{constructor(e,t=null,s=0,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=s,this.bufferOffset=n,this.usage=Gc,this.instanced=!1,this.attribute=null,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),s=this.value,n=e.getTypeLength(t),i=this.bufferStride||n,r=this.bufferOffset,a=s.isInterleavedBuffer===!0?s:new Wc(s,i),c=new Hc(a,n,r);a.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),s=e.getBufferAttributeFromNode(this,t),n=e.getPropertyName(s);let i=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=n,i=n):i=re(this).build(e,t),i}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this}setInstanced(e){return this.instanced=e,this}}const pn=(o,e,t,s)=>R(new Pr(o,e,t,s)),Zd=(o,e,t,s)=>pn(o,e,t,s).setUsage(Wn),ri=(o,e,t,s)=>pn(o,e,t,s).setInstanced(!0),ai=(o,e,t,s)=>Zd(o,e,t,s).setInstanced(!0);N("toAttribute",o=>pn(o.value));A("BufferAttributeNode",Pr);class Fr extends P{constructor(e){super("void"),this.instanceMesh=e,this.instanceMatrixNode=null,this.instanceColorNode=null}setup(){let e=this.instanceMatrixNode;const t=this.instanceMesh;if(e===null){const c=t.instanceMatrix,l=new qc(c.array,16,1),u=c.usage===Wn?ai:ri,d=[u(l,"vec4",16,0),u(l,"vec4",16,4),u(l,"vec4",16,8),u(l,"vec4",16,12)];e=qt(...d),this.instanceMatrixNode=e}const s=t.instanceColor;if(s&&this.instanceColorNode===null){const c=new $c(s.array,3),l=s.usage===Wn?ai:ri;this.instanceColorNode=g(l(c,"vec3",3,0))}const n=e.mul(we).xyz,i=et(e[0].xyz,e[1].xyz,e[2].xyz),r=st.div(g(i[0].dot(i[0]),i[1].dot(i[1]),i[2].dot(i[2]))),a=i.mul(r).xyz;we.assign(n),st.assign(a),this.instanceColorNode!==null&&it("vec3","vInstanceColor").assign(this.instanceColorNode)}}const Kd=T(Fr);A("InstanceNode",Fr);class de extends P{constructor(e=de.LOCAL){super(),this.scope=e}getHash(){return`tangent-${this.scope}`}getNodeType(){return this.scope===de.GEOMETRY?"vec4":"vec3"}generate(e){const t=this.scope;let s=null;if(t===de.GEOMETRY)s=Se("tangent","vec4"),e.geometry.hasAttribute("tangent")===!1&&e.geometry.computeTangents();else if(t===de.LOCAL)s=re(Xs.xyz);else if(t===de.VIEW){const n=It.mul(O(mn,0)).xyz;s=Ae(re(n))}else if(t===de.WORLD){const n=fn.transformDirection(Nt);s=Ae(re(n))}return s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}de.GEOMETRY="geometry";de.LOCAL="local";de.VIEW="view";de.WORLD="world";const Xs=_(de,de.GEOMETRY),mn=_(de,de.LOCAL),fn=_(de,de.VIEW),Jd=_(de,de.WORLD),Br=xs(fn,"TransformedTangentView");Ae(Br.transformDirection(Nt));A("TangentNode",de);class Ur extends P{constructor(e){super("void"),this.batchMesh=e,this.instanceColorNode=null,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(this.batchingIdNode=Se("batchId"));const t=this.batchMesh._matricesTexture,s=Ro(Et(t),0),n=h(p(this.batchingIdNode)).mul(4).toVar(),i=p(n.mod(s)),r=p(n).div(p(s)),a=qt(Et(t,Ct(i,r)),Et(t,Ct(i.add(1),r)),Et(t,Ct(i.add(2),r)),Et(t,Ct(i.add(3),r))),c=et(a[0].xyz,a[1].xyz,a[2].xyz);we.assign(a.mul(we));const l=st.div(g(c[0].dot(c[0]),c[1].dot(c[1]),c[2].dot(c[2]))),u=c.mul(l).xyz;st.assign(u),e.hasGeometryAttribute("tangent")&&mn.mulAssign(c)}}const Qd=T(Ur);A("batch",Ur);class kr extends P{constructor(e,t=!1){super("void"),this.skinnedMesh=e,this.useReference=t,this.updateType=J.OBJECT,this.skinIndexNode=Se("skinIndex","uvec4"),this.skinWeightNode=Se("skinWeight","vec4");let s,n,i;t?(s=tt("bindMatrix","mat4"),n=tt("bindMatrixInverse","mat4"),i=vd("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(s=Q(e.bindMatrix,"mat4"),n=Q(e.bindMatrixInverse,"mat4"),i=Co(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=s,this.bindMatrixInverseNode=n,this.boneMatricesNode=i}setup(e){const{skinIndexNode:t,skinWeightNode:s,bindMatrixNode:n,bindMatrixInverseNode:i,boneMatricesNode:r}=this,a=r.element(t.x),c=r.element(t.y),l=r.element(t.z),u=r.element(t.w),d=n.mul(we),m=Be(a.mul(s.x).mul(d),c.mul(s.y).mul(d),l.mul(s.z).mul(d),u.mul(s.w).mul(d)),v=i.mul(m).xyz;let S=Be(s.x.mul(a),s.y.mul(c),s.z.mul(l),s.w.mul(u));S=i.mul(S).mul(n);const x=S.transformDirection(st).xyz;we.assign(v),st.assign(x),e.hasGeometryAttribute("tangent")&&mn.assign(x)}generate(e,t){if(t!=="void")return we.build(e,t)}update(e){(this.useReference?e.object:this.skinnedMesh).skeleton.update()}}const eh=o=>R(new kr(o,!0));A("SkinningNode",kr);class Gr extends P{constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const s={};for(let n=0,i=this.params.length-1;n<i;n++){const r=this.params[n],a=r.isNode!==!0&&r.name||this.getVarName(n),c=r.isNode!==!0&&r.type||"int";s[a]=dn(a,c)}return t.returnsNode=this.params[this.params.length-1](s,e.addStack(),e),t.stackNode=e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),s={tempWrite:!1},n=this.params,i=t.stackNode;for(let c=0,l=n.length-1;c<l;c++){const u=n[c];let d=null,m=null,v=null,S=null,x=null,y=null;u.isNode?(S="int",v=this.getVarName(c),d="0",m=u.build(e,S),x="<"):(S=u.type||"int",v=u.name||this.getVarName(c),d=u.start,m=u.end,x=u.condition,y=u.update,typeof d=="number"?d=d.toString():d&&d.isNode&&(d=d.build(e,S)),typeof m=="number"?m=m.toString():m&&m.isNode&&(m=m.build(e,S)),d!==void 0&&m===void 0?(d=d+" - 1",m="0",x=">="):m!==void 0&&d===void 0&&(d="0",x="<"),x===void 0&&(Number(d)>Number(m)?x=">=":x="<"));const M={start:d,end:m,condition:x},L=M.start,I=M.end;let D="",F="",b="";y||(S==="int"||S==="uint"?x.includes("<")?y="++":y="--":x.includes("<")?y="+= 1.":y="-= 1."),D+=e.getVar(S,v)+" = "+L,F+=v+" "+x+" "+I,b+=v+" "+y;const B=`for ( ${D}; ${F}; ${b} )`;e.addFlowCode((c===0?`
`:"")+e.tab+B+` {

`).addFlowTab()}const r=ft(i,s).build(e,"void"),a=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+r);for(let c=0,l=this.params.length-1;c<l;c++)e.addFlowCode((c===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),a}}const te=(...o)=>R(new Gr(Ht(o,"int"))).append(),th=()=>dn("break").append();N("loop",(o,...e)=>er(o,te(...e)));A("LoopNode",Gr);const Mn=new WeakMap,ze=new St,ci=w(({bufferMap:o,influence:e,stride:t,width:s,depth:n,offset:i})=>{const r=p(pu).mul(t).add(i),a=r.div(s),c=r.sub(a.mul(s));return Et(o,Ct(c,a)).depth(n).mul(e)});function sh(o){const e=o.morphAttributes.position!==void 0,t=o.morphAttributes.normal!==void 0,s=o.morphAttributes.color!==void 0,n=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,i=n!==void 0?n.length:0;let r=Mn.get(o);if(r===void 0||r.count!==i){let M=function(){x.dispose(),Mn.delete(o),o.removeEventListener("dispose",M)};r!==void 0&&r.texture.dispose();const a=o.morphAttributes.position||[],c=o.morphAttributes.normal||[],l=o.morphAttributes.color||[];let u=0;e===!0&&(u=1),t===!0&&(u=2),s===!0&&(u=3);let d=o.attributes.position.count*u,m=1;const v=4096;d>v&&(m=Math.ceil(d/v),d=v);const S=new Float32Array(d*m*4*i),x=new jc(S,d,m,i);x.type=Xc,x.needsUpdate=!0;const y=u*4;for(let L=0;L<i;L++){const I=a[L],D=c[L],F=l[L],b=d*m*4*L;for(let B=0;B<I.count;B++){const $=B*y;e===!0&&(ze.fromBufferAttribute(I,B),S[b+$+0]=ze.x,S[b+$+1]=ze.y,S[b+$+2]=ze.z,S[b+$+3]=0),t===!0&&(ze.fromBufferAttribute(D,B),S[b+$+4]=ze.x,S[b+$+5]=ze.y,S[b+$+6]=ze.z,S[b+$+7]=0),s===!0&&(ze.fromBufferAttribute(F,B),S[b+$+8]=ze.x,S[b+$+9]=ze.y,S[b+$+10]=ze.z,S[b+$+11]=F.itemSize===4?ze.w:1)}}r={count:i,texture:x,stride:u,size:new $e(d,m)},Mn.set(o,r),o.addEventListener("dispose",M)}return r}class Wr extends P{constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Q(1),this.updateType=J.OBJECT}setup(e){const{geometry:t}=e,s=t.morphAttributes.position!==void 0,n=t.morphAttributes.normal!==void 0,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,r=i!==void 0?i.length:0,{texture:a,stride:c,size:l}=sh(t);s===!0&&we.mulAssign(this.morphBaseInfluence),n===!0&&st.mulAssign(this.morphBaseInfluence);const u=p(l.width);te(r,({i:d})=>{const m=h(0).toVar();this.mesh.isInstancedMesh===!0&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?m.assign(Et(this.mesh.morphTexture,Ct(p(d).add(1),p(sr))).r):m.assign(tt("morphTargetInfluences","float").element(d).toVar()),s===!0&&we.addAssign(ci({bufferMap:a,influence:m,stride:c,width:u,depth:d,offset:p(0)})),n===!0&&st.addAssign(ci({bufferMap:a,influence:m,stride:c,width:u,depth:d,offset:p(1)}))})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,s)=>t+s,0)}}const nh=T(Wr);A("MorphNode",Wr);class Hr extends P{constructor(){super("vec3")}getHash(){return"reflectVector"}setup(){return ie.negate().reflect(ae).transformDirection(Nt)}}const oh=_(Hr);A("ReflectVectorNode",Hr);class qr extends ss{constructor(e,t=null,s=null){super(e,t,s),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){return oh}setUpdateMatrix(){}setupUV(e,t){const s=this.value;return e.renderer.coordinateSystem===zi||!s.isRenderTargetTexture?g(t.x.negate(),t.yz):t}generateUV(e,t){return t.build(e,"vec3")}}const $r=T(qr);N("cubeTexture",$r);A("CubeTextureNode",qr);class _s extends P{constructor(){super("vec3")}generate(){console.warn("Abstract function.")}}A("LightingNode",_s);let ls=null;class Pt extends _s{constructor(e=null){super(),this.updateType=J.FRAME,this.light=e,this.rtt=null,this.shadowNode=null,this.shadowMaskNode=null,this.color=new en,this._defaultColorNode=Q(this.color),this.colorNode=this._defaultColorNode,this.isAnalyticLightNode=!0}getCacheKey(){return super.getCacheKey()+"-"+(this.light.id+"-"+(this.light.castShadow?"1":"0"))}getHash(){return this.light.uuid}setupShadow(e){const{object:t}=e;if(t.receiveShadow===!1)return;let s=this.shadowNode;if(s===null){ls===null&&(ls=e.createNodeMaterial(),ls.fragmentNode=O(0,0,0,1),ls.isShadowNodeMaterial=!0);const n=this.light.shadow,i=e.createRenderTarget(n.mapSize.width,n.mapSize.height),r=new fo;r.minFilter=ko,r.magFilter=ko,r.image.width=n.mapSize.width,r.image.height=n.mapSize.height,r.compareFunction=Yc,i.depthTexture=r,n.camera.updateProjectionMatrix();const a=tt("bias","float",n),c=tt("normalBias","float",n),l=t.material.shadowPositionNode||no;let u=Q(n.matrix).mul(l.add(Lr.mul(c)));u=u.xyz.div(u.w);const d=u.x.greaterThanEqual(0).and(u.x.lessThanEqual(1)).and(u.y.greaterThanEqual(0)).and(u.y.lessThanEqual(1)).and(u.z.lessThanEqual(1));let m=u.z.add(a);e.renderer.coordinateSystem===zi&&(m=m.mul(2).sub(1)),u=g(u.x,u.y.oneMinus(),m),s=((y,M,L)=>Fe(y,M).compare(L))(r,u.xy,u.z);const S=Fe(i.texture,u),x=d.mix(1,s.mix(S.a.mix(1,S),1));this.rtt=i,this.colorNode=this.colorNode.mul(x),this.shadowNode=s,this.shadowMaskNode=x,this.updateBeforeType=J.RENDER}}setup(e){this.light.castShadow?this.setupShadow(e):this.shadowNode!==null&&this.disposeShadow()}updateShadow(e){const{rtt:t,light:s}=this,{renderer:n,scene:i}=e,r=i.overrideMaterial;i.overrideMaterial=ls,t.setSize(s.shadow.mapSize.width,s.shadow.mapSize.height),s.shadow.updateMatrices(s);const a=n.toneMapping,c=n.getRenderTarget(),l=n.getRenderObjectFunction();n.setRenderObjectFunction((u,...d)=>{u.castShadow===!0&&n.renderObject(u,...d)}),n.setRenderTarget(t),n.toneMapping=Bs,n.render(i,s.shadow.camera),n.setRenderTarget(c),n.setRenderObjectFunction(l),n.toneMapping=a,i.overrideMaterial=r}disposeShadow(){this.rtt.dispose(),this.shadowNode=null,this.shadowMaskNode=null,this.rtt=null,this.colorNode=this._defaultColorNode}updateBefore(e){const{light:t}=this;t.castShadow&&this.updateShadow(e)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}A("AnalyticLightNode",Pt);const Ys=new WeakMap,ih=o=>o.sort((e,t)=>e.id-t.id);class rh extends P{constructor(e=[]){super("vec3"),this.totalDiffuseNode=g().temp("totalDiffuse"),this.totalSpecularNode=g().temp("totalSpecular"),this.outgoingLightNode=g().temp("outgoingLight"),this.lightNodes=e,this._hash=null}get hasLight(){return this.lightNodes.length>0}getHash(){if(this._hash===null){const e=[];for(const t of this.lightNodes)e.push(t.getHash());this._hash="lights-"+e.join(",")}return this._hash}setup(e){const t=e.context,s=t.lightingModel;let n=this.outgoingLightNode;if(s){const{lightNodes:i,totalDiffuseNode:r,totalSpecularNode:a}=this;t.outgoingLight=n;const c=e.addStack();s.start(t,c,e);for(const y of i)y.build(e);s.indirectDiffuse(t,c,e),s.indirectSpecular(t,c,e),s.ambientOcclusion(t,c,e);const{backdrop:l,backdropAlpha:u}=t,{directDiffuse:d,directSpecular:m,indirectDiffuse:v,indirectSpecular:S}=t.reflectedLight;let x=d.add(v);l!==null&&(u!==null?x=g(u.mix(x,l)):x=g(l),t.material.transparent=!0),r.assign(x),a.assign(m.add(S)),n.assign(r.add(a)),s.finish(t,c,e),n=n.bypass(e.removeStack())}return n}_getLightNodeById(e){for(const t of this.lightNodes)if(t.isAnalyticLightNode&&t.light.id===e)return t;return null}fromLights(e=[]){const t=[];e=ih(e);for(const s of e){let n=this._getLightNodeById(s.id);if(n===null){const i=s.constructor,r=Ys.has(i)?Ys.get(i):Pt;n=R(new r(s))}t.push(n)}return this.lightNodes=t,this._hash=null,this}}const ah=T(rh);function os(o,e){if(Ys.has(o)){console.warn(`Redefinition of light node ${e.type}`);return}if(typeof o!="function")throw new Error(`Light ${o.name} is not a class`);if(typeof e!="function"||!e.type)throw new Error(`Light node ${e.type} is not a class`);Ys.set(o,e)}class jr extends _s{constructor(e=null){super(),this.aoNode=e}setup(e){const s=this.aoNode.x.sub(1).mul(1).add(1);e.context.ambientOcclusion.mulAssign(s)}}A("AONode",jr);class Xr extends So{constructor(e,t=null,s=null,n=null){super(e),this.lightingModel=t,this.backdropNode=s,this.backdropAlphaNode=n,this._context=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,s=g().temp("directDiffuse"),n=g().temp("directSpecular"),i=g().temp("indirectDiffuse"),r=g().temp("indirectSpecular"),a={directDiffuse:s,directSpecular:n,indirectDiffuse:i,indirectSpecular:r};return{radiance:g().temp("radiance"),irradiance:g().temp("irradiance"),iblIrradiance:g().temp("iblIrradiance"),ambientOcclusion:h(1).temp("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.context=this._context||(this._context=this.getContext()),this.context.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const Yr=T(Xr);N("lightingContext",Yr);A("LightingContextNode",Xr);class pe extends P{constructor(e=pe.LOCAL){super("vec3"),this.scope=e}getHash(){return`bitangent-${this.scope}`}generate(e){const t=this.scope;let s;t===pe.GEOMETRY?s=js.cross(Xs):t===pe.LOCAL?s=st.cross(mn):t===pe.VIEW?s=Vt.cross(fn):t===pe.WORLD&&(s=Lr.cross(Jd));const n=s.mul(Xs.w).xyz;return Ae(re(n)).build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}pe.GEOMETRY="geometry";pe.LOCAL="local";pe.VIEW="view";pe.WORLD="world";_(pe,pe.GEOMETRY);_(pe,pe.LOCAL);const ch=_(pe,pe.VIEW);_(pe,pe.WORLD);const lh=Ae(ae.cross(Br).mul(Xs.w));Ae(lh.transformDirection(Nt));A("BitangentNode",pe);const Wt=et(fn,ch,Vt);ie.mul(Wt);const uh=(()=>{let o=$t.cross(ie);return o=o.cross($t).normalize(),o=Te(o,ae,Rt.mul(vt.oneMinus()).oneMinus().pow2().pow2()).normalize(),o})();class Lo extends P{constructor(e,t,s=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=s}getNodeType(e){const t=this.ifNode.getNodeType(e);if(this.elseNode!==null){const s=this.elseNode.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(t))return s}return t}generate(e,t){const s=this.getNodeType(e),n={tempWrite:!1},i=e.getDataFromNode(this);if(i.nodeProperty!==void 0)return i.nodeProperty;const{ifNode:r,elseNode:a}=this,c=t!=="void",l=c?Ne(s).build(e):"";i.nodeProperty=l;const u=ft(this.condNode).build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${u} ) {

`).addFlowTab();let d=ft(r,n).build(e,s);if(d&&(c?d=l+" = "+d+";":d="return "+d+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+d+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let m=ft(a,n).build(e,s);m&&(c?m=l+" = "+m+";":m="return "+m+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+m+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(l,s,t)}}const Pe=T(Lo);N("cond",Pe);A("CondNode",Lo);const li=h(1),oo=h(-2),Es=h(.8),Rn=h(-1),Cs=h(.4),En=h(2),Ls=h(.305),Cn=h(3),ui=h(.21),dh=h(4),di=h(4),hh=h(16),ph=w(([o])=>{const e=g(ue(o)).toVar(),t=h(-1).toVar();return H(e.x.greaterThan(e.z),()=>{H(e.x.greaterThan(e.y),()=>{t.assign(Pe(o.x.greaterThan(0),0,3))}).else(()=>{t.assign(Pe(o.y.greaterThan(0),1,4))})}).else(()=>{H(e.z.greaterThan(e.y),()=>{t.assign(Pe(o.z.greaterThan(0),2,5))}).else(()=>{t.assign(Pe(o.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),mh=w(([o,e])=>{const t=z().toVar();return H(e.equal(0),()=>{t.assign(z(o.z,o.y).div(ue(o.x)))}).elseif(e.equal(1),()=>{t.assign(z(o.x.negate(),o.z.negate()).div(ue(o.y)))}).elseif(e.equal(2),()=>{t.assign(z(o.x.negate(),o.y).div(ue(o.z)))}).elseif(e.equal(3),()=>{t.assign(z(o.z.negate(),o.y).div(ue(o.x)))}).elseif(e.equal(4),()=>{t.assign(z(o.x.negate(),o.z).div(ue(o.y)))}).else(()=>{t.assign(z(o.x,o.y).div(ue(o.z)))}),q(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),fh=w(([o])=>{const e=h(0).toVar();return H(o.greaterThanEqual(Es),()=>{e.assign(li.sub(o).mul(Rn.sub(oo)).div(li.sub(Es)).add(oo))}).elseif(o.greaterThanEqual(Cs),()=>{e.assign(Es.sub(o).mul(En.sub(Rn)).div(Es.sub(Cs)).add(Rn))}).elseif(o.greaterThanEqual(Ls),()=>{e.assign(Cs.sub(o).mul(Cn.sub(En)).div(Cs.sub(Ls)).add(En))}).elseif(o.greaterThanEqual(ui),()=>{e.assign(Ls.sub(o).mul(dh.sub(Cn)).div(Ls.sub(ui)).add(Cn))}).else(()=>{e.assign(h(-2).mul(ln(q(1.16,o))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]});w(([o,e])=>{const t=o.toVar();t.assign(q(2,t).sub(1));const s=g(t,1).toVar();return H(e.equal(0),()=>{s.assign(s.zyx)}).elseif(e.equal(1),()=>{s.assign(s.xzy),s.xz.mulAssign(-1)}).elseif(e.equal(2),()=>{s.x.mulAssign(-1)}).elseif(e.equal(3),()=>{s.assign(s.zyx),s.xz.mulAssign(-1)}).elseif(e.equal(4),()=>{s.assign(s.xzy),s.xy.mulAssign(-1)}).elseif(e.equal(5),()=>{s.z.mulAssign(-1)}),s}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]});const gh=w(([o,e,t,s,n,i])=>{const r=h(t),a=g(e),c=Jt(fh(r),oo,i),l=un(c),u=es(c),d=g(io(o,a,u,s,n,i)).toVar();return H(l.notEqual(0),()=>{const m=g(io(o,a,u.add(1),s,n,i)).toVar();d.assign(Te(d,m,l))}),d}),io=w(([o,e,t,s,n,i])=>{const r=h(t).toVar(),a=g(e),c=h(ph(a)).toVar(),l=h(Ue(di.sub(r),0)).toVar();r.assign(Ue(r,di));const u=h(Qn(r)).toVar(),d=z(mh(a,c).mul(u.sub(2)).add(1)).toVar();return H(c.greaterThan(2),()=>{d.y.addAssign(u),c.subAssign(3)}),d.x.addAssign(c.mul(u)),d.x.addAssign(l.mul(q(3,hh))),d.y.addAssign(q(4,Qn(i).sub(u))),d.x.mulAssign(s),d.y.mulAssign(n),o.uv(d).grad(z(),z())}),Ln=w(({envMap:o,mipInt:e,outputDirection:t,theta:s,axis:n,CUBEUV_TEXEL_WIDTH:i,CUBEUV_TEXEL_HEIGHT:r,CUBEUV_MAX_MIP:a})=>{const c=xt(s),l=t.mul(c).add(n.cross(t).mul(mt(s))).add(n.mul(n.dot(t).mul(c.oneMinus())));return io(o,l,e,i,r,a)});w(({n:o,latitudinal:e,poleAxis:t,outputDirection:s,weights:n,samples:i,dTheta:r,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d})=>{const m=g(Pe(e,t,xr(t,s))).toVar();H(mr(m.equals(g(0))),()=>{m.assign(g(s.z,0,s.x.negate()))}),m.assign(Ae(m));const v=g().toVar();return v.addAssign(n.element(p(0)).mul(Ln({theta:0,axis:m,outputDirection:s,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d}))),te({start:p(1),end:o},({i:S})=>{H(S.greaterThanEqual(i),()=>{th()});const x=h(r.mul(h(S))).toVar();v.addAssign(n.element(S).mul(Ln({theta:x.mul(-1),axis:m,outputDirection:s,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d}))),v.addAssign(n.element(S).mul(Ln({theta:x,axis:m,outputDirection:s,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:d})))}),O(v,1)});let Zs=null;const hi=new WeakMap;function Nh(o){const e=Math.log2(o)-2,t=1/o;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:t,maxMip:e}}function yh(o){let e=hi.get(o);if((e!==void 0?e.pmremVersion:-1)!==o.pmremVersion){if(o.isCubeTexture){if(o.source.data.some(s=>s===void 0))throw new Error("PMREMNode: Undefined texture in CubeTexture. Use onLoad callback or async loader");e=Zs.fromCubemap(o,e)}else{if(o.image===void 0)throw new Error("PMREMNode: Undefined image in Texture. Use onLoad callback or async loader");e=Zs.fromEquirectangular(o,e)}e.pmremVersion=o.pmremVersion,hi.set(o,e)}return e.texture}class Zr extends ee{constructor(e,t=null,s=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=s,this._generator=null,this._texture=Fe(null),this._width=Q(0),this._height=Q(0),this._maxMip=Q(0),this.updateBeforeType=J.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=Nh(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(){let e=this._pmrem;const t=e?e.pmremVersion:-1,s=this._value;t!==s.pmremVersion&&(s.isPMREMTexture===!0?e=s:e=yh(s),this._pmrem=e,this.updateFromTexture(e))}setup(e){Zs===null&&(Zs=e.createPMREMGenerator()),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this));const s=this.value;e.renderer.coordinateSystem===Di&&s.isPMREMTexture!==!0&&s.isRenderTargetTexture===!0&&(t=g(t.x.negate(),t.yz));let n=this.levelNode;return n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),gh(this._texture,t,n,this._width,this._height,this._maxMip)}}const xh=T(Zr);A("PMREMNode",Zr);const pi=new WeakMap;class Kr extends _s{constructor(e=null){super(),this.envNode=e}setup(e){let t=this.envNode;if(t.isTextureNode){let m=pi.get(t.value);m===void 0&&(m=xh(t.value),pi.set(t.value,m)),t=m}const{material:s}=e,i=s.envMap?tt("envMapIntensity","float",e.material):tt("environmentIntensity","float",e.scene),a=s.useAnisotropy===!0||s.anisotropy>0?uh:ae,c=ft(t,mi(vt,a)).mul(i),l=ft(t,Th(br)).mul(Math.PI).mul(i),u=Gs(c);e.context.radiance.addAssign(u),e.context.iblIrradiance.addAssign(l);const d=e.context.lightingModel.clearcoatRadiance;if(d){const m=ft(t,mi(Hs,Gt)).mul(i),v=Gs(m);d.addAssign(v)}}}const mi=(o,e)=>{let t=null;return{getUV:()=>(t===null&&(t=ie.negate().reflect(e),t=o.mul(o).mix(t,e).normalize(),t=t.transformDirection(Nt)),t),getTextureLevel:()=>o}},Th=o=>({getUV:()=>o,getTextureLevel:()=>h(1)});A("EnvironmentNode",Kr);class Jr extends _s{constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}A("IrradianceNode",Jr);let bn,In;class j extends P{constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===j.VIEWPORT?"vec4":this.scope===j.COORDINATE?"vec3":"vec2"}getUpdateType(){let e=J.NONE;return(this.scope===j.RESOLUTION||this.scope===j.VIEWPORT)&&(e=J.FRAME),this.updateType=e,e}update({renderer:e}){this.scope===j.VIEWPORT?e.getViewport(In):e.getDrawingBufferSize(bn)}setup(){const e=this.scope;let t=null;if(e===j.RESOLUTION)t=Q(bn||(bn=new $e));else if(e===j.VIEWPORT)t=Q(In||(In=new St));else{t=vh.div(ro);let s=t.x,n=t.y;/bottom/i.test(e)&&(n=n.oneMinus()),/right/i.test(e)&&(s=s.oneMinus()),t=z(s,n)}return t}generate(e){if(this.scope===j.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const s=e.getNodeProperties(ro).outputNode.build(e);t=`${e.getType("vec3")}( ${t}.x, ${s}.y - ${t}.y, ${t}.z )`}return t}return super.generate(e)}}j.COORDINATE="coordinate";j.RESOLUTION="resolution";j.VIEWPORT="viewport";j.TOP_LEFT="topLeft";j.BOTTOM_LEFT="bottomLeft";j.TOP_RIGHT="topRight";j.BOTTOM_RIGHT="bottomRight";const vh=_(j,j.COORDINATE),ro=_(j,j.RESOLUTION),Xt=_(j,j.VIEWPORT),Ss=_(j,j.TOP_LEFT);_(j,j.BOTTOM_LEFT);_(j,j.TOP_RIGHT);_(j,j.BOTTOM_RIGHT);A("ViewportNode",j);const us=new $e;class Ms extends ss{constructor(e=Ss,t=null,s=null){s===null&&(s=new Pi,s.minFilter=Zc),super(s,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=J.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(us);const s=this.value;(s.image.width!==us.width||s.image.height!==us.height)&&(s.image.width=us.width,s.image.height=us.height,s.needsUpdate=!0);const n=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(s),s.generateMipmaps=n}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const Sh=T(Ms),Qr=T(Ms,null,null,{generateMipmaps:!0});N("viewportTexture",Sh);N("viewportMipTexture",Qr);A("ViewportTextureNode",Ms);let On=null;class ea extends Ms{constructor(e=Ss,t=null){On===null&&(On=new fo),super(e,t,On)}}const ta=T(ea);N("viewportDepthTexture",ta);A("ViewportDepthTextureNode",ea);class ye extends P{constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===ye.DEPTH_PIXEL?e.getFragDepth():super.generate(e)}setup(){const{scope:e}=this;let t=null;if(e===ye.DEPTH)t=ao(De.z,Vn,An);else if(e===ye.DEPTH_TEXTURE){const s=this.valueNode||ta(),n=sa(s,Vn,An);t=ao(n,Vn,An)}else e===ye.DEPTH_PIXEL&&this.valueNode!==null&&(t=na().assign(this.valueNode));return t}}const ao=(o,e,t)=>o.add(e).div(e.sub(t)),sa=(o,e,t)=>e.mul(t).div(t.sub(e).mul(o).sub(t));ye.DEPTH="depth";ye.DEPTH_TEXTURE="depthTexture";ye.DEPTH_PIXEL="depthPixel";const na=T(ye,ye.DEPTH_PIXEL);_(ye,ye.DEPTH);T(ye,ye.DEPTH_TEXTURE);const oa=_(ye,ye.DEPTH_PIXEL);oa.assign=o=>na(o);A("ViewportDepthNode",ye);class At extends P{constructor(e=At.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{localClipIntersection:s,localClippingCount:n,globalClippingCount:i}=t,r=i+n,a=s?r-n:r;return this.scope===At.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(t.planes,r,a):this.setupDefault(t.planes,r,a)}setupAlphaToCoverage(e,t,s){return w(()=>{const n=eo(e),i=Ne("float","distanceToPlane"),r=Ne("float","distanceToGradient"),a=Ne("float","clipOpacity");a.assign(1);let c;if(te(s,({i:l})=>{c=n.element(l),i.assign(De.dot(c.xyz).negate().add(c.w)),r.assign(i.fwidth().div(2)),a.mulAssign(gt(r.negate(),r,i)),a.equal(0).discard()}),s<t){const l=Ne("float","unionclipOpacity");l.assign(1),te({start:s,end:t},({i:u})=>{c=n.element(u),i.assign(De.dot(c.xyz).negate().add(c.w)),r.assign(i.fwidth().div(2)),l.mulAssign(gt(r.negate(),r,i).oneMinus())}),a.mulAssign(l.oneMinus())}oe.a.mulAssign(a),oe.a.equal(0).discard()})()}setupDefault(e,t,s){return w(()=>{const n=eo(e);let i;if(te(s,({i:r})=>{i=n.element(r),De.dot(i.xyz).greaterThan(i.w).discard()}),s<t){const r=Ne("bool","clipped");r.assign(!0),te({start:s,end:t},({i:a})=>{i=n.element(a),r.assign(De.dot(i.xyz).greaterThan(i.w).and(r))}),r.discard()}})()}}At.ALPHA_TO_COVERAGE="alphaToCoverage";At.DEFAULT="default";const wh=()=>R(new At),Vh=()=>R(new At(At.ALPHA_TO_COVERAGE));class ia extends P{constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:t,material:s}=e;return t.coordinateSystem===Di&&s.side===Kc?"false":e.getFrontFacing()}}const Ah=_(ia),Ks=h(Ah).mul(2).sub(1);A("FrontFacingNode",ia);const co=new Map;class ke extends Jc{constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.type,this.forceSinglePass=!1,this.fog=!0,this.lights=!0,this.normals=!0,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.depthNode=null,this.shadowNode=null,this.shadowPositionNode=null,this.outputNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+Gi(this)}build(e){this.setup(e)}setup(e){e.addStack(),e.stack.outputNode=this.vertexNode||this.setupPosition(e),e.addFlow("vertex",e.removeStack()),e.addStack();let t;const s=this.setupClipping(e);if(this.depthWrite===!0&&this.setupDepth(e),this.fragmentNode===null){this.normals===!0&&this.setupNormal(e),this.setupDiffuseColor(e),this.setupVariants(e);const n=this.setupLighting(e);s!==null&&e.stack.add(s);const i=O(n,oe.a).max(0);t=this.setupOutput(e,i),mu.assign(t),this.outputNode!==null&&(t=this.outputNode)}else{let n=this.fragmentNode;n.isOutputStructNode!==!0&&(n=O(n)),t=this.setupOutput(e,n)}e.stack.outputNode=t,e.addFlow("fragment",e.removeStack())}setupClipping(e){if(e.clippingContext===null)return null;const{globalClippingCount:t,localClippingCount:s}=e.clippingContext;let n=null;return(t||s)&&(this.alphaToCoverage?n=Vh():e.stack.add(wh())),n}setupDepth(e){const{renderer:t}=e;let s=this.depthNode;s===null&&t.logarithmicDepthBuffer===!0&&(s=ii().w.add(1).log2().mul(Sd).mul(.5)),s!==null&&oa.assign(s).append()}setupPosition(e){const{object:t}=e,s=t.geometry;e.addStack(),(s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color)&&nh(t).append(),t.isSkinnedMesh===!0&&eh(t).append(),t.isBatchedMesh&&Qd(t).append(),t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&e.isAvailable("instance")===!0&&Kd(t).append(),this.positionNode!==null&&we.assign(this.positionNode);const n=ii();return e.context.vertex=e.removeStack(),e.context.mvp=n,n}setupDiffuseColor({object:e,geometry:t}){let s=this.colorNode?O(this.colorNode):vs;this.vertexColors===!0&&t.hasAttribute("color")&&(s=O(s.xyz.mul(Se("color","vec3")),s.a)),e.instanceColor&&(s=it("vec3","vInstanceColor").mul(s)),oe.assign(s);const n=this.opacityNode?h(this.opacityNode):Ir;if(oe.a.assign(oe.a.mul(n)),this.alphaTestNode!==null||this.alphaTest>0){const i=this.alphaTestNode!==null?h(this.alphaTestNode):Vd;oe.a.lessThanEqual(i).discard()}}setupVariants(){}setupNormal(){if(this.flatShading===!0){const e=De.dFdx().cross(De.dFdy()).normalize();ae.assign(e.mul(Ks))}else{const e=this.normalNode?g(this.normalNode):bd;ae.assign(e.mul(Ks))}}getEnvNode(e){let t=null;return this.envNode?t=this.envNode:this.envMap?t=this.envMap.isCubeTexture?$r(this.envMap):Fe(this.envMap):e.environmentNode&&(t=e.environmentNode),t}setupLights(e){const t=this.getEnvNode(e),s=[];if(t&&s.push(new Kr(t)),e.material.lightMap&&s.push(new Jr(Rr("lightMap","texture"))),this.aoNode!==null||e.material.aoMap){const i=this.aoNode!==null?this.aoNode:Fe(e.material.aoMap);s.push(new jr(i))}let n=this.lightsNode||e.lightsNode;return s.length>0&&(n=ah([...n.lightNodes,...s])),n}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:s,backdropAlphaNode:n,emissiveNode:i}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=oe.rgb;if(a&&a.hasLight!==!1){const l=this.setupLightingModel(e);c=Yr(a,l,s,n)}else s!==null&&(c=g(n!==null?Te(c,s,n):s));return(i&&i.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(c=c.add(g(i||_d))),c}setupOutput(e,t){const s=e.fogNode;return s&&(t=O(s.mix(t.rgb,s.colorNode),t.a)),t}setDefaultValues(e){for(const s in e){const n=e[s];this[s]===void 0&&(this[s]=n,n&&n.clone&&(this[s]=n.clone()))}Object.assign(this.defines,e.defines);const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const s in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,s)===void 0&&t[s].get!==void 0&&Object.defineProperty(this.constructor.prototype,s,t[s])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const s=Hn.prototype.toJSON.call(this,e),n=ks(this);s.inputNodes={};for(const{property:r,childNode:a}of n)s.inputNodes[r]=a.toJSON(e).uuid;function i(r){const a=[];for(const c in r){const l=r[c];delete l.metadata,a.push(l)}return a}if(t){const r=i(e.textures),a=i(e.images),c=i(e.nodes);r.length>0&&(s.textures=r),a.length>0&&(s.images=a),c.length>0&&(s.nodes=c)}return s}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.depthNode=e.depthNode,this.shadowNode=e.shadowNode,this.shadowPositionNode=e.shadowPositionNode,this.outputNode=e.outputNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}static fromMaterial(e){if(e.isNodeMaterial===!0)return e;const t=e.type.replace("Material","NodeMaterial"),s=_h(t);if(s===void 0)throw new Error(`NodeMaterial: Material "${e.type}" is not compatible.`);for(const n in e)s[n]=e[n];return s}}function _e(o,e){if(typeof e!="function"||!o)throw new Error(`Node material ${o} is not a class`);if(co.has(o)){console.warn(`Redefinition of node material ${o}`);return}co.set(o,e),e.type=o}function _h(o){const e=co.get(o);if(e!==void 0)return new e}_e("NodeMaterial",ke);class ra extends P{constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}if(e,t){const s=new gs(t);return this._currentCond=Pe(e,s),this.add(this._currentCond)}elseif(e,t){const s=new gs(t),n=Pe(e,s);return this._currentCond.elseNode=n,this._currentCond=n,this}else(e){return this._currentCond.elseNode=new gs(e),this}build(e,...t){const s=Ul();Qo(this);for(const n of this.nodes)n.build(e,"void");return Qo(s),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}}T(ra);A("StackNode",ra);class aa extends ee{constructor(e=Yd){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan2(e.x).mul(1/(Math.PI*2)).add(.5),s=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return z(t,s)}}T(aa);A("EquirectUVNode",aa);class ca extends P{constructor(e){super(),this.types=e,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}A("StructTypeNode",ca);class la extends P{constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}setup(e){super.setup(e);const t=this.members,s=[];for(let n=0;n<t.length;n++)s.push(t[n].getNodeType(e));this.nodeType=e.getStructTypeFromNode(new ca(s)).name}generate(e,t){const s=e.getVarFromNode(this);s.isOutputStructVar=!0;const n=e.getPropertyName(s),i=this.members,r=n!==""?n+".":"";for(let a=0;a<i.length;a++){const c=i[a].build(e,t);e.addLineFlowCode(`${r}m${a} = ${c}`)}return n}}T(la);A("OutputStructNode",la);class ua extends P{constructor(e){super(),this.seedNode=e}setup(){const e=this.seedNode.uint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).float().mul(1/2**32)}}const Mh=T(ua);N("hash",Mh);A("HashNode",ua);const lo=(o,e)=>ct(q(4,o.mul(le(1,o))),e),Rh=(o,e)=>o.lessThan(.5)?lo(o.mul(2),e).div(2):le(1,lo(q(le(1,o),2),e).div(2)),Eh=(o,e,t)=>ct(wt(ct(o,e),Be(ct(o,e),ct(le(1,o),t))),1/e),Ch=(o,e)=>mt(ei.mul(e.mul(o).sub(1))).div(ei.mul(e.mul(o).sub(1)));N("parabola",lo);N("gain",Rh);N("pcurve",Eh);N("sinc",Ch);const at=w(([o])=>o.fract().sub(.5).abs()),da=w(([o])=>g(at(o.z.add(at(o.y.mul(1)))),at(o.z.add(at(o.x.mul(1)))),at(o.y.add(at(o.x.mul(1)))))),Lh=w(([o,e,t])=>{const s=g(o).toVar(),n=h(1.4).toVar(),i=h(0).toVar(),r=g(s).toVar();return te({start:h(0),end:h(3),type:"float",condition:"<="},()=>{const a=g(da(r.mul(2))).toVar();s.addAssign(a.add(t.mul(h(.1).mul(e)))),r.mulAssign(1.8),n.mulAssign(1.5),s.mulAssign(1.2);const c=h(at(s.z.add(at(s.x.add(at(s.y)))))).toVar();i.addAssign(c.div(n)),r.addAssign(.14)}),i});at.setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]});da.setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]});Lh.setLayout({name:"triNoise3D",type:"float",inputs:[{name:"p",type:"vec3"},{name:"spd",type:"float"},{name:"time",type:"float"}]});let zn;class ha extends Lo{constructor(e){zn=zn||dn("discard"),super(e,zn)}}const bh=T(ha),Ih=o=>bh(o).append();N("discard",Ih);A("DiscardNode",ha);class pa extends P{constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFnCall=null}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(e){const t=this.parametersNodes;let s=this._candidateFnCall;if(s===null){let n=null,i=-1;for(const r of this.functionNodes){const c=r.shaderNode.layout;if(c===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const l=c.inputs;if(t.length===l.length){let u=0;for(let d=0;d<t.length;d++){const m=t[d],v=l[d];m.getNodeType(e)===v.type?u++:u=0}u>i&&(n=r,i=u)}}this._candidateFnCall=s=n(...t)}return s}}const Oh=T(pa),Xe=o=>(...e)=>Oh(o,...e);A("FunctionOverloadingNode",pa);class ma extends ee{constructor(){super("vec2")}setup(){const e=g(ie.z,0,ie.x.negate()).normalize(),t=ie.cross(e);return z(e.dot(ae),t.dot(ae)).mul(.495).add(.5)}}_(ma);A("MatcapUVNode",ma);class Ce extends zt{constructor(e=Ce.LOCAL,t=1,s=0){super(s),this.scope=e,this.scale=t,this.updateType=J.FRAME}update(e){const t=this.scope,s=this.scale;t===Ce.LOCAL?this.value+=e.deltaTime*s:t===Ce.DELTA?this.value=e.deltaTime*s:t===Ce.FRAME?this.value=e.frameId:this.value=e.time*s}serialize(e){super.serialize(e),e.scope=this.scope,e.scale=this.scale}deserialize(e){super.deserialize(e),this.scope=e.scope,this.scale=e.scale}}Ce.LOCAL="local";Ce.GLOBAL="global";Ce.DELTA="delta";Ce.FRAME="frame";const zh=(o,e=0)=>R(new Ce(Ce.LOCAL,o,e));_(Ce,Ce.FRAME).uint();A("TimerNode",Ce);class me extends P{constructor(e=me.SINE,t=zh()){super(),this.method=e,this.timeNode=t}getNodeType(e){return this.timeNode.getNodeType(e)}setup(){const e=this.method,t=R(this.timeNode);let s=null;return e===me.SINE?s=t.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5):e===me.SQUARE?s=t.fract().round():e===me.TRIANGLE?s=t.add(.5).fract().mul(2).sub(1).abs():e===me.SAWTOOTH&&(s=t.fract()),s}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}me.SINE="sine";me.SQUARE="square";me.TRIANGLE="triangle";me.SAWTOOTH="sawtooth";T(me,me.SINE);T(me,me.SQUARE);T(me,me.TRIANGLE);T(me,me.SAWTOOTH);A("OscNode",me);class ut extends ee{constructor(e,t){super(),this.scope=e,this.node=t}getNodeType(e){return this.node.getNodeType(e)}setup(){const{scope:e,node:t}=this;let s=null;return e===ut.DIRECTION_TO_COLOR?s=t.mul(.5).add(.5):e===ut.COLOR_TO_DIRECTION&&(s=t.mul(2).sub(1)),s}}ut.DIRECTION_TO_COLOR="directionToColor";ut.COLOR_TO_DIRECTION="colorToDirection";const fa=T(ut,ut.DIRECTION_TO_COLOR),Dh=T(ut,ut.COLOR_TO_DIRECTION);N("directionToColor",fa);N("colorToDirection",Dh);A("PackingNode",ut);class bo extends P{constructor(e,t,s,n=h(0),i=h(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=s,this.outLowNode=n,this.outHighNode=i,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:s,outLowNode:n,outHighNode:i,doClamp:r}=this;let a=e.sub(t).div(s.sub(t));return r===!0&&(a=a.clamp()),a.mul(i.sub(n)).add(n)}}const Ph=T(bo,null,null,{doClamp:!1}),Fh=T(bo);N("remap",Ph);N("remapClamp",Fh);A("RemapNode",bo);class ga extends ee{constructor(e,t,s=z(.5)){super("vec2"),this.uvNode=e,this.rotationNode=t,this.centerNode=s}setup(){const{uvNode:e,rotationNode:t,centerNode:s}=this;return e.sub(s).rotate(t).add(s)}}const Bh=T(ga);N("rotateUV",Bh);A("RotateUVNode",ga);class Na extends ee{constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:s}=this;if(this.getNodeType(e)==="vec2"){const i=t.cos(),r=t.sin();return vo(i,r,r.negate(),i).mul(s)}else{const i=t,r=qt(O(1,0,0,0),O(0,xt(i.x),mt(i.x).negate(),0),O(0,mt(i.x),xt(i.x),0),O(0,0,0,1)),a=qt(O(xt(i.y),0,mt(i.y),0),O(0,1,0,0),O(mt(i.y).negate(),0,xt(i.y),0),O(0,0,0,1)),c=qt(O(xt(i.z),mt(i.z).negate(),0,0),O(mt(i.z),xt(i.z),0,0),O(0,0,1,0),O(0,0,0,1));return r.mul(a).mul(c).mul(O(s,1)).xyz}}}const Uh=T(Na);N("rotate",Uh);A("RotateNode",Na);class ya extends P{constructor(e,t=dt(),s=h(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=s}setup(){const{frameNode:e,uvNode:t,countNode:s}=this,{width:n,height:i}=s,r=e.mod(n.mul(i)).floor(),a=r.mod(n),c=i.sub(r.add(1).div(n).ceil()),l=s.reciprocal(),u=z(a,c);return t.add(u).mul(l)}}T(ya);A("SpriteSheetUVNode",ya);class xa extends Qt{constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}setup(e){return e.isAvailable("storageBuffer")===!1&&!this.node.instanceIndex&&this.node.bufferObject===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let s;const n=e.context.assign;if(e.isAvailable("storageBuffer")===!1){const{node:i}=this;!i.instanceIndex&&this.node.bufferObject===!0&&n!==!0?s=e.generatePBO(this):s=i.build(e)}else s=super.generate(e);if(n!==!0){const i=this.getNodeType(e);s=e.format(s,i,t)}return s}}const Ta=T(xa);N("storageElement",Ta);A("StorageArrayElementNode",xa);class va extends P{constructor(e,t=null,s=null,n=h(1),i=we,r=st){super("vec4"),this.textureXNode=e,this.textureYNode=t,this.textureZNode=s,this.scaleNode=n,this.positionNode=i,this.normalNode=r}setup(){const{textureXNode:e,textureYNode:t,textureZNode:s,scaleNode:n,positionNode:i,normalNode:r}=this;let a=r.abs().normalize();a=a.div(a.dot(g(1)));const c=i.yz.mul(n),l=i.zx.mul(n),u=i.xy.mul(n),d=e.value,m=t!==null?t.value:d,v=s!==null?s.value:d,S=Fe(d,c).mul(a.x),x=Fe(m,l).mul(a.y),y=Fe(v,u).mul(a.z);return Be(S,x,y)}}const kh=T(va),Gh=(...o)=>kh(...o);N("triplanarTexture",Gh);A("TriplanarTexturesNode",va);new Fi;new W;new W;new W;new tn;new W(0,0,-1);new St;new W;new W;new St;new $e;new Lt;z(Ss.x.oneMinus(),Ss.y);class Wh extends cn{constructor(e=0){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),s=e.hasGeometryAttribute(t);let n;return s===!0?n=super.generate(e):n=e.generateConst(this.nodeType,new St(1,1,1,1)),n}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}A("VertexColorNode",Wh);class Sa extends ns{constructor(e,t,s=null){super(e,t,s),this.renderer=s}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const Hh=(o,e,t)=>R(new Sa(o,e,t));A("RendererReferenceNode",Sa);const gn=1/6,wa=o=>q(gn,q(o,q(o,o.negate().add(3)).sub(3)).add(1)),uo=o=>q(gn,q(o,q(o,q(3,o).sub(6))).add(4)),Va=o=>q(gn,q(o,q(o,q(-3,o).add(3)).add(3)).add(1)),ho=o=>q(gn,ct(o,3)),fi=o=>wa(o).add(uo(o)),gi=o=>Va(o).add(ho(o)),Ni=o=>Be(-1,uo(o).div(wa(o).add(uo(o)))),yi=o=>Be(1,ho(o).div(Va(o).add(ho(o)))),xi=(o,e,t)=>{const s=o.uvNode,n=q(s,e.zw).add(.5),i=es(n),r=un(n),a=fi(r.x),c=gi(r.x),l=Ni(r.x),u=yi(r.x),d=Ni(r.y),m=yi(r.y),v=z(i.x.add(l),i.y.add(d)).sub(.5).mul(e.xy),S=z(i.x.add(u),i.y.add(d)).sub(.5).mul(e.xy),x=z(i.x.add(l),i.y.add(m)).sub(.5).mul(e.xy),y=z(i.x.add(u),i.y.add(m)).sub(.5).mul(e.xy),M=fi(r.y).mul(Be(a.mul(o.uv(v).level(t)),c.mul(o.uv(S).level(t)))),L=gi(r.y).mul(Be(a.mul(o.uv(x).level(t)),c.mul(o.uv(y).level(t))));return M.add(L)},qh=(o,e)=>{const t=z(o.size(p(e))),s=z(o.size(p(e.add(1)))),n=wt(1,t),i=wt(1,s),r=xi(o,O(n,t),es(e)),a=xi(o,O(i,s),Nr(e));return un(e).mix(r,a)};class Aa extends ee{constructor(e,t=h(3)){super("vec4"),this.textureNode=e,this.blurNode=t}setup(){return qh(this.textureNode,this.blurNode)}}const $h=T(Aa);N("bicubic",$h);A("TextureBicubicNode",Aa);class _a extends P{constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}_(_a);A("PointUVNode",_a);class Je extends P{constructor(e=Je.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,s=this.scene!==null?this.scene:e.scene;let n;return t===Je.BACKGROUND_BLURRINESS?n=tt("backgroundBlurriness","float",s):t===Je.BACKGROUND_INTENSITY?n=tt("backgroundIntensity","float",s):console.error("THREE.SceneNode: Unknown scope:",t),n}}Je.BACKGROUND_BLURRINESS="backgroundBlurriness";Je.BACKGROUND_INTENSITY="backgroundIntensity";_(Je,Je.BACKGROUND_BLURRINESS);_(Je,Je.BACKGROUND_INTENSITY);A("SceneNode",Je);class jh extends hn{constructor(e,t,s=0){super(e,t,s),this.isStorageBufferNode=!0,this.bufferObject=!1,this._attribute=null,this._varying=null,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getInputType(){return"storageBuffer"}element(e){return Ta(this,e)}setBufferObject(e){return this.bufferObject=e,this}generate(e){if(e.isAvailable("storageBuffer"))return super.generate(e);const t=this.getNodeType(e);this._attribute===null&&(this._attribute=pn(this.value),this._varying=re(this._attribute));const s=this._varying.build(e,t);return e.registerTransform(s,this._attribute),s}}A("StorageBufferNode",jh);class Ma extends ss{constructor(e,t,s=null){super(e,t),this.storeNode=s,this.isStoreTextureNode=!0}getInputType(){return"storageTexture"}setup(e){super.setup(e);const t=e.getNodeProperties(this);t.storeNode=this.storeNode}generate(e,t){let s;return this.storeNode!==null?s=this.generateStore(e):s=super.generate(e,t),s}generateStore(e){const t=e.getNodeProperties(this),{uvNode:s,storeNode:n}=t,i=super.generate(e,"property"),r=s.build(e,"uvec2"),a=n.build(e,"vec4"),c=e.generateTextureStore(e,i,r,a);e.addLineFlowCode(c)}}T(Ma);A("TextureStoreNode",Ma);class Xh extends ns{constructor(e,t,s=null){super(e,t,s),this.userData=s}update(e){this.reference=this.userData!==null?this.userData:e.object.userData,super.update(e)}}A("UserDataNode",Xh);const Yh=w(({base:o,blend:e})=>{const t=s=>e[s].lessThan(pr).cond(e[s],o[s].oneMinus().div(e[s]).oneMinus().max(0));return g(t("x"),t("y"),t("z"))}).setLayout({name:"burnColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Zh=w(({base:o,blend:e})=>{const t=s=>e[s].equal(1).cond(e[s],o[s].div(e[s].oneMinus()).max(0));return g(t("x"),t("y"),t("z"))}).setLayout({name:"dodgeColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Kh=w(({base:o,blend:e})=>{const t=s=>o[s].oneMinus().mul(e[s].oneMinus()).oneMinus();return g(t("x"),t("y"),t("z"))}).setLayout({name:"screenColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Jh=w(({base:o,blend:e})=>{const t=s=>o[s].lessThan(.5).cond(o[s].mul(e[s],2),o[s].oneMinus().mul(e[s].oneMinus()).oneMinus());return g(t("x"),t("y"),t("z"))}).setLayout({name:"overlayColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]});class ge extends ee{constructor(e,t,s){super(),this.blendMode=e,this.baseNode=t,this.blendNode=s}setup(){const{blendMode:e,baseNode:t,blendNode:s}=this,n={base:t,blend:s};let i=null;return e===ge.BURN?i=Yh(n):e===ge.DODGE?i=Zh(n):e===ge.SCREEN?i=Kh(n):e===ge.OVERLAY&&(i=Jh(n)),i}}ge.BURN="burn";ge.DODGE="dodge";ge.SCREEN="screen";ge.OVERLAY="overlay";const Qh=T(ge,ge.BURN),ep=T(ge,ge.DODGE),tp=T(ge,ge.OVERLAY),sp=T(ge,ge.SCREEN);N("burn",Qh);N("dodge",ep);N("overlay",tp);N("screen",sp);A("BlendModeNode",ge);const np=w(({textureNode:o,bumpScale:e})=>{const t=n=>o.cache().context({getUV:i=>n(i.uvNode||dt()),forceUVContext:!0}),s=h(t(n=>n));return z(h(t(n=>n.add(n.dFdx()))).sub(s),h(t(n=>n.add(n.dFdy()))).sub(s)).mul(e)}),op=w(o=>{const{surf_pos:e,surf_norm:t,dHdxy:s}=o,n=e.dFdx().normalize(),i=e.dFdy().normalize(),r=t,a=i.cross(r),c=r.cross(n),l=n.dot(a).mul(Ks),u=l.sign().mul(s.x.mul(a).add(s.y.mul(c)));return l.abs().mul(t).sub(u).normalize()});class Ra extends ee{constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=np({textureNode:this.textureNode,bumpScale:e});return op({surf_pos:De,surf_norm:Vt,dHdxy:t})}}const ip=T(Ra);N("bumpMap",ip);A("BumpMapNode",Ra);const rp=w(({color:o,adjustment:e})=>e.mix(Ea(o.rgb),o.rgb)),ap=w(({color:o,adjustment:e})=>{const t=Be(o.r,o.g,o.b).div(3),s=o.r.max(o.g.max(o.b)),n=s.sub(t).mul(e).mul(-3);return Te(o.rgb,s,n)}),cp=w(({color:o,adjustment:e})=>{const t=g(.57735,.57735,.57735),s=e.cos();return g(o.rgb.mul(s).add(t.cross(o.rgb).mul(e.sin()).add(t.mul(ts(t,o.rgb).mul(s.oneMinus())))))});class Le extends ee{constructor(e,t,s=h(1)){super("vec3"),this.method=e,this.colorNode=t,this.adjustmentNode=s}setup(){const{method:e,colorNode:t,adjustmentNode:s}=this,n={color:t,adjustment:s};let i=null;return e===Le.SATURATION?i=rp(n):e===Le.VIBRANCE?i=ap(n):e===Le.HUE?i=cp(n):console.error(`${this.type}: Method "${this.method}" not supported!`),i}}Le.SATURATION="saturation";Le.VIBRANCE="vibrance";Le.HUE="hue";const lp=T(Le,Le.SATURATION),up=T(Le,Le.VIBRANCE),dp=T(Le,Le.HUE),hp=g(.2125,.7154,.0721),Ea=(o,e=hp)=>ts(o,e),Ca=(o,e)=>Te(g(0),o,Ea(o).sub(e).max(0));N("saturation",lp);N("vibrance",up);N("hue",dp);N("threshold",Ca);A("ColorAdjustmentNode",Le);const pp=w(o=>{const{eye_pos:e,surf_norm:t,mapN:s,uv:n}=o,i=e.dFdx(),r=e.dFdy(),a=n.dFdx(),c=n.dFdy(),l=t,u=r.cross(l),d=l.cross(i),m=u.mul(a.x).add(d.mul(c.x)),v=u.mul(a.y).add(d.mul(c.y)),S=m.dot(m).max(v.dot(v)),x=Ks.mul(S.inverseSqrt());return Be(m.mul(s.x,x),v.mul(s.y,x),l.mul(s.z)).normalize()});class La extends ee{constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=Go}setup(e){const{normalMapType:t,scaleNode:s}=this;let n=this.node.mul(2).sub(1);s!==null&&(n=g(n.xy.mul(s),n.z));let i=null;return t===Qc?i=Cr.mul(n).normalize():t===Go&&(e.hasGeometryAttribute("tangent")===!0?i=Wt.mul(n).normalize():i=pp({eye_pos:De,surf_norm:Vt,mapN:n,uv:dt()})),i}}const mp=T(La);N("normalMap",mp);A("NormalMapNode",La);class ba extends ee{constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const fp=T(ba);N("posterize",fp);A("PosterizeNode",ba);const gp=w(({color:o,exposure:e})=>o.mul(e).clamp()),Np=w(({color:o,exposure:e})=>(o=o.mul(e),o.div(o.add(1)).clamp())),yp=w(({color:o,exposure:e})=>{o=o.mul(e),o=o.sub(.004).max(0);const t=o.mul(o.mul(6.2).add(.5)),s=o.mul(o.mul(6.2).add(1.7)).add(.06);return t.div(s).pow(2.2)}),xp=w(({color:o})=>{const e=o.mul(o.add(.0245786)).sub(90537e-9),t=o.mul(o.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),Tp=w(({color:o,exposure:e})=>{const t=et(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),s=et(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return o=o.mul(e).div(.6),o=t.mul(o),o=xp({color:o}),o=s.mul(o),o.clamp()}),vp=et(g(1.6605,-.1246,-.0182),g(-.5876,1.1329,-.1006),g(-.0728,-.0083,1.1187)),Sp=et(g(.6274,.0691,.0164),g(.3293,.9195,.088),g(.0433,.0113,.8956)),wp=w(([o])=>{const e=g(o).toVar(),t=g(e.mul(e)).toVar(),s=g(t.mul(t)).toVar();return h(15.5).mul(s.mul(t)).sub(q(40.14,s.mul(e))).add(q(31.96,s).sub(q(6.868,t.mul(e))).add(q(.4298,t).add(q(.1191,e).sub(.00232))))}),Vp=w(({color:o,exposure:e})=>{const t=g(o).toVar(),s=et(g(.856627153315983,.137318972929847,.11189821299995),g(.0951212405381588,.761241990602591,.0767994186031903),g(.0482516061458583,.101439036467562,.811302368396859)),n=et(g(1.1271005818144368,-.1413297634984383,-.14132976349843826),g(-.11060664309660323,1.157823702216272,-.11060664309660294),g(-.016493938717834573,-.016493938717834257,1.2519364065950405)),i=h(-12.47393),r=h(4.026069);return t.mulAssign(e),t.assign(Sp.mul(t)),t.assign(s.mul(t)),t.assign(Ue(t,1e-10)),t.assign(ln(t)),t.assign(t.sub(i).div(r.sub(i))),t.assign(Jt(t,0,1)),t.assign(wp(t)),t.assign(n.mul(t)),t.assign(ct(Ue(g(0),t),g(2.2))),t.assign(vp.mul(t)),t.assign(Jt(t,0,1)),t}),Ap={[el]:gp,[tl]:Np,[sl]:yp,[nl]:Tp,[ol]:Vp};class Ia extends ee{constructor(e=Bs,t=Mp,s=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=s}getCacheKey(){let e=super.getCacheKey();return e="{toneMapping:"+this.toneMapping+",nodes:"+e+"}",e}setup(e){const t=this.colorNode||e.context.color,s=this.toneMapping;if(s===Bs)return t;const n={exposure:this.exposureNode,color:t},i=Ap[s];let r=null;return i?r=i(n):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",s),r=t),r}}const _p=(o,e,t)=>R(new Ia(o,R(e),R(t))),Mp=Hh("toneMappingExposure","float");N("toneMapping",(o,e,t)=>_p(e,t,o));A("ToneMappingNode",Ia);let Dn=null;class Oa extends Ms{constructor(e=Ss,t=null){Dn===null&&(Dn=new Pi),super(e,t,Dn)}updateReference(){return this}}const Rp=T(Oa);N("viewportSharedTexture",Rp);A("ViewportSharedTextureNode",Oa);class po extends ss{constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class Rs extends ee{constructor(e,t,s){super("vec4"),this.scope=e,this.scene=t,this.camera=s,this._pixelRatio=1,this._width=1,this._height=1;const n=new fo;n.isRenderTargetTexture=!0,n.name="PostProcessingDepth";const i=new Lt(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:il});i.texture.name="PostProcessing",i.depthTexture=n,this.renderTarget=i,this.updateBeforeType=J.FRAME,this._textureNode=R(new po(this,i.texture)),this._depthTextureNode=R(new po(this,n)),this._depthNode=null,this._viewZNode=null,this._cameraNear=Q(0),this._cameraFar=Q(0),this.isPassNode=!0}isGlobal(){return!0}getTextureNode(){return this._textureNode}getTextureDepthNode(){return this._depthTextureNode}getViewZNode(){if(this._viewZNode===null){const e=this._cameraNear,t=this._cameraFar;this._viewZNode=sa(this._depthTextureNode,e,t)}return this._viewZNode}getDepthNode(){if(this._depthNode===null){const e=this._cameraNear,t=this._cameraFar;this._depthNode=ao(this.getViewZNode(),e,t)}return this._depthNode}setup(){return this.scope===Rs.COLOR?this.getTextureNode():this.getDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:s,camera:n}=this;this._pixelRatio=t.getPixelRatio();const i=t.getSize(new $e);this.setSize(i.width,i.height);const r=t.toneMapping,a=t.toneMappingNode,c=t.getRenderTarget();this._cameraNear.value=n.near,this._cameraFar.value=n.far,t.toneMapping=Bs,t.toneMappingNode=null,t.setRenderTarget(this.renderTarget),t.render(s,n),t.toneMapping=r,t.toneMappingNode=a,t.setRenderTarget(c)}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget.setSize(s,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Rs.COLOR="color";Rs.DEPTH="depth";const Io=(o,e)=>R(new po(o,e));A("PassNode",Rs);const Pn=new rl(-1,1,1,-1,0,1);class Ep extends qn{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new yt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new yt(t,2))}}const Cp=new Ep;class Nn extends ys{constructor(e=null){super(Cp,e),this.camera=Pn}renderAsync(e){return e.renderAsync(this,Pn)}render(e){e.render(this,Pn)}}const Ti=new Nn,vi=new Nn;class Lp extends ee{constructor(e,t=2){super("vec4"),this.textureNode=e,this.sigma=t,this.directionNode=z(1),this._invSize=Q(new $e),this._passDirection=Q(new $e),this._horizontalRT=new Lt,this._horizontalRT.texture.name="GaussianBlurNode.horizontal",this._verticalRT=new Lt,this._verticalRT.texture.name="GaussianBlurNode.vertical",this._textureNode=Io(this,this._verticalRT.texture),this.updateBeforeType=J.RENDER,this.resolution=new $e(1,1)}setSize(e,t){e=Math.max(Math.round(e*this.resolution.x),1),t=Math.max(Math.round(t*this.resolution.y),1),this._invSize.value.set(1/e,1/t),this._horizontalRT.setSize(e,t),this._verticalRT.setSize(e,t)}updateBefore(e){const{renderer:t}=e,s=this.textureNode,n=s.value,i=t.getRenderTarget(),r=s.value;Ti.material=this._material,vi.material=this._material,this.setSize(n.image.width,n.image.height);const a=n.type;this._horizontalRT.texture.type=a,this._verticalRT.texture.type=a,t.setRenderTarget(this._horizontalRT),this._passDirection.value.set(1,0),Ti.render(t),s.value=this._horizontalRT.texture,t.setRenderTarget(this._verticalRT),this._passDirection.value.set(0,1),vi.render(t),t.setRenderTarget(i),s.value=r}getTextureNode(){return this._textureNode}setup(e){const t=this.textureNode;if(t.isTextureNode!==!0)return console.error("GaussianBlurNode requires a TextureNode."),O();const s=t.uvNode||dt(),n=c=>t.cache().context({getUV:()=>c,forceUVContext:!0}),i=w(()=>{const c=3+2*this.sigma,l=this._getCoefficients(c),u=this._invSize,d=z(this.directionNode).mul(this._passDirection),m=h(l[0]).toVar(),v=O(n(s).mul(m)).toVar();for(let S=1;S<c;S++){const x=h(S),y=h(l[S]),M=z(d.mul(u.mul(x))).toVar(),L=O(n(s.add(M))),I=O(n(s.sub(M)));v.addAssign(L.add(I).mul(y)),m.addAssign(q(2,y))}return v.div(m)}),r=this._material||(this._material=e.createNodeMaterial());r.fragmentNode=i();const a=e.getNodeProperties(this);return a.textureNode=t,this._textureNode}_getCoefficients(e){const t=[];for(let s=0;s<e;s++)t.push(.39894*Math.exp(-.5*s*s/(e*e))/e);return t}}const bp=(o,e)=>R(new Lp(R(o),e));N("gaussianBlur",bp);const Si=new Nn;class Ip extends ee{constructor(e,t=.96){super(e),this.textureNode=e,this.textureNodeOld=Fe(),this.damp=Q(t),this._compRT=new Lt,this._compRT.texture.name="AfterImageNode.comp",this._oldRT=new Lt,this._oldRT.texture.name="AfterImageNode.old",this._textureNode=Io(this,this._compRT.texture),this.updateBeforeType=J.RENDER}getTextureNode(){return this._textureNode}setSize(e,t){this._compRT.setSize(e,t),this._oldRT.setSize(e,t)}updateBefore(e){const{renderer:t}=e,s=this.textureNode,n=s.value,i=n.type;this._compRT.texture.type=i,this._oldRT.texture.type=i;const r=t.getRenderTarget(),a=s.value;this.textureNodeOld.value=this._oldRT.texture,t.setRenderTarget(this._compRT),Si.render(t);const c=this._oldRT;this._oldRT=this._compRT,this._compRT=c,this.setSize(n.image.width,n.image.height),t.setRenderTarget(r),s.value=a}setup(e){const t=this.textureNode,s=this.textureNodeOld;if(t.isTextureNode!==!0)return console.error("AfterImageNode requires a TextureNode."),O();const n=t.uvNode||dt();s.uvNode=n;const i=u=>t.cache().context({getUV:()=>u,forceUVContext:!0}),r=w(([u,d])=>{const m=h(d).toVar(),v=O(u).toVar();return Ue(Eo(v.sub(m)),0)}),a=w(()=>{const u=O(s),d=O(i(n));return u.mulAssign(this.damp.mul(r(u,.1))),Ue(d,u)}),c=this._materialComposed||(this._materialComposed=e.createNodeMaterial());c.fragmentNode=a(),Si.material=c;const l=e.getNodeProperties(this);return l.textureNode=t,this._textureNode}}const Op=(o,e)=>R(new Ip(R(o),e));N("afterImage",Op);const wi=new Nn;class zp extends ee{constructor(e,t,s,n){super("vec4"),this.textureNode=e,this.tresholdNode=t,this.scaleNode=s,this.colorNode=g(.1,0,1),this.samples=n,this.resolution=new $e(1,1),this._renderTarget=new Lt,this._renderTarget.texture.name="anamorphic",this._invSize=Q(new $e),this._textureNode=Io(this,this._renderTarget.texture),this.updateBeforeType=J.RENDER}getTextureNode(){return this._textureNode}setSize(e,t){this._invSize.value.set(1/e,1/t),e=Math.max(Math.round(e*this.resolution.x),1),t=Math.max(Math.round(t*this.resolution.y),1),this._renderTarget.setSize(e,t)}updateBefore(e){const{renderer:t}=e,s=this.textureNode,n=s.value;this._renderTarget.texture.type=n.type;const i=t.getRenderTarget(),r=s.value;wi.material=this._material,this.setSize(n.image.width,n.image.height),t.setRenderTarget(this._renderTarget),wi.render(t),t.setRenderTarget(i),s.value=r}setup(e){const t=this.textureNode;if(t.isTextureNode!==!0)return console.error("AnamorphNode requires a TextureNode."),O();const s=t.uvNode||dt(),n=c=>t.cache().context({getUV:()=>c,forceUVContext:!0}),i=w(()=>{const c=this.samples,l=Math.floor(c/2),u=g(0).toVar();return te({start:-l,end:l},({i:d})=>{const m=h(d).abs().div(l).oneMinus(),v=z(s.x.add(this._invSize.x.mul(d).mul(this.scaleNode)),s.y),S=n(v),x=Ca(S,this.tresholdNode).mul(m);u.addAssign(x)}),u.mul(this.colorNode)}),r=this._material||(this._material=e.createNodeMaterial());r.fragmentNode=i();const a=e.getNodeProperties(this);return a.textureNode=t,this._textureNode}}const Dp=(o,e=.9,t=3,s=32)=>R(new zp(R(o),R(e),R(t),s));N("anamorphic",Dp);class za extends ee{constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],s=this.functionNode,n=s.getInputs(e),i=this.parameters;if(Array.isArray(i))for(let a=0;a<i.length;a++){const c=n[a],l=i[a];t.push(l.build(e,c.type))}else for(const a of n){const c=i[a.name];if(c!==void 0)t.push(c.build(e,a.type));else throw new Error(`FunctionCallNode: Input '${a.name}' not found in FunctionNode.`)}return`${s.build(e,"property")}( ${t.join(", ")} )`}}const Pp=(o,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Ht(e):an(e[0]),R(new za(R(o),e)));N("call",Pp);A("FunctionCallNode",za);class Da extends P{constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outpuType=null,this.events=new Ii,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:h()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=Hi(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;e.value!==null&&(e.inputType==="ArrayBuffer"?t=qi(e.value):e.inputType==="Texture"?t=e.meta.textures[e.value]:t=e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const Fs=T(Da);N("scriptableValue",Fs);A("ScriptableValueNode",Da);class Pa extends Map{get(e,t=null,...s){if(this.has(e))return super.get(e);if(t!==null){const n=t(...s);return this.set(e,n),n}}}class Fp{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const Fn=new Pa;class Fa extends P{constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new Pa,this._output=Fs(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const s=this._outputs;return s[e]===void 0?s[e]=Fs(t):s[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const s=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),s[e]=t,s[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),s[e]=t,s[e].events.addEventListener("refresh",this.onRefresh)):s[e]===void 0?(s[e]=Fs(t),s[e].events.addEventListener("refresh",this.onRefresh)):s[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const n=this.getObject()[e];if(typeof n=="function")return n(...t)}async callAsync(e,...t){const n=this.getObject()[e];if(typeof n=="function")return n.constructor.name==="AsyncFunction"?await n(...t):n(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),t=(l,u)=>this.setOutput(l,u),s=new Fp(this),n=Fn.get("THREE"),i=Fn.get("TSL"),r=this.getMethod(this.codeNode),a=[s,this._local,Fn,e,t,n,i];this._object=r(...a);const c=this._object.layout;if(c&&(c.cache===!1&&this._local.clear(),this._output.outputType=c.outputType||null,Array.isArray(c.elements)))for(const l of c.elements){const u=l.id||l.name;l.inputType&&(this.getParameter(u)===void 0&&this.setParameter(u,null),this.getParameter(u).inputType=l.inputType),l.outputType&&(this.getOutput(u)===void 0&&this.setOutput(u,null),this.getOutput(u).outputType=l.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let s=this.parameters[t];s.isScriptableNode&&(s=s.getDefaultOutput()),s.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:h()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],s=["layout","init","main","dispose"].join(", "),n="var "+s+`; var output = {};
`,i=`
return { ...output, `+s+" };",r=n+this.codeNode.code+i;return this._method=new Function(...e,r),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const Bp=T(Fa);N("scriptable",Bp);A("ScriptableNode",Fa);class yn extends P{constructor(e,t){super("float"),this.isFogNode=!0,this.colorNode=e,this.factorNode=t}getViewZNode(e){let t;const s=e.context.getViewZ;return s!==void 0&&(t=s(this)),(t||De.z).negate()}setup(){return this.factorNode}}const Up=T(yn);N("fog",Up);A("FogNode",yn);class Ba extends yn{constructor(e,t,s){super(e),this.isFogRangeNode=!0,this.nearNode=t,this.farNode=s}setup(e){const t=this.getViewZNode(e);return gt(this.nearNode,this.farNode,t)}}const kp=T(Ba);N("rangeFog",kp);A("FogRangeNode",Ba);class Ua extends yn{constructor(e,t){super(e),this.isFogExp2Node=!0,this.densityNode=t}setup(e){const t=this.getViewZNode(e),s=this.densityNode;return s.mul(s,t,t).negate().exp().oneMinus()}}const Gp=T(Ua);N("densityFog",Gp);A("FogExp2Node",Ua);let _t=null,Mt=null;class ka extends P{constructor(e=h(),t=h()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=e.getTypeLength(Tt(this.minNode.value)),s=e.getTypeLength(Tt(this.maxNode.value));return t>s?t:s}getNodeType(e){return e.object.isInstancedMesh===!0?e.getTypeFromLength(this.getVectorLength(e)):"float"}setup(e){const t=e.object;let s=null;if(t.isInstancedMesh===!0){const n=this.minNode.value,i=this.maxNode.value,r=e.getTypeLength(Tt(n)),a=e.getTypeLength(Tt(i));_t=_t||new St,Mt=Mt||new St,_t.setScalar(0),Mt.setScalar(0),r===1?_t.setScalar(n):n.isColor?_t.set(n.r,n.g,n.b):_t.set(n.x,n.y,n.z||0,n.w||0),a===1?Mt.setScalar(i):i.isColor?Mt.set(i.r,i.g,i.b):Mt.set(i.x,i.y,i.z||0,i.w||0);const c=4,l=c*t.count,u=new Float32Array(l);for(let m=0;m<l;m++){const v=m%c,S=_t.getComponent(v),x=Mt.getComponent(v);u[m]=Oi.lerp(S,x,Math.random())}const d=this.getNodeType(e);s=Co(u,"vec4",t.count).element(sr).convert(d)}else s=h(0);return s}}T(ka);A("RangeNode",ka);class Ga extends P{constructor(e,t,s=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=s,this.dispatchCount=0,this.version=1,this.updateBeforeType=J.OBJECT,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let s=t[0];for(let n=1;n<t.length;n++)s*=t[n];this.dispatchCount=Math.ceil(e/s)}onInit(){}updateBefore({renderer:e}){e.compute(this)}generate(e){const{shaderStage:t}=e;if(t==="compute"){const s=this.computeNode.build(e,"void");s!==""&&e.addLineFlowCode(s)}}}const Wp=(o,e,t)=>R(new Ga(R(o),e,t));N("compute",Wp);A("ComputeNode",Ga);class Ot extends P{constructor(e=Ot.TARGET_DIRECTION,t=null){super(),this.scope=e,this.light=t}setup(){const{scope:e,light:t}=this;let s=null;return e===Ot.TARGET_DIRECTION&&(s=Nt.transformDirection(to(t).sub(to(t.target)))),s}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Ot.TARGET_DIRECTION="targetDirection";const Wa=T(Ot,Ot.TARGET_DIRECTION);A("LightNode",Ot);const Ha=w(o=>{const{lightDistance:e,cutoffDistance:t,decayExponent:s}=o,n=e.pow(s).max(.01).reciprocal();return t.greaterThan(0).cond(n.mul(e.div(t).pow4().oneMinus().clamp().pow2()),n)});class qa extends Pt{constructor(e=null){super(e),this.cutoffDistanceNode=Q(0),this.decayExponentNode=Q(0)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setup(e){const{colorNode:t,cutoffDistanceNode:s,decayExponentNode:n,light:i}=this,r=e.context.lightingModel,a=Er(i).sub(De),c=a.normalize(),l=a.length(),u=Ha({lightDistance:l,cutoffDistance:s,decayExponent:n}),d=t.mul(u),m=e.context.reflectedLight;r.direct({lightDirection:c,lightColor:d,reflectedLight:m,shadowMask:this.shadowMaskNode},e.stack,e)}}A("PointLightNode",qa);os(fs,qa);class $a extends Pt{constructor(e=null){super(e)}setup(e){super.setup(e);const t=e.context.lightingModel,s=this.colorNode,n=Wa(this.light),i=e.context.reflectedLight;t.direct({lightDirection:n,lightColor:s,reflectedLight:i,shadowMask:this.shadowMaskNode},e.stack,e)}}A("DirectionalLightNode",$a);os(al,$a);class Oo extends Pt{constructor(e=null){super(e),this.coneCosNode=Q(0),this.penumbraCosNode=Q(0),this.cutoffDistanceNode=Q(0),this.decayExponentNode=Q(0)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e){const{coneCosNode:t,penumbraCosNode:s}=this;return gt(t,s,e)}setup(e){super.setup(e);const t=e.context.lightingModel,{colorNode:s,cutoffDistanceNode:n,decayExponentNode:i,light:r}=this,a=Er(r).sub(De),c=a.normalize(),l=c.dot(Wa(r)),u=this.getSpotAttenuation(l),d=a.length(),m=Ha({lightDistance:d,cutoffDistance:n,decayExponent:i}),v=s.mul(u).mul(m),S=e.context.reflectedLight;t.direct({lightDirection:c,lightColor:v,reflectedLight:S,shadowMask:this.shadowMaskNode},e.stack,e)}}A("SpotLightNode",Oo);os(go,Oo);class Hp extends go{constructor(e,t,s,n,i,r){super(e,t,s,n,i,r),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class ja extends Oo{getSpotAttenuation(e){const t=this.light.iesMap;let s=null;if(t&&t.isTexture===!0){const n=e.acos().mul(1/Math.PI);s=Fe(t,z(n,0),0).r}else s=super.getSpotAttenuation(e);return s}}A("IESSpotLightNode",ja);os(Hp,ja);class Xa extends Pt{constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}A("AmbientLightNode",Xa);os(cl,Xa);class Ya extends Pt{constructor(e=null){super(e),this.lightPositionNode=to(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Q(new en)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:s,lightDirectionNode:n}=this,r=Vt.dot(n).mul(.5).add(.5),a=Te(s,t,r);e.context.irradiance.addAssign(a)}}A("HemisphereLightNode",Ya);os(ll,Ya);const qp=w(o=>{const e=o.uv.mul(2),t=e.x.floor(),s=e.y.floor();return t.add(s).mod(2).sign()});class Za extends ee{constructor(e=dt()){super("float"),this.uvNode=e}setup(){return qp({uv:this.uvNode})}}const $p=T(Za);N("checker",$p);A("CheckerNode",Za);const jp=new Bt;class Xp extends ke{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.pointWidth=1,this.pointColorNode=null,this.setDefaultValues(jp),this.setupShaders(),this.setValues(e)}setupShaders(){const e=this.alphaToCoverage,t=this.useColor;this.vertexNode=w(()=>{re(z(),"vUv").assign(dt());const s=Se("instancePosition"),n=Ne("vec4","mvPos");n.assign(It.mul(O(s,1)));const i=Xt.z.div(Xt.w),r=rt.mul(n),a=Ne("vec2","offset");return a.assign(Re.xy),a.assign(a.mul(Xd)),a.assign(a.div(Xt.z)),a.y.assign(a.y.mul(i)),a.assign(a.mul(r.w)),r.assign(r.add(O(a,0,0))),r})(),this.fragmentNode=w(()=>{const s=re(z(),"vUv"),n=Ne("float","alpha");n.assign(1);const i=s.x,r=s.y,a=i.mul(i).add(r.mul(r));if(e){const l=Ne("float","dlen");l.assign(a.fwidth()),n.assign(gt(l.oneMinus(),l.add(1),a).oneMinus())}else a.greaterThan(1).discard();let c;return this.pointColorNode?c=this.pointColorNode:t?c=Se("instanceColor").mul(vs):c=vs,O(c,n)})(),this.needsUpdate=!0}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.setupShaders())}}_e("InstancedPointsNodeMaterial",Xp);const Yp=new zs;class Zp extends ke{constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(Yp),this.setValues(e)}}_e("LineBasicNodeMaterial",Zp);const Kp=new Bi;class Jp extends ke{constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(Kp),this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode,t=this.dashScaleNode?h(this.dashScaleNode):so,s=this.dashSizeNode?h(this.dashSizeNode):Or,n=this.dashSizeNode?h(this.dashGapNode):zr;jt.assign(s),$s.assign(n);const i=re(Se("lineDistance").mul(t));(e?i.add(e):i).mod(jt.add($s)).greaterThan(jt).discard()}}_e("LineDashedNodeMaterial",Jp);const Qp=new Bi;class em extends ke{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.setDefaultValues(Qp),this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.useDash=e.dashed,this.useWorldUnits=!1,this.dashOffset=0,this.lineWidth=1,this.lineColorNode=null,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setup(e){this.setupShaders(),super.setup(e)}setupShaders(){const e=this.alphaToCoverage,t=this.useColor,s=this.dashed,n=this.worldUnits,i=w(({start:a,end:c})=>{const l=rt.element(2).element(2),m=rt.element(3).element(2).mul(-.5).div(l).sub(a.z).div(c.z.sub(a.z));return O(Te(a.xyz,c.xyz,m),c.w)});this.vertexNode=w(()=>{it("vec2","vUv").assign(dt());const a=Se("instanceStart"),c=Se("instanceEnd"),l=Ne("vec4","start"),u=Ne("vec4","end");l.assign(It.mul(O(a,1))),u.assign(It.mul(O(c,1))),n&&(it("vec3","worldStart").assign(l.xyz),it("vec3","worldEnd").assign(u.xyz));const d=Xt.z.div(Xt.w),m=rt.element(2).element(3).equal(-1);H(m,()=>{H(l.z.lessThan(0).and(u.z.greaterThan(0)),()=>{u.assign(i({start:l,end:u}))}).elseif(u.z.lessThan(0).and(l.z.greaterThanEqual(0)),()=>{l.assign(i({start:u,end:l}))})});const v=rt.mul(l),S=rt.mul(u),x=v.xyz.div(v.w),y=S.xyz.div(S.w),M=y.xy.sub(x.xy).temp();M.x.assign(M.x.mul(d)),M.assign(M.normalize());const L=xs(O());if(n){const I=u.xyz.sub(l.xyz).normalize(),D=Te(l.xyz,u.xyz,.5).normalize(),F=I.cross(D).normalize(),b=I.cross(F),B=it("vec4","worldPos");B.assign(Re.y.lessThan(.5).cond(l,u));const $=_n.mul(.5);B.addAssign(O(Re.x.lessThan(0).cond(F.mul($),F.mul($).negate()),0)),s||(B.addAssign(O(Re.y.lessThan(.5).cond(I.mul($).negate(),I.mul($)),0)),B.addAssign(O(b.mul($),0)),H(Re.y.greaterThan(1).or(Re.y.lessThan(0)),()=>{B.subAssign(O(b.mul(2).mul($),0))})),L.assign(rt.mul(B));const Ve=xs(g());Ve.assign(Re.y.lessThan(.5).cond(x,y)),L.z.assign(Ve.z.mul(L.w))}else{const I=Ne("vec2","offset");I.assign(z(M.y,M.x.negate())),M.x.assign(M.x.div(d)),I.x.assign(I.x.div(d)),I.assign(Re.x.lessThan(0).cond(I.negate(),I)),H(Re.y.lessThan(0),()=>{I.assign(I.sub(M))}).elseif(Re.y.greaterThan(1),()=>{I.assign(I.add(M))}),I.assign(I.mul(_n)),I.assign(I.div(Xt.w)),L.assign(Re.y.lessThan(.5).cond(v,S)),I.assign(I.mul(L.w)),L.assign(L.add(O(I,0,0)))}return L})();const r=w(({p1:a,p2:c,p3:l,p4:u})=>{const d=a.sub(l),m=u.sub(l),v=c.sub(a),S=d.dot(m),x=m.dot(v),y=d.dot(v),M=m.dot(m),I=v.dot(v).mul(M).sub(x.mul(x)),F=S.mul(x).sub(y.mul(M)).div(I).clamp(),b=S.add(x.mul(F)).div(M).clamp();return z(F,b)});this.fragmentNode=w(()=>{const a=it("vec2","vUv");if(s){const u=this.offsetNode?h(this.offsetNodeNode):oi,d=this.dashScaleNode?h(this.dashScaleNode):so,m=this.dashSizeNode?h(this.dashSizeNode):Or,v=this.dashSizeNode?h(this.dashGapNode):zr;jt.assign(m),$s.assign(v);const S=Se("instanceDistanceStart"),x=Se("instanceDistanceEnd"),y=Re.y.lessThan(.5).cond(d.mul(S),so.mul(x)),M=re(y.add(oi)),L=u?M.add(u):M;a.y.lessThan(-1).or(a.y.greaterThan(1)).discard(),L.mod(jt.add($s)).greaterThan(jt).discard()}const c=Ne("float","alpha");if(c.assign(1),n){const u=it("vec3","worldStart"),d=it("vec3","worldEnd"),m=it("vec4","worldPos").xyz.normalize().mul(1e5),v=d.sub(u),S=r({p1:u,p2:d,p3:g(0,0,0),p4:m}),x=u.add(v.mul(S.x)),y=m.mul(S.y),I=x.sub(y).length().div(_n);if(!s)if(e){const D=I.fwidth();c.assign(gt(D.negate().add(.5),D.add(.5),I).oneMinus())}else I.greaterThan(.5).discard()}else if(e){const u=a.x,d=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1)),m=u.mul(u).add(d.mul(d)),v=Ne("float","dlen");v.assign(m.fwidth()),H(a.y.abs().greaterThan(1),()=>{c.assign(gt(v.oneMinus(),v.add(1),m).oneMinus())})}else H(a.y.abs().greaterThan(1),()=>{const u=a.x,d=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1));u.mul(u).add(d.mul(d)).greaterThan(1).discard()});let l;if(this.lineColorNode)l=this.lineColorNode;else if(t){const u=Se("instanceColorStart"),d=Se("instanceColorEnd");l=Re.y.lessThan(.5).cond(u,d).mul(vs)}else l=vs;return O(l,c)})()}get worldUnits(){return this.useWorldUnits}set worldUnits(e){this.useWorldUnits!==e&&(this.useWorldUnits=e,this.needsUpdate=!0)}get dashed(){return this.useDash}set dashed(e){this.useDash!==e&&(this.useDash=e,this.needsUpdate=!0)}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.needsUpdate=!0)}}_e("Line2NodeMaterial",em);const tm=new ul;class sm extends ke{constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(tm),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?h(this.opacityNode):Ir;oe.assign(O(fa(ae),e))}}_e("MeshNormalNodeMaterial",sm);const nm=new dl;class om extends ke{constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(nm),this.setValues(e)}}_e("MeshBasicNodeMaterial",om);const ws=w(({f0:o,f90:e,dotVH:t})=>{const s=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return o.mul(s.oneMinus()).add(e.mul(s))}),Js=w(o=>o.diffuseColor.mul(1/Math.PI)),im=()=>h(.25),rm=w(({dotNH:o})=>Kn.mul(h(.5)).add(1).mul(h(1/Math.PI)).mul(o.pow(Kn))),am=w(({lightDirection:o})=>{const e=o.add(ie).normalize(),t=ae.dot(e).clamp(),s=ie.dot(e).clamp(),n=ws({f0:Ke,f90:1,dotVH:s}),i=im(),r=rm({dotNH:t});return n.mul(i).mul(r)});class Ka extends wo{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:s}){const i=ae.dot(e).clamp().mul(t);s.directDiffuse.addAssign(i.mul(Js({diffuseColor:oe.rgb}))),this.specular===!0&&s.directSpecular.addAssign(i.mul(am({lightDirection:e})).mul(Ed))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(Js({diffuseColor:oe})))}}const cm=new hl;class lm extends ke{constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(cm),this.setValues(e)}setupLightingModel(){return new Ka(!1)}}_e("MeshLambertNodeMaterial",lm);const um=new Us;class dm extends ke{constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(um),this.setValues(e)}setupLightingModel(){return new Ka}setupVariants(){const e=(this.shininessNode?h(this.shininessNode):Ad).max(1e-4);Kn.assign(e);const t=this.specularNode||Md;Ke.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}_e("MeshPhongNodeMaterial",dm);const hm=w(()=>{const o=js.dFdx().abs().max(js.dFdy().abs());return o.x.max(o.y).max(o.z)}),pm=w(o=>{const{roughness:e}=o,t=hm();let s=e.max(.0525);return s=s.add(t),s=s.min(1),s}),mm=w(({alpha:o,dotNL:e,dotNV:t})=>{const s=o.pow2(),n=e.mul(s.add(s.oneMinus().mul(t.pow2())).sqrt()),i=t.mul(s.add(s.oneMinus().mul(e.pow2())).sqrt());return wt(.5,n.add(i).max(pr))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),fm=w(({alphaT:o,alphaB:e,dotTV:t,dotBV:s,dotTL:n,dotBL:i,dotNV:r,dotNL:a})=>{const c=a.mul(g(o.mul(t),e.mul(s),r).length()),l=r.mul(g(o.mul(n),e.mul(i),a).length());return wt(.5,c.add(l)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),gm=w(({alpha:o,dotNH:e})=>{const t=o.pow2(),s=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(s.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),Nm=h(1/Math.PI),ym=w(({alphaT:o,alphaB:e,dotNH:t,dotTH:s,dotBH:n})=>{const i=o.mul(e),r=g(e.mul(s),o.mul(n),i.mul(t)),a=r.dot(r),c=i.div(a);return Nm.mul(i.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),Vi=w(o=>{const{lightDirection:e,f0:t,f90:s,roughness:n,f:i,USE_IRIDESCENCE:r,USE_ANISOTROPY:a}=o,c=o.normalView||ae,l=n.pow2(),u=e.add(ie).normalize(),d=c.dot(e).clamp(),m=c.dot(ie).clamp(),v=c.dot(u).clamp(),S=ie.dot(u).clamp();let x=ws({f0:t,f90:s,dotVH:S}),y,M;if(Jo(r)&&(x=Ao.mix(x,i)),Jo(a)){const L=Ds.dot(e),I=Ds.dot(ie),D=Ds.dot(u),F=$t.dot(e),b=$t.dot(ie),B=$t.dot(u);y=fm({alphaT:Zn,alphaB:l,dotTV:I,dotBV:b,dotTL:L,dotBL:F,dotNV:m,dotNL:d}),M=ym({alphaT:Zn,alphaB:l,dotNH:v,dotTH:D,dotBH:B})}else y=mm({alpha:l,dotNL:d,dotNV:m}),M=gm({alpha:l,dotNH:v});return x.mul(y).mul(M)}),Ja=w(({roughness:o,dotNV:e})=>{const t=O(-1,-.0275,-.572,.022),s=O(1,.0425,1.04,-.04),n=o.mul(t).add(s),i=n.x.mul(n.x).min(e.mul(-9.28).exp2()).mul(n.x).add(n.y);return z(-1.04,1.04).mul(i).add(n.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),Qa=w(o=>{const{dotNV:e,specularColor:t,specularF90:s,roughness:n}=o,i=Ja({dotNV:e,roughness:n});return t.mul(i.x).add(s.mul(i.y))}),xm=w(({f:o,f90:e,dotVH:t})=>{const s=t.oneMinus().saturate(),n=s.mul(s),i=s.mul(n,n).clamp(0,.9999);return o.sub(g(e).mul(i)).div(i.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),Tm=w(({roughness:o,dotNH:e})=>{const t=o.pow2(),s=h(1).div(t),i=e.pow2().oneMinus().max(.0078125);return h(2).add(s).mul(i.pow(s.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),vm=w(({dotNV:o,dotNL:e})=>h(1).div(h(4).mul(e.add(o).sub(e.mul(o))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),Sm=w(({lightDirection:o})=>{const e=o.add(ie).normalize(),t=ae.dot(o).clamp(),s=ae.dot(ie).clamp(),n=ae.dot(e).clamp(),i=Tm({roughness:Vo,dotNH:n}),r=vm({dotNV:s,dotNL:t});return kt.mul(i).mul(r)}),wm=w(([o,e,t,s,n])=>{const i=g(vr(e.negate(),Ae(o),wt(1,s))),r=g(Ns(n[0].xyz),Ns(n[1].xyz),Ns(n[2].xyz));return Ae(i).mul(t.mul(r))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),Vm=w(([o,e])=>o.mul(Jt(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),Am=Qr(),_m=w(([o,e,t])=>{const s=Am.uv(o),n=ln(h(ro.x)).mul(Vm(e,t));return s.bicubic(n)}),Mm=w(([o,e,t])=>(H(t.notEqual(0),()=>{const s=gr(e).negate().div(t);return fr(s.negate().mul(o))}),g(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),Rm=w(([o,e,t,s,n,i,r,a,c,l,u,d,m,v])=>{const S=wm(o,e,d,u,a),x=r.add(S),y=l.mul(c.mul(O(x,1))),M=z(y.xy.div(y.w)).toVar();M.addAssign(1),M.divAssign(2),M.assign(z(M.x,M.y.oneMinus()));const L=_m(M,t,u),I=s.mul(Mm(Ns(S),m,v)),D=I.rgb.mul(L.rgb),F=o.dot(e).clamp(),b=g(Qa({dotNV:F,specularColor:n,specularF90:i,roughness:t})),B=I.r.add(I.g,I.b).div(3);return O(b.oneMinus().mul(D),L.a.oneMinus().mul(B).oneMinus())}),Em=et(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),Cm=o=>{const e=o.sqrt();return g(1).add(e).div(g(1).sub(e))},Ai=(o,e)=>o.sub(e).div(o.add(e)).pow2(),Lm=(o,e)=>{const t=o.mul(2*Math.PI*1e-9),s=g(54856e-17,44201e-17,52481e-17),n=g(1681e3,1795300,2208400),i=g(43278e5,93046e5,66121e5),r=h(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=s.mul(i.mul(2*Math.PI).sqrt()).mul(n.mul(t).add(e).cos()).mul(t.pow2().negate().mul(i).exp());return a=g(a.x.add(r),a.y,a.z).div(10685e-11),Em.mul(a)},bm=w(({outsideIOR:o,eta2:e,cosTheta1:t,thinFilmThickness:s,baseF0:n})=>{const i=Te(o,e,gt(0,.03,s)),r=o.div(i).pow2().mul(h(1).sub(t.pow2())),c=h(1).sub(r).sqrt(),l=Ai(i,o),u=ws({f0:l,f90:1,dotVH:t}),d=u.oneMinus(),m=i.lessThan(o).cond(Math.PI,0),v=h(Math.PI).sub(m),S=Cm(n.clamp(0,.9999)),x=Ai(S,i.vec3()),y=ws({f0:x,f90:1,dotVH:c}),M=g(S.x.lessThan(i).cond(Math.PI,0),S.y.lessThan(i).cond(Math.PI,0),S.z.lessThan(i).cond(Math.PI,0)),L=i.mul(s,c,2),I=g(v).add(M),D=u.mul(y).clamp(1e-5,.9999),F=D.sqrt(),b=d.pow2().mul(y).div(g(1).sub(D));let $=u.add(b),Ve=b.sub(d);for(let Me=1;Me<=2;++Me){Ve=Ve.mul(F);const Tn=Lm(h(Me).mul(L),h(Me).mul(I)).mul(2);$=$.add(Ve.mul(Tn))}return $.max(g(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),Im=w(({normal:o,viewDir:e,roughness:t})=>{const s=o.dot(e).saturate(),n=t.pow2(),i=Pe(t.lessThan(.25),h(-339.2).mul(n).add(h(161.4).mul(t)).sub(25.9),h(-8.48).mul(n).add(h(14.3).mul(t)).sub(9.95)),r=Pe(t.lessThan(.25),h(44).mul(n).sub(h(23.7).mul(t)).add(3.26),h(1.97).mul(n).sub(h(3.27).mul(t)).add(.72));return Pe(t.lessThan(.25),0,h(.1).mul(t).sub(.025)).add(i.mul(s).add(r).exp()).mul(1/Math.PI).saturate()}),Bn=g(.04),Un=g(1);class zo extends wo{constructor(e=!1,t=!1,s=!1,n=!1,i=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=s,this.anisotropy=n,this.transmission=i,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=g().temp("clearcoatRadiance"),this.clearcoatSpecularDirect=g().temp("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=g().temp("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=g().temp("sheenSpecularDirect"),this.sheenSpecularIndirect=g().temp("sheenSpecularIndirect")),this.iridescence===!0){const t=ae.dot(ie).clamp();this.iridescenceFresnel=bm({outsideIOR:h(1),eta2:or,cosTheta1:t,thinFilmThickness:ir,baseF0:Ke}),this.iridescenceF0=xm({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=no,s=wd.sub(no).normalize(),n=br;e.backdrop=Rm(n,s,vt,oe,Ke,qs,t,Ts,Nt,rt,Ps,rr,cr,ar),e.backdropAlpha=Jn,oe.a.mulAssign(Te(1,e.backdrop.a,Jn))}}computeMultiscattering(e,t,s){const n=ae.dot(ie).clamp(),i=Ja({roughness:vt,dotNV:n}),a=(this.iridescenceF0?Ao.mix(Ke,this.iridescenceF0):Ke).mul(i.x).add(s.mul(i.y)),l=i.x.add(i.y).oneMinus(),u=Ke.add(Ke.oneMinus().mul(.047619)),d=a.mul(u).div(l.mul(u).oneMinus());e.addAssign(a),t.addAssign(d.mul(l))}direct({lightDirection:e,lightColor:t,reflectedLight:s}){const i=ae.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(i.mul(Sm({lightDirection:e}))),this.clearcoat===!0){const a=Gt.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(Vi({lightDirection:e,f0:Bn,f90:Un,roughness:Hs,normalView:Gt})))}s.directDiffuse.addAssign(i.mul(Js({diffuseColor:oe.rgb}))),s.directSpecular.addAssign(i.mul(Vi({lightDirection:e,f0:Ke,f90:1,roughness:vt,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(Js({diffuseColor:oe})))}indirectSpecular({radiance:e,iblIrradiance:t,reflectedLight:s}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(t.mul(kt,Im({normal:ae,viewDir:ie,roughness:Vo}))),this.clearcoat===!0){const l=Gt.dot(ie).clamp(),u=Qa({dotNV:l,specularColor:Bn,specularF90:Un,roughness:Hs});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(u))}const n=g().temp("singleScattering"),i=g().temp("multiScattering"),r=t.mul(1/Math.PI);this.computeMultiscattering(n,i,qs);const a=n.add(i),c=oe.mul(a.r.max(a.g).max(a.b).oneMinus());s.indirectSpecular.addAssign(e.mul(n)),s.indirectSpecular.addAssign(i.mul(r)),s.indirectDiffuse.addAssign(c.mul(r))}ambientOcclusion({ambientOcclusion:e,reflectedLight:t}){const n=ae.dot(ie).clamp().add(e),i=vt.mul(-16).oneMinus().negate().exp2(),r=e.sub(n.pow(i).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(e),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(e),t.indirectDiffuse.mulAssign(e),t.indirectSpecular.mulAssign(r)}finish(e){const{outgoingLight:t}=e;if(this.clearcoat===!0){const s=Gt.dot(ie).clamp(),n=ws({dotVH:s,f0:Bn,f90:Un}),i=t.mul(Yn.mul(n).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Yn));t.assign(i)}if(this.sheen===!0){const s=kt.r.max(kt.g).max(kt.b).mul(.157).oneMinus(),n=t.mul(s).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(n)}}}const Om=new $n;class ec extends ke{constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(Om),this.setValues(e)}setupLightingModel(){return new zo}setupSpecular(){const e=Te(g(.04),oe.rgb,Ws);Ke.assign(e),qs.assign(1)}setupVariants(){const e=this.metalnessNode?h(this.metalnessNode):Ld;Ws.assign(e);let t=this.roughnessNode?h(this.roughnessNode):Cd;t=pm({roughness:t}),vt.assign(t),this.setupSpecular(),oe.assign(O(oe.rgb.mul(e.oneMinus()),oe.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}_e("MeshStandardNodeMaterial",ec);const zm=new pl;class tc extends ec{constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.anisotropyNode=null,this.setDefaultValues(zm),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}setupSpecular(){const e=this.iorNode?h(this.iorNode):qd;Ps.assign(e),Ke.assign(Te(Kt(Tr(Ps.sub(1).div(Ps.add(1))).mul(Rd),g(1)).mul(ni),oe.rgb,Ws)),qs.assign(Te(ni,1,Ws))}setupLightingModel(){return new zo(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?h(this.clearcoatNode):Id,s=this.clearcoatRoughnessNode?h(this.clearcoatRoughnessNode):Od;Yn.assign(t),Hs.assign(s)}if(this.useSheen){const t=this.sheenNode?g(this.sheenNode):Pd,s=this.sheenRoughnessNode?h(this.sheenRoughnessNode):Fd;kt.assign(t),Vo.assign(s)}if(this.useIridescence){const t=this.iridescenceNode?h(this.iridescenceNode):Ud,s=this.iridescenceIORNode?h(this.iridescenceIORNode):kd,n=this.iridescenceThicknessNode?h(this.iridescenceThicknessNode):Gd;Ao.assign(t),or.assign(s),ir.assign(n)}if(this.useAnisotropy){const t=(this.anisotropyNode?z(this.anisotropyNode):Bd).toVar();Rt.assign(t.length()),H(Rt.equal(0),()=>{t.assign(z(1,0))}).else(()=>{t.divAssign(Rt),Rt.assign(Rt.saturate())}),Zn.assign(Rt.pow2().mix(vt.pow2(),1)),Ds.assign(Wt[0].mul(t.x).add(Wt[1].mul(t.y))),$t.assign(Wt[1].mul(t.x).sub(Wt[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?h(this.transmissionNode):Wd,s=this.thicknessNode?h(this.thicknessNode):Hd,n=this.attenuationDistanceNode?h(this.attenuationDistanceNode):$d,i=this.attenuationColorNode?g(this.attenuationColorNode):jd;Jn.assign(t),rr.assign(s),ar.assign(n),cr.assign(i)}}setupNormal(e){super.setupNormal(e);const t=this.clearcoatNormalNode?g(this.clearcoatNormalNode):zd;Gt.assign(t)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}_e("MeshPhysicalNodeMaterial",tc);class Dm extends zo{constructor(e,t,s,n){super(e,t,s),this.useSSS=n}direct({lightDirection:e,lightColor:t,reflectedLight:s},n,i){if(this.useSSS===!0){const r=i.material,{thicknessColorNode:a,thicknessDistortionNode:c,thicknessAmbientNode:l,thicknessAttenuationNode:u,thicknessPowerNode:d,thicknessScaleNode:m}=r,v=e.add(ae.mul(c)).normalize(),S=h(ie.dot(v.negate()).saturate().pow(d).mul(m)),x=g(S.add(l).mul(a));s.directDiffuse.addAssign(x.mul(u.mul(t)))}super.direct({lightDirection:e,lightColor:t,reflectedLight:s},n,i)}}class Pm extends tc{constructor(e){super(e),this.thicknessColorNode=null,this.thicknessDistortionNode=h(.1),this.thicknessAmbientNode=h(0),this.thicknessAttenuationNode=h(.1),this.thicknessPowerNode=h(2),this.thicknessScaleNode=h(10)}get useSSS(){return this.thicknessColorNode!==null}setupLightingModel(){return new Dm(this.useClearcoat,this.useSheen,this.useIridescence,this.useSSS)}copy(e){return this.thicknessColorNode=e.thicknessColorNode,this.thicknessDistortionNode=e.thicknessDistortionNode,this.thicknessAmbientNode=e.thicknessAmbientNode,this.thicknessAttenuationNode=e.thicknessAttenuationNode,this.thicknessPowerNode=e.thicknessPowerNode,this.thicknessScaleNode=e.thicknessScaleNode,super.copy(e)}}_e("MeshSSSNodeMaterial",Pm);const Fm=new Bt;class Bm extends ke{constructor(e){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.normals=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(Fm),this.setValues(e)}copy(e){return this.sizeNode=e.sizeNode,super.copy(e)}}_e("PointsNodeMaterial",Bm);const Um=new ml;class km extends ke{constructor(e){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this.normals=!1,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(Um),this.setValues(e)}setupPosition({object:e,context:t}){const{positionNode:s,rotationNode:n,scaleNode:i}=this,r=we;let a=It.mul(g(s||0)),c=z(Ts[0].xyz.length(),Ts[1].xyz.length());i!==null&&(c=c.mul(i));let l=r.xy;e.center&&e.center.isVector2===!0&&(l=l.sub(Q(e.center).sub(.5))),l=l.mul(c);const u=h(n||Dd),d=l.rotate(u);a=O(a.xy.add(d),a.zw);const m=rt.mul(a);return t.vertex=r,m}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}}_e("SpriteNodeMaterial",km);class Gm extends wo{constructor(){super(),this.shadowNode=h(1).toVar("shadowMask")}direct({shadowMask:e}){this.shadowNode.mulAssign(e)}finish(e){oe.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(oe.rgb)}}const Wm=new fl;class Hm extends ke{constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Wm),this.setValues(e)}setupLightingModel(){return new Gm}}_e("ShadowNodeMaterial",Hm);const Yt=w(([o,e,t])=>{const s=h(t).toVar(),n=h(e).toVar(),i=bt(o).toVar();return Pe(i,n,s)}),Vs=w(([o,e])=>{const t=bt(e).toVar(),s=h(o).toVar();return Pe(t,s.negate(),s)}),ce=w(([o])=>{const e=h(o).toVar();return p(es(e))}),se=w(([o,e])=>{const t=h(o).toVar();return e.assign(ce(t)),t.sub(h(e))}),sc=w(([o,e,t,s,n,i])=>{const r=h(i).toVar(),a=h(n).toVar(),c=h(s).toVar(),l=h(t).toVar(),u=h(e).toVar(),d=h(o).toVar(),m=h(le(1,a)).toVar();return le(1,r).mul(d.mul(m).add(u.mul(a))).add(r.mul(l.mul(m).add(c.mul(a))))}),nc=w(([o,e,t,s,n,i])=>{const r=h(i).toVar(),a=h(n).toVar(),c=g(s).toVar(),l=g(t).toVar(),u=g(e).toVar(),d=g(o).toVar(),m=h(le(1,a)).toVar();return le(1,r).mul(d.mul(m).add(u.mul(a))).add(r.mul(l.mul(m).add(c.mul(a))))}),oc=Xe([sc,nc]),ic=w(([o,e,t,s,n,i,r,a,c,l,u])=>{const d=h(u).toVar(),m=h(l).toVar(),v=h(c).toVar(),S=h(a).toVar(),x=h(r).toVar(),y=h(i).toVar(),M=h(n).toVar(),L=h(s).toVar(),I=h(t).toVar(),D=h(e).toVar(),F=h(o).toVar(),b=h(le(1,v)).toVar(),B=h(le(1,m)).toVar();return h(le(1,d)).toVar().mul(B.mul(F.mul(b).add(D.mul(v))).add(m.mul(I.mul(b).add(L.mul(v))))).add(d.mul(B.mul(M.mul(b).add(y.mul(v))).add(m.mul(x.mul(b).add(S.mul(v))))))}),rc=w(([o,e,t,s,n,i,r,a,c,l,u])=>{const d=h(u).toVar(),m=h(l).toVar(),v=h(c).toVar(),S=g(a).toVar(),x=g(r).toVar(),y=g(i).toVar(),M=g(n).toVar(),L=g(s).toVar(),I=g(t).toVar(),D=g(e).toVar(),F=g(o).toVar(),b=h(le(1,v)).toVar(),B=h(le(1,m)).toVar();return h(le(1,d)).toVar().mul(B.mul(F.mul(b).add(D.mul(v))).add(m.mul(I.mul(b).add(L.mul(v))))).add(d.mul(B.mul(M.mul(b).add(y.mul(v))).add(m.mul(x.mul(b).add(S.mul(v))))))}),ac=Xe([ic,rc]),cc=w(([o,e,t])=>{const s=h(t).toVar(),n=h(e).toVar(),i=E(o).toVar(),r=E(i.bitAnd(E(7))).toVar(),a=h(Yt(r.lessThan(E(4)),n,s)).toVar(),c=h(q(2,Yt(r.lessThan(E(4)),s,n))).toVar();return Vs(a,bt(r.bitAnd(E(1)))).add(Vs(c,bt(r.bitAnd(E(2)))))}),lc=w(([o,e,t,s])=>{const n=h(s).toVar(),i=h(t).toVar(),r=h(e).toVar(),a=E(o).toVar(),c=E(a.bitAnd(E(15))).toVar(),l=h(Yt(c.lessThan(E(8)),r,i)).toVar(),u=h(Yt(c.lessThan(E(4)),i,Yt(c.equal(E(12)).or(c.equal(E(14))),r,n))).toVar();return Vs(l,bt(c.bitAnd(E(1)))).add(Vs(u,bt(c.bitAnd(E(2)))))}),fe=Xe([cc,lc]),uc=w(([o,e,t])=>{const s=h(t).toVar(),n=h(e).toVar(),i=As(o).toVar();return g(fe(i.x,n,s),fe(i.y,n,s),fe(i.z,n,s))}),dc=w(([o,e,t,s])=>{const n=h(s).toVar(),i=h(t).toVar(),r=h(e).toVar(),a=As(o).toVar();return g(fe(a.x,r,i,n),fe(a.y,r,i,n),fe(a.z,r,i,n))}),He=Xe([uc,dc]),hc=w(([o])=>{const e=h(o).toVar();return q(.6616,e)}),pc=w(([o])=>{const e=h(o).toVar();return q(.982,e)}),mc=w(([o])=>{const e=g(o).toVar();return q(.6616,e)}),fc=Xe([hc,mc]),gc=w(([o])=>{const e=g(o).toVar();return q(.982,e)}),Nc=Xe([pc,gc]),Ee=w(([o,e])=>{const t=p(e).toVar(),s=E(o).toVar();return s.shiftLeft(t).bitOr(s.shiftRight(p(32).sub(t)))}),yc=w(([o,e,t])=>{o.subAssign(t),o.bitXorAssign(Ee(t,p(4))),t.addAssign(e),e.subAssign(o),e.bitXorAssign(Ee(o,p(6))),o.addAssign(t),t.subAssign(e),t.bitXorAssign(Ee(e,p(8))),e.addAssign(o),o.subAssign(t),o.bitXorAssign(Ee(t,p(16))),t.addAssign(e),e.subAssign(o),e.bitXorAssign(Ee(o,p(19))),o.addAssign(t),t.subAssign(e),t.bitXorAssign(Ee(e,p(4))),e.addAssign(o)}),is=w(([o,e,t])=>{const s=E(t).toVar(),n=E(e).toVar(),i=E(o).toVar();return s.bitXorAssign(n),s.subAssign(Ee(n,p(14))),i.bitXorAssign(s),i.subAssign(Ee(s,p(11))),n.bitXorAssign(i),n.subAssign(Ee(i,p(25))),s.bitXorAssign(n),s.subAssign(Ee(n,p(16))),i.bitXorAssign(s),i.subAssign(Ee(s,p(4))),n.bitXorAssign(i),n.subAssign(Ee(i,p(14))),s.bitXorAssign(n),s.subAssign(Ee(n,p(24))),s}),xe=w(([o])=>{const e=E(o).toVar();return h(e).div(h(E(p(4294967295))))}),Qe=w(([o])=>{const e=h(o).toVar();return e.mul(e.mul(e.mul(e.mul(e.mul(6).sub(15)).add(10))))}),xc=w(([o])=>{const e=p(o).toVar(),t=E(E(1)).toVar(),s=E(E(p(3735928559)).add(t.shiftLeft(E(2)).add(E(13)))).toVar();return is(s.add(E(e)),s,s)}),Tc=w(([o,e])=>{const t=p(e).toVar(),s=p(o).toVar(),n=E(E(2)).toVar(),i=E().toVar(),r=E().toVar(),a=E().toVar();return i.assign(r.assign(a.assign(E(p(3735928559)).add(n.shiftLeft(E(2)).add(E(13)))))),i.addAssign(E(s)),r.addAssign(E(t)),is(i,r,a)}),vc=w(([o,e,t])=>{const s=p(t).toVar(),n=p(e).toVar(),i=p(o).toVar(),r=E(E(3)).toVar(),a=E().toVar(),c=E().toVar(),l=E().toVar();return a.assign(c.assign(l.assign(E(p(3735928559)).add(r.shiftLeft(E(2)).add(E(13)))))),a.addAssign(E(i)),c.addAssign(E(n)),l.addAssign(E(s)),is(a,c,l)}),Sc=w(([o,e,t,s])=>{const n=p(s).toVar(),i=p(t).toVar(),r=p(e).toVar(),a=p(o).toVar(),c=E(E(4)).toVar(),l=E().toVar(),u=E().toVar(),d=E().toVar();return l.assign(u.assign(d.assign(E(p(3735928559)).add(c.shiftLeft(E(2)).add(E(13)))))),l.addAssign(E(a)),u.addAssign(E(r)),d.addAssign(E(i)),yc(l,u,d),l.addAssign(E(n)),is(l,u,d)}),wc=w(([o,e,t,s,n])=>{const i=p(n).toVar(),r=p(s).toVar(),a=p(t).toVar(),c=p(e).toVar(),l=p(o).toVar(),u=E(E(5)).toVar(),d=E().toVar(),m=E().toVar(),v=E().toVar();return d.assign(m.assign(v.assign(E(p(3735928559)).add(u.shiftLeft(E(2)).add(E(13)))))),d.addAssign(E(l)),m.addAssign(E(c)),v.addAssign(E(a)),yc(d,m,v),d.addAssign(E(r)),m.addAssign(E(i)),is(d,m,v)}),X=Xe([xc,Tc,vc,Sc,wc]),Vc=w(([o,e])=>{const t=p(e).toVar(),s=p(o).toVar(),n=E(X(s,t)).toVar(),i=As().toVar();return i.x.assign(n.bitAnd(p(255))),i.y.assign(n.shiftRight(p(8)).bitAnd(p(255))),i.z.assign(n.shiftRight(p(16)).bitAnd(p(255))),i}),Ac=w(([o,e,t])=>{const s=p(t).toVar(),n=p(e).toVar(),i=p(o).toVar(),r=E(X(i,n,s)).toVar(),a=As().toVar();return a.x.assign(r.bitAnd(p(255))),a.y.assign(r.shiftRight(p(8)).bitAnd(p(255))),a.z.assign(r.shiftRight(p(16)).bitAnd(p(255))),a}),qe=Xe([Vc,Ac]),_c=w(([o])=>{const e=z(o).toVar(),t=p().toVar(),s=p().toVar(),n=h(se(e.x,t)).toVar(),i=h(se(e.y,s)).toVar(),r=h(Qe(n)).toVar(),a=h(Qe(i)).toVar(),c=h(oc(fe(X(t,s),n,i),fe(X(t.add(p(1)),s),n.sub(1),i),fe(X(t,s.add(p(1))),n,i.sub(1)),fe(X(t.add(p(1)),s.add(p(1))),n.sub(1),i.sub(1)),r,a)).toVar();return fc(c)}),Mc=w(([o])=>{const e=g(o).toVar(),t=p().toVar(),s=p().toVar(),n=p().toVar(),i=h(se(e.x,t)).toVar(),r=h(se(e.y,s)).toVar(),a=h(se(e.z,n)).toVar(),c=h(Qe(i)).toVar(),l=h(Qe(r)).toVar(),u=h(Qe(a)).toVar(),d=h(ac(fe(X(t,s,n),i,r,a),fe(X(t.add(p(1)),s,n),i.sub(1),r,a),fe(X(t,s.add(p(1)),n),i,r.sub(1),a),fe(X(t.add(p(1)),s.add(p(1)),n),i.sub(1),r.sub(1),a),fe(X(t,s,n.add(p(1))),i,r,a.sub(1)),fe(X(t.add(p(1)),s,n.add(p(1))),i.sub(1),r,a.sub(1)),fe(X(t,s.add(p(1)),n.add(p(1))),i,r.sub(1),a.sub(1)),fe(X(t.add(p(1)),s.add(p(1)),n.add(p(1))),i.sub(1),r.sub(1),a.sub(1)),c,l,u)).toVar();return Nc(d)}),qm=Xe([_c,Mc]),Rc=w(([o])=>{const e=z(o).toVar(),t=p().toVar(),s=p().toVar(),n=h(se(e.x,t)).toVar(),i=h(se(e.y,s)).toVar(),r=h(Qe(n)).toVar(),a=h(Qe(i)).toVar(),c=g(oc(He(qe(t,s),n,i),He(qe(t.add(p(1)),s),n.sub(1),i),He(qe(t,s.add(p(1))),n,i.sub(1)),He(qe(t.add(p(1)),s.add(p(1))),n.sub(1),i.sub(1)),r,a)).toVar();return fc(c)}),Ec=w(([o])=>{const e=g(o).toVar(),t=p().toVar(),s=p().toVar(),n=p().toVar(),i=h(se(e.x,t)).toVar(),r=h(se(e.y,s)).toVar(),a=h(se(e.z,n)).toVar(),c=h(Qe(i)).toVar(),l=h(Qe(r)).toVar(),u=h(Qe(a)).toVar(),d=g(ac(He(qe(t,s,n),i,r,a),He(qe(t.add(p(1)),s,n),i.sub(1),r,a),He(qe(t,s.add(p(1)),n),i,r.sub(1),a),He(qe(t.add(p(1)),s.add(p(1)),n),i.sub(1),r.sub(1),a),He(qe(t,s,n.add(p(1))),i,r,a.sub(1)),He(qe(t.add(p(1)),s,n.add(p(1))),i.sub(1),r,a.sub(1)),He(qe(t,s.add(p(1)),n.add(p(1))),i,r.sub(1),a.sub(1)),He(qe(t.add(p(1)),s.add(p(1)),n.add(p(1))),i.sub(1),r.sub(1),a.sub(1)),c,l,u)).toVar();return Nc(d)}),$m=Xe([Rc,Ec]),jm=w(([o])=>{const e=h(o).toVar(),t=p(ce(e)).toVar();return xe(X(t))}),Xm=w(([o])=>{const e=z(o).toVar(),t=p(ce(e.x)).toVar(),s=p(ce(e.y)).toVar();return xe(X(t,s))}),Ym=w(([o])=>{const e=g(o).toVar(),t=p(ce(e.x)).toVar(),s=p(ce(e.y)).toVar(),n=p(ce(e.z)).toVar();return xe(X(t,s,n))}),Zm=w(([o])=>{const e=O(o).toVar(),t=p(ce(e.x)).toVar(),s=p(ce(e.y)).toVar(),n=p(ce(e.z)).toVar(),i=p(ce(e.w)).toVar();return xe(X(t,s,n,i))}),Cc=w(([o])=>{const e=h(o).toVar(),t=p(ce(e)).toVar();return g(xe(X(t,p(0))),xe(X(t,p(1))),xe(X(t,p(2))))}),Lc=w(([o])=>{const e=z(o).toVar(),t=p(ce(e.x)).toVar(),s=p(ce(e.y)).toVar();return g(xe(X(t,s,p(0))),xe(X(t,s,p(1))),xe(X(t,s,p(2))))}),bc=w(([o])=>{const e=g(o).toVar(),t=p(ce(e.x)).toVar(),s=p(ce(e.y)).toVar(),n=p(ce(e.z)).toVar();return g(xe(X(t,s,n,p(0))),xe(X(t,s,n,p(1))),xe(X(t,s,n,p(2))))}),Ic=w(([o])=>{const e=O(o).toVar(),t=p(ce(e.x)).toVar(),s=p(ce(e.y)).toVar(),n=p(ce(e.z)).toVar(),i=p(ce(e.w)).toVar();return g(xe(X(t,s,n,i,p(0))),xe(X(t,s,n,i,p(1))),xe(X(t,s,n,i,p(2))))}),Oc=Xe([Cc,Lc,bc,Ic]),Qs=w(([o,e,t,s])=>{const n=h(s).toVar(),i=h(t).toVar(),r=p(e).toVar(),a=g(o).toVar(),c=h(0).toVar(),l=h(1).toVar();return te({start:p(0),end:r},({i:u})=>{c.addAssign(l.mul(qm(a))),l.mulAssign(n),a.mulAssign(i)}),c}),zc=w(([o,e,t,s])=>{const n=h(s).toVar(),i=h(t).toVar(),r=p(e).toVar(),a=g(o).toVar(),c=g(0).toVar(),l=h(1).toVar();return te({start:p(0),end:r},({i:u})=>{c.addAssign(l.mul($m(a))),l.mulAssign(n),a.mulAssign(i)}),c}),Km=w(([o,e,t,s])=>{const n=h(s).toVar(),i=h(t).toVar(),r=p(e).toVar(),a=g(o).toVar();return z(Qs(a,r,i,n),Qs(a.add(g(p(19),p(193),p(17))),r,i,n))}),Jm=w(([o,e,t,s])=>{const n=h(s).toVar(),i=h(t).toVar(),r=p(e).toVar(),a=g(o).toVar(),c=g(zc(a,r,i,n)).toVar(),l=h(Qs(a.add(g(p(19),p(193),p(17))),r,i,n)).toVar();return O(c,l)}),Dc=w(([o,e,t,s,n,i,r])=>{const a=p(r).toVar(),c=h(i).toVar(),l=p(n).toVar(),u=p(s).toVar(),d=p(t).toVar(),m=p(e).toVar(),v=z(o).toVar(),S=g(Oc(z(m.add(u),d.add(l)))).toVar(),x=z(S.x,S.y).toVar();x.subAssign(.5),x.mulAssign(c),x.addAssign(.5);const y=z(z(h(m),h(d)).add(x)).toVar(),M=z(y.sub(v)).toVar();return H(a.equal(p(2)),()=>ue(M.x).add(ue(M.y))),H(a.equal(p(3)),()=>Ue(ue(M.x),ue(M.y))),ts(M,M)}),Pc=w(([o,e,t,s,n,i,r,a,c])=>{const l=p(c).toVar(),u=h(a).toVar(),d=p(r).toVar(),m=p(i).toVar(),v=p(n).toVar(),S=p(s).toVar(),x=p(t).toVar(),y=p(e).toVar(),M=g(o).toVar(),L=g(Oc(g(y.add(v),x.add(m),S.add(d)))).toVar();L.subAssign(.5),L.mulAssign(u),L.addAssign(.5);const I=g(g(h(y),h(x),h(S)).add(L)).toVar(),D=g(I.sub(M)).toVar();return H(l.equal(p(2)),()=>ue(D.x).add(ue(D.y).add(ue(D.z)))),H(l.equal(p(3)),()=>Ue(Ue(ue(D.x),ue(D.y)),ue(D.z))),ts(D,D)}),rs=Xe([Dc,Pc]),Qm=w(([o,e,t])=>{const s=p(t).toVar(),n=h(e).toVar(),i=z(o).toVar(),r=p().toVar(),a=p().toVar(),c=z(se(i.x,r),se(i.y,a)).toVar(),l=h(1e6).toVar();return te({start:-1,end:p(1),name:"x",condition:"<="},({x:u})=>{te({start:-1,end:p(1),name:"y",condition:"<="},({y:d})=>{const m=h(rs(c,u,d,r,a,n,s)).toVar();l.assign(Kt(l,m))})}),H(s.equal(p(0)),()=>{l.assign(Dt(l))}),l}),ef=w(([o,e,t])=>{const s=p(t).toVar(),n=h(e).toVar(),i=z(o).toVar(),r=p().toVar(),a=p().toVar(),c=z(se(i.x,r),se(i.y,a)).toVar(),l=z(1e6,1e6).toVar();return te({start:-1,end:p(1),name:"x",condition:"<="},({x:u})=>{te({start:-1,end:p(1),name:"y",condition:"<="},({y:d})=>{const m=h(rs(c,u,d,r,a,n,s)).toVar();H(m.lessThan(l.x),()=>{l.y.assign(l.x),l.x.assign(m)}).elseif(m.lessThan(l.y),()=>{l.y.assign(m)})})}),H(s.equal(p(0)),()=>{l.assign(Dt(l))}),l}),tf=w(([o,e,t])=>{const s=p(t).toVar(),n=h(e).toVar(),i=z(o).toVar(),r=p().toVar(),a=p().toVar(),c=z(se(i.x,r),se(i.y,a)).toVar(),l=g(1e6,1e6,1e6).toVar();return te({start:-1,end:p(1),name:"x",condition:"<="},({x:u})=>{te({start:-1,end:p(1),name:"y",condition:"<="},({y:d})=>{const m=h(rs(c,u,d,r,a,n,s)).toVar();H(m.lessThan(l.x),()=>{l.z.assign(l.y),l.y.assign(l.x),l.x.assign(m)}).elseif(m.lessThan(l.y),()=>{l.z.assign(l.y),l.y.assign(m)}).elseif(m.lessThan(l.z),()=>{l.z.assign(m)})})}),H(s.equal(p(0)),()=>{l.assign(Dt(l))}),l}),sf=w(([o,e,t])=>{const s=p(t).toVar(),n=h(e).toVar(),i=g(o).toVar(),r=p().toVar(),a=p().toVar(),c=p().toVar(),l=g(se(i.x,r),se(i.y,a),se(i.z,c)).toVar(),u=h(1e6).toVar();return te({start:-1,end:p(1),name:"x",condition:"<="},({x:d})=>{te({start:-1,end:p(1),name:"y",condition:"<="},({y:m})=>{te({start:-1,end:p(1),name:"z",condition:"<="},({z:v})=>{const S=h(rs(l,d,m,v,r,a,c,n,s)).toVar();u.assign(Kt(u,S))})})}),H(s.equal(p(0)),()=>{u.assign(Dt(u))}),u}),nf=w(([o,e,t])=>{const s=p(t).toVar(),n=h(e).toVar(),i=g(o).toVar(),r=p().toVar(),a=p().toVar(),c=p().toVar(),l=g(se(i.x,r),se(i.y,a),se(i.z,c)).toVar(),u=z(1e6,1e6).toVar();return te({start:-1,end:p(1),name:"x",condition:"<="},({x:d})=>{te({start:-1,end:p(1),name:"y",condition:"<="},({y:m})=>{te({start:-1,end:p(1),name:"z",condition:"<="},({z:v})=>{const S=h(rs(l,d,m,v,r,a,c,n,s)).toVar();H(S.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(S)}).elseif(S.lessThan(u.y),()=>{u.y.assign(S)})})})}),H(s.equal(p(0)),()=>{u.assign(Dt(u))}),u}),of=w(([o,e,t])=>{const s=p(t).toVar(),n=h(e).toVar(),i=g(o).toVar(),r=p().toVar(),a=p().toVar(),c=p().toVar(),l=g(se(i.x,r),se(i.y,a),se(i.z,c)).toVar(),u=g(1e6,1e6,1e6).toVar();return te({start:-1,end:p(1),name:"x",condition:"<="},({x:d})=>{te({start:-1,end:p(1),name:"y",condition:"<="},({y:m})=>{te({start:-1,end:p(1),name:"z",condition:"<="},({z:v})=>{const S=h(rs(l,d,m,v,r,a,c,n,s)).toVar();H(S.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(S)}).elseif(S.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(S)}).elseif(S.lessThan(u.z),()=>{u.z.assign(S)})})})}),H(s.equal(p(0)),()=>{u.assign(Dt(u))}),u});Yt.setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]});Vs.setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]});ce.setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]});sc.setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]});nc.setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]});ic.setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]});rc.setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]});cc.setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]});lc.setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]});uc.setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]});dc.setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]});hc.setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]});pc.setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]});mc.setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]});gc.setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]});Ee.setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]});is.setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]});xe.setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]});Qe.setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]});xc.setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]});Tc.setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]});vc.setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]});Sc.setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]});wc.setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]});Vc.setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]});Ac.setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]});_c.setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]});Mc.setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]});Rc.setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]});Ec.setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]});jm.setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]});Xm.setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]});Ym.setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]});Zm.setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]});Cc.setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]});Lc.setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]});bc.setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]});Ic.setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]});Qs.setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});zc.setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});Km.setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});Jm.setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});Dc.setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Pc.setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Qm.setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});ef.setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});tf.setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});sf.setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});nf.setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});of.setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});const rf=w(([o])=>{const e=g(o).toVar(),t=h(e.x).toVar(),s=h(e.y).toVar(),n=h(e.z).toVar();H(s.lessThan(1e-4),()=>g(n,n,n)).else(()=>{t.assign(q(6,t.sub(es(t))));const i=p(yr(t)).toVar(),r=h(t.sub(h(i))).toVar(),a=h(n.mul(le(1,s))).toVar(),c=h(n.mul(le(1,s.mul(r)))).toVar(),l=h(n.mul(le(1,s.mul(le(1,r))))).toVar();return H(i.equal(p(0)),()=>g(n,l,a)).elseif(i.equal(p(1)),()=>g(c,n,a)).elseif(i.equal(p(2)),()=>g(a,n,l)).elseif(i.equal(p(3)),()=>g(a,c,n)).elseif(i.equal(p(4)),()=>g(l,a,n)),g(n,a,c)})}),af=w(([o])=>{const e=g(o).toVar(),t=h(e.x).toVar(),s=h(e.y).toVar(),n=h(e.z).toVar(),i=h(Kt(t,Kt(s,n))).toVar(),r=h(Ue(t,Ue(s,n))).toVar(),a=h(r.sub(i)).toVar(),c=h().toVar(),l=h().toVar(),u=h().toVar();return u.assign(r),H(r.greaterThan(0),()=>{l.assign(a.div(r))}).else(()=>{l.assign(0)}),H(l.lessThanEqual(0),()=>{c.assign(0)}).else(()=>{H(t.greaterThanEqual(r),()=>{c.assign(s.sub(n).div(a))}).elseif(s.greaterThanEqual(r),()=>{c.assign(Be(2,n.sub(t).div(a)))}).else(()=>{c.assign(Be(4,t.sub(s).div(a)))}),c.mulAssign(1/6),H(c.lessThan(0),()=>{c.addAssign(1)})}),g(c,l,u)});rf.setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]});af.setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]});const cf=w(([o])=>{const e=g(o).toVar(),t=Zi(hr(e,g(.04045))).toVar(),s=g(e.div(12.92)).toVar(),n=g(ct(Ue(e.add(g(.055)),g(0)).div(1.055),g(2.4))).toVar();return Te(s,n,t)});cf.setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]});class xn{constructor(e=new W(0,0,0),t=new W(0,1,0),s=1){this.start=e,this.end=t,this.radius=s}clone(){return new xn(this.start.clone(),this.end.clone(),this.radius)}set(e,t,s){this.start.copy(e),this.end.copy(t),this.radius=s}copy(e){this.start.copy(e.start),this.end.copy(e.end),this.radius=e.radius}getCenter(e){return e.copy(this.end).add(this.start).multiplyScalar(.5)}translate(e){this.start.add(e),this.end.add(e)}checkAABBAxis(e,t,s,n,i,r,a,c,l){return(i-e<l||i-s<l)&&(e-r<l||s-r<l)&&(a-t<l||a-n<l)&&(t-c<l||n-c<l)}intersectsBox(e){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,e.min.x,e.max.x,e.min.y,e.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,e.min.x,e.max.x,e.min.z,e.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,e.min.y,e.max.y,e.min.z,e.max.z,this.radius)}}const ds=new W,hs=new W,bs=new W,ps=new W,nt=new Fi,kn=new Ui,lf=new Ui,Is=new gl,ms=new xn,uf=new W,df=new W,hf=new W,pf=1e-10;function mf(o,e,t=null,s=null){const n=uf.copy(o.end).sub(o.start),i=df.copy(e.end).sub(e.start),r=hf.copy(e.start).sub(o.start),a=n.dot(i),c=n.dot(n),l=i.dot(i),u=i.dot(r),d=n.dot(r);let m,v;const S=c*l-a*a;if(Math.abs(S)<pf){const x=-u/l,y=(a-u)/l;Math.abs(x-.5)<Math.abs(y-.5)?(m=0,v=x):(m=1,v=y)}else m=(u*a+d*l)/S,v=(m*a-u)/l;v=Math.max(0,Math.min(1,v)),m=Math.max(0,Math.min(1,m)),t&&t.copy(n).multiplyScalar(m).add(o.start),s&&s.copy(i).multiplyScalar(v).add(e.start)}class Do{constructor(e){this.box=e,this.bounds=new Wo,this.subTrees=[],this.triangles=[],this.layers=new Nl}addTriangle(e){return this.bounds.min.x=Math.min(this.bounds.min.x,e.a.x,e.b.x,e.c.x),this.bounds.min.y=Math.min(this.bounds.min.y,e.a.y,e.b.y,e.c.y),this.bounds.min.z=Math.min(this.bounds.min.z,e.a.z,e.b.z,e.c.z),this.bounds.max.x=Math.max(this.bounds.max.x,e.a.x,e.b.x,e.c.x),this.bounds.max.y=Math.max(this.bounds.max.y,e.a.y,e.b.y,e.c.y),this.bounds.max.z=Math.max(this.bounds.max.z,e.a.z,e.b.z,e.c.z),this.triangles.push(e),this}calcBox(){return this.box=this.bounds.clone(),this.box.min.x-=.01,this.box.min.y-=.01,this.box.min.z-=.01,this}split(e){if(!this.box)return;const t=[],s=hs.copy(this.box.max).sub(this.box.min).multiplyScalar(.5);for(let i=0;i<2;i++)for(let r=0;r<2;r++)for(let a=0;a<2;a++){const c=new Wo,l=ds.set(i,r,a);c.min.copy(this.box.min).add(l.multiply(s)),c.max.copy(c.min).add(s),t.push(new Do(c))}let n;for(;n=this.triangles.pop();)for(let i=0;i<t.length;i++)t[i].box.intersectsTriangle(n)&&t[i].triangles.push(n);for(let i=0;i<t.length;i++){const r=t[i].triangles.length;r>8&&e<16&&t[i].split(e+1),r!==0&&this.subTrees.push(t[i])}return this}build(){return this.calcBox(),this.split(0),this}getRayTriangles(e,t){for(let s=0;s<this.subTrees.length;s++){const n=this.subTrees[s];if(e.intersectsBox(n.box))if(n.triangles.length>0)for(let i=0;i<n.triangles.length;i++)t.indexOf(n.triangles[i])===-1&&t.push(n.triangles[i]);else n.getRayTriangles(e,t)}return t}triangleCapsuleIntersect(e,t){t.getPlane(nt);const s=nt.distanceToPoint(e.start)-e.radius,n=nt.distanceToPoint(e.end)-e.radius;if(s>0&&n>0||s<-e.radius&&n<-e.radius)return!1;const i=Math.abs(s/(Math.abs(s)+Math.abs(n))),r=ds.copy(e.start).lerp(e.end,i);if(t.containsPoint(r))return{normal:nt.normal.clone(),point:r.clone(),depth:Math.abs(Math.min(s,n))};const a=e.radius*e.radius,c=kn.set(e.start,e.end),l=[[t.a,t.b],[t.b,t.c],[t.c,t.a]];for(let u=0;u<l.length;u++){const d=lf.set(l[u][0],l[u][1]);if(mf(c,d,bs,ps),bs.distanceToSquared(ps)<a)return{normal:bs.clone().sub(ps).normalize(),point:ps.clone(),depth:e.radius-bs.distanceTo(ps)}}return!1}triangleSphereIntersect(e,t){if(t.getPlane(nt),!e.intersectsPlane(nt))return!1;const s=Math.abs(nt.distanceToSphere(e)),n=e.radius*e.radius-s*s,i=nt.projectPoint(e.center,ds);if(t.containsPoint(e.center))return{normal:nt.normal.clone(),point:i.clone(),depth:Math.abs(nt.distanceToSphere(e))};const r=[[t.a,t.b],[t.b,t.c],[t.c,t.a]];for(let a=0;a<r.length;a++){kn.set(r[a][0],r[a][1]),kn.closestPointToPoint(i,!0,hs);const c=hs.distanceToSquared(e.center);if(c<n)return{normal:e.center.clone().sub(hs).normalize(),point:hs.clone(),depth:e.radius-Math.sqrt(c)}}return!1}getSphereTriangles(e,t){for(let s=0;s<this.subTrees.length;s++){const n=this.subTrees[s];if(e.intersectsBox(n.box))if(n.triangles.length>0)for(let i=0;i<n.triangles.length;i++)t.indexOf(n.triangles[i])===-1&&t.push(n.triangles[i]);else n.getSphereTriangles(e,t)}}getCapsuleTriangles(e,t){for(let s=0;s<this.subTrees.length;s++){const n=this.subTrees[s];if(e.intersectsBox(n.box))if(n.triangles.length>0)for(let i=0;i<n.triangles.length;i++)t.indexOf(n.triangles[i])===-1&&t.push(n.triangles[i]);else n.getCapsuleTriangles(e,t)}}sphereIntersect(e){Is.copy(e);const t=[];let s,n=!1;this.getSphereTriangles(e,t);for(let i=0;i<t.length;i++)(s=this.triangleSphereIntersect(Is,t[i]))&&(n=!0,Is.center.add(s.normal.multiplyScalar(s.depth)));if(n){const i=Is.center.clone().sub(e.center),r=i.length();return{normal:i.normalize(),depth:r}}return!1}capsuleIntersect(e){ms.copy(e);const t=[];let s,n=!1;this.getCapsuleTriangles(ms,t);for(let i=0;i<t.length;i++)(s=this.triangleCapsuleIntersect(ms,t[i]))&&(n=!0,ms.translate(s.normal.multiplyScalar(s.depth)));if(n){const i=ms.getCenter(new W).sub(e.getCenter(ds)),r=i.length();return{normal:i.normalize(),depth:r}}return!1}rayIntersect(e){if(e.direction.length()===0)return;const t=[];let s,n,i=1e100;this.getRayTriangles(e,t);for(let r=0;r<t.length;r++){const a=e.intersectTriangle(t[r].a,t[r].b,t[r].c,!0,ds);if(a){const c=a.sub(e.origin).length();i>c&&(n=a.clone().add(e.origin),i=c,s=t[r])}}return i<1e100?{distance:i,triangle:s,position:n}:!1}fromGraphNode(e){return e.updateWorldMatrix(!0,!0),e.traverse(t=>{if(t.isMesh===!0&&this.layers.test(t.layers)){let s,n=!1;t.geometry.index!==null?(n=!0,s=t.geometry.toNonIndexed()):s=t.geometry;const i=s.getAttribute("position");for(let r=0;r<i.count;r+=3){const a=new W().fromBufferAttribute(i,r),c=new W().fromBufferAttribute(i,r+1),l=new W().fromBufferAttribute(i,r+2);a.applyMatrix4(t.matrixWorld),c.applyMatrix4(t.matrixWorld),l.applyMatrix4(t.matrixWorld),this.addTriangle(new yl(a,c,l))}n&&s.dispose()}}),this.build(),this}clear(){return this.box=null,this.bounds.makeEmpty(),this.subTrees.length=0,this.triangles.length=0,this}}const ff=/^[og]\s*(.+)?/,gf=/^mtllib /,Nf=/^usemtl /,yf=/^usemap /,_i=/\s+/,Mi=new W,Gn=new W,Ri=new W,Ei=new W,We=new W,Os=new en;function xf(){const o={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1){this.object.name=e,this.object.fromDeclaration=t!==!1;return}const s=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(n,i){const r=this._finalize(!1);r&&(r.inherited||r.groupCount<=0)&&this.materials.splice(r.index,1);const a={index:this.materials.length,name:n||"",mtllib:Array.isArray(i)&&i.length>0?i[i.length-1]:"",smooth:r!==void 0?r.smooth:this.smooth,groupStart:r!==void 0?r.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(c){const l={index:typeof c=="number"?c:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return l.clone=this.clone.bind(l),l}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(n){const i=this.currentMaterial();if(i&&i.groupEnd===-1&&(i.groupEnd=this.geometry.vertices.length/3,i.groupCount=i.groupEnd-i.groupStart,i.inherited=!1),n&&this.materials.length>1)for(let r=this.materials.length-1;r>=0;r--)this.materials[r].groupCount<=0&&this.materials.splice(r,1);return n&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),i}},s&&s.name&&typeof s.clone=="function"){const n=s.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const s=parseInt(e,10);return(s>=0?s-1:s+t/3)*3},parseNormalIndex:function(e,t){const s=parseInt(e,10);return(s>=0?s-1:s+t/3)*3},parseUVIndex:function(e,t){const s=parseInt(e,10);return(s>=0?s-1:s+t/2)*2},addVertex:function(e,t,s){const n=this.vertices,i=this.object.geometry.vertices;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[s+0],n[s+1],n[s+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,s){const n=this.normals,i=this.object.geometry.normals;i.push(n[e+0],n[e+1],n[e+2]),i.push(n[t+0],n[t+1],n[t+2]),i.push(n[s+0],n[s+1],n[s+2])},addFaceNormal:function(e,t,s){const n=this.vertices,i=this.object.geometry.normals;Mi.fromArray(n,e),Gn.fromArray(n,t),Ri.fromArray(n,s),We.subVectors(Ri,Gn),Ei.subVectors(Mi,Gn),We.cross(Ei),We.normalize(),i.push(We.x,We.y,We.z),i.push(We.x,We.y,We.z),i.push(We.x,We.y,We.z)},addColor:function(e,t,s){const n=this.colors,i=this.object.geometry.colors;n[e]!==void 0&&i.push(n[e+0],n[e+1],n[e+2]),n[t]!==void 0&&i.push(n[t+0],n[t+1],n[t+2]),n[s]!==void 0&&i.push(n[s+0],n[s+1],n[s+2])},addUV:function(e,t,s){const n=this.uvs,i=this.object.geometry.uvs;i.push(n[e+0],n[e+1]),i.push(n[t+0],n[t+1]),i.push(n[s+0],n[s+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,s,n,i,r,a,c,l){const u=this.vertices.length;let d=this.parseVertexIndex(e,u),m=this.parseVertexIndex(t,u),v=this.parseVertexIndex(s,u);if(this.addVertex(d,m,v),this.addColor(d,m,v),a!==void 0&&a!==""){const S=this.normals.length;d=this.parseNormalIndex(a,S),m=this.parseNormalIndex(c,S),v=this.parseNormalIndex(l,S),this.addNormal(d,m,v)}else this.addFaceNormal(d,m,v);if(n!==void 0&&n!==""){const S=this.uvs.length;d=this.parseUVIndex(n,S),m=this.parseUVIndex(i,S),v=this.parseUVIndex(r,S),this.addUV(d,m,v),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let s=0,n=e.length;s<n;s++){const i=this.parseVertexIndex(e[s],t);this.addVertexPoint(i),this.addColor(i)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const s=this.vertices.length,n=this.uvs.length;for(let i=0,r=e.length;i<r;i++)this.addVertexLine(this.parseVertexIndex(e[i],s));for(let i=0,r=t.length;i<r;i++)this.addUVLine(this.parseUVIndex(t[i],n))}};return o.startObject("",!1),o}class Tf extends xl{constructor(e){super(e),this.materials=null}load(e,t,s,n){const i=this,r=new Tl(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(a){try{t(i.parse(a))}catch(c){n?n(c):console.error(c),i.manager.itemError(e)}},s,n)}setMaterials(e){return this.materials=e,this}parse(e){const t=new xf;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const s=e.split(`
`);let n=[];for(let a=0,c=s.length;a<c;a++){const l=s[a].trimStart();if(l.length===0)continue;const u=l.charAt(0);if(u!=="#")if(u==="v"){const d=l.split(_i);switch(d[0]){case"v":t.vertices.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])),d.length>=7?(Os.setRGB(parseFloat(d[4]),parseFloat(d[5]),parseFloat(d[6])).convertSRGBToLinear(),t.colors.push(Os.r,Os.g,Os.b)):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));break;case"vt":t.uvs.push(parseFloat(d[1]),parseFloat(d[2]));break}}else if(u==="f"){const m=l.slice(1).trim().split(_i),v=[];for(let x=0,y=m.length;x<y;x++){const M=m[x];if(M.length>0){const L=M.split("/");v.push(L)}}const S=v[0];for(let x=1,y=v.length-1;x<y;x++){const M=v[x],L=v[x+1];t.addFace(S[0],M[0],L[0],S[1],M[1],L[1],S[2],M[2],L[2])}}else if(u==="l"){const d=l.substring(1).trim().split(" ");let m=[];const v=[];if(l.indexOf("/")===-1)m=d;else for(let S=0,x=d.length;S<x;S++){const y=d[S].split("/");y[0]!==""&&m.push(y[0]),y[1]!==""&&v.push(y[1])}t.addLineGeometry(m,v)}else if(u==="p"){const m=l.slice(1).trim().split(" ");t.addPointGeometry(m)}else if((n=ff.exec(l))!==null){const d=(" "+n[0].slice(1).trim()).slice(1);t.startObject(d)}else if(Nf.test(l))t.object.startMaterial(l.substring(7).trim(),t.materialLibraries);else if(gf.test(l))t.materialLibraries.push(l.substring(7).trim());else if(yf.test(l))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(u==="s"){if(n=l.split(" "),n.length>1){const m=n[1].trim().toLowerCase();t.object.smooth=m!=="0"&&m!=="off"}else t.object.smooth=!0;const d=t.object.currentMaterial();d&&(d.smooth=t.object.smooth)}else{if(l==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+l+'"')}}t.finalize();const i=new vl;if(i.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0)===!0)for(let a=0,c=t.objects.length;a<c;a++){const l=t.objects[a],u=l.geometry,d=l.materials,m=u.type==="Line",v=u.type==="Points";let S=!1;if(u.vertices.length===0)continue;const x=new qn;x.setAttribute("position",new yt(u.vertices,3)),u.normals.length>0&&x.setAttribute("normal",new yt(u.normals,3)),u.colors.length>0&&(S=!0,x.setAttribute("color",new yt(u.colors,3))),u.hasUVIndices===!0&&x.setAttribute("uv",new yt(u.uvs,2));const y=[];for(let L=0,I=d.length;L<I;L++){const D=d[L],F=D.name+"_"+D.smooth+"_"+S;let b=t.materials[F];if(this.materials!==null){if(b=this.materials.create(D.name),m&&b&&!(b instanceof zs)){const B=new zs;Hn.prototype.copy.call(B,b),B.color.copy(b.color),b=B}else if(v&&b&&!(b instanceof Bt)){const B=new Bt({size:10,sizeAttenuation:!1});Hn.prototype.copy.call(B,b),B.color.copy(b.color),B.map=b.map,b=B}}b===void 0&&(m?b=new zs:v?b=new Bt({size:1,sizeAttenuation:!1}):b=new Us,b.name=D.name,b.flatShading=!D.smooth,b.vertexColors=S,t.materials[F]=b),y.push(b)}let M;if(y.length>1){for(let L=0,I=d.length;L<I;L++){const D=d[L];x.addGroup(D.groupStart,D.groupCount,L)}m?M=new Ho(x,y):v?M=new Sn(x,y):M=new ys(x,y)}else m?M=new Ho(x,y[0]):v?M=new Sn(x,y[0]):M=new ys(x,y[0]);M.name=l.name,i.add(M)}else if(t.vertices.length>0){const a=new Bt({size:1,sizeAttenuation:!1}),c=new qn;c.setAttribute("position",new yt(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(c.setAttribute("color",new yt(t.colors,3)),a.vertexColors=!0);const l=new Sn(c,a);i.add(l)}return i}}const Ci=new W,vf=new Sl,Li=new W;class bi extends ki{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const ot=new tn,Sf=new tn;class wf{constructor(e={}){const t=this;let s,n,i,r;const a={camera:{style:""},objects:new WeakMap},c=e.element!==void 0?e.element:document.createElement("div");c.style.overflow="hidden",this.domElement=c;const l=document.createElement("div");l.style.transformOrigin="0 0",l.style.pointerEvents="none",c.appendChild(l);const u=document.createElement("div");u.style.transformStyle="preserve-3d",l.appendChild(u),this.getSize=function(){return{width:s,height:n}},this.render=function(x,y){const M=y.projectionMatrix.elements[5]*r;y.view&&y.view.enabled?(l.style.transform=`translate( ${-y.view.offsetX*(s/y.view.width)}px, ${-y.view.offsetY*(n/y.view.height)}px )`,l.style.transform+=`scale( ${y.view.fullWidth/y.view.width}, ${y.view.fullHeight/y.view.height} )`):l.style.transform="",x.matrixWorldAutoUpdate===!0&&x.updateMatrixWorld(),y.parent===null&&y.matrixWorldAutoUpdate===!0&&y.updateMatrixWorld();let L,I;y.isOrthographicCamera&&(L=-(y.right+y.left)/2,I=(y.top+y.bottom)/2);const D=y.view&&y.view.enabled?y.view.height/y.view.fullHeight:1,F=y.isOrthographicCamera?`scale( ${D} )scale(`+M+")translate("+d(L)+"px,"+d(I)+"px)"+m(y.matrixWorldInverse):`scale( ${D} )translateZ(`+M+"px)"+m(y.matrixWorldInverse),B=(y.isPerspectiveCamera?"perspective("+M+"px) ":"")+F+"translate("+i+"px,"+r+"px)";a.camera.style!==B&&(u.style.transform=B,a.camera.style=B),S(x,x,y)},this.setSize=function(x,y){s=x,n=y,i=s/2,r=n/2,c.style.width=x+"px",c.style.height=y+"px",l.style.width=x+"px",l.style.height=y+"px",u.style.width=x+"px",u.style.height=y+"px"};function d(x){return Math.abs(x)<1e-10?0:x}function m(x){const y=x.elements;return"matrix3d("+d(y[0])+","+d(-y[1])+","+d(y[2])+","+d(y[3])+","+d(y[4])+","+d(-y[5])+","+d(y[6])+","+d(y[7])+","+d(y[8])+","+d(-y[9])+","+d(y[10])+","+d(y[11])+","+d(y[12])+","+d(-y[13])+","+d(y[14])+","+d(y[15])+")"}function v(x){const y=x.elements;return"translate(-50%,-50%)"+("matrix3d("+d(y[0])+","+d(y[1])+","+d(y[2])+","+d(y[3])+","+d(-y[4])+","+d(-y[5])+","+d(-y[6])+","+d(-y[7])+","+d(y[8])+","+d(y[9])+","+d(y[10])+","+d(y[11])+","+d(y[12])+","+d(y[13])+","+d(y[14])+","+d(y[15])+")")}function S(x,y,M,L){if(x.isCSS3DObject){const I=x.visible===!0&&x.layers.test(M.layers)===!0;if(x.element.style.display=I===!0?"":"none",I===!0){x.onBeforeRender(t,y,M);let D;x.isCSS3DSprite?(ot.copy(M.matrixWorldInverse),ot.transpose(),x.rotation2D!==0&&ot.multiply(Sf.makeRotationZ(x.rotation2D)),x.matrixWorld.decompose(Ci,vf,Li),ot.setPosition(Ci),ot.scale(Li),ot.elements[3]=0,ot.elements[7]=0,ot.elements[11]=0,ot.elements[15]=1,D=v(ot)):D=v(x.matrixWorld);const F=x.element,b=a.objects.get(x);if(b===void 0||b.style!==D){F.style.transform=D;const B={style:D};a.objects.set(x,B)}F.parentNode!==u&&u.appendChild(F),x.onAfterRender(t,y,M)}}for(let I=0,D=x.children.length;I<D;I++)S(x.children[I],y,M)}}}function Rf(){const o=Uo.useRef(null);let e,t,s=[],n=[],i=!1;return Uo.useEffect(()=>{const r=o.current;if(r){let a=function(C){x.traverse(G=>{G.remove(C)})},c=function(C){let G=Math.exp(-4*C)-1;Ft||(Ye.y-=Fc*C,G*=.1),Ye.addScaledVector(Ye,G);const Ie=Ye.clone().multiplyScalar(C);Me.translate(Ie),v(),y.position.copy(Me.end)},l=function(){y.position.y<=-4&&(Me.start.set(0,.35,0),Me.end.set(0,1,0),Me.radius=.35,y.position.copy(Me.end),y.rotation.set(0,0,0))},u=function(){return y.getWorldDirection(pt),pt.y=0,pt.normalize(),pt},d=function(){return y.getWorldDirection(pt),pt.y=0,pt.normalize(),pt.cross(y.up),pt},m=function(C){const G=C*(Ft?150:100);ht.KeyW&&Ye.add(u().multiplyScalar(G)),ht.KeyS&&Ye.add(u().multiplyScalar(-G)),ht.KeyA&&Ye.add(d().multiplyScalar(-G)),ht.KeyD&&Ye.add(d().multiplyScalar(G)),Ft&&ht.Space&&(Ye.y=15)},v=function(){const C=Po.capsuleIntersect(Me);Ft=!1,C&&(Ft=C.normal.y>0,Ft||Ye.addScaledVector(C.normal,-C.normal.dot(Ye)),Me.translate(C.normal.multiplyScalar(C.depth)))},S=function(C,G,Ie){const Oe=new $o(1,.5,1),Ze=new $n({color:65280}),Ge=new ys(Oe,Ze);x.add(Ge),Ge.position.set(C,G,Ie);const as=new $o(1.4,.1,1.4),Bc=new $n({color:65280}),Bo=new ys(as,Bc);return Ge.add(Bo),Bo.position.set(0,.25,0),Ge};e=new Al(r),e.init(),e.update(),e.updateSize(),e.test=!1,e.test&&e.addOrbitControls();const{scene:x,camera:y,renderer:M}=e,L=e.createRoom.bind(e);M.shadowMap.type=wl,M.shadowMap.enabled=!0,y.position.set(4,2,0),y.lookAt(0,2,0);let I=0;const D=[];{const C=new fs(16711680,150);C.position.set(0,I,0),D.push(C)}{const C=new fs(65280,150,100);C.position.set(48,I,0),D.push(C)}{const C=new fs(255,150,100);C.position.set(25,I,26),D.push(C)}{const C=new fs(16776960,150,100);C.position.set(28,I,-28),D.push(C)}D.forEach(C=>{x.add(C)});const F=new go(16777215);F.visible=!1,F.position.set(0,0,0),F.intensity=2,F.angle=Math.PI/6,F.penumbra=.1,F.decay=.1,F.distance=0,F.lookAt(0,0,0),F.shadow.mapSize.width=1024,F.shadow.mapSize.height=1024,F.shadow.camera.near=500,F.shadow.camera.far=4e3,F.shadow.camera.fov=30,y.add(F),y.add(F.target),F.position.y=-.3,F.target.position.y=.15,F.target.position.z=-1;const b=1,B=1,$=new Us({color:"#fff",side:qo,wireframe:!1}),Ve=new Us({color:"#fff",side:qo,wireframe:!1});{const{left:C,right:G,after:Ie,before:Oe,obj:Ze}=L({box:{width:20,height:10,length:40,thickness:b,pillar:B},material:$,pillarMaterial:Ve,position:{x:0,y:0,z:0}});a(C),a(G),e.createModel(Ze)}{const{left:C,right:G,after:Ie,before:Oe}=L({box:{width:20,height:10,length:10,thickness:b,pillar:B},material:$,pillarMaterial:Ve,position:{x:0,y:0,z:26}});a(Ie),a(G)}{const{after:C,before:G}=L({box:{width:30,height:10,length:10,thickness:b,pillar:B},material:$,pillarMaterial:Ve,position:{x:26,y:0,z:26}});a(C),a(G)}{const{right:C,before:G}=L({box:{width:10,height:10,length:10,thickness:b,pillar:B},material:$,pillarMaterial:Ve,position:{x:47,y:0,z:26}});a(C),a(G)}{const{right:C,left:G}=L({box:{width:10,height:10,length:40,thickness:b,pillar:B},material:$,pillarMaterial:Ve,position:{x:47,y:0,z:0}});a(C),a(G)}{const{left:C,before:G}=L({box:{width:10,height:10,length:10,thickness:b,pillar:B},material:$,pillarMaterial:Ve,position:{x:47,y:0,z:-26}});a(C),a(G)}{const{after:C,before:G}=L({box:{width:30,height:10,length:10,thickness:b,pillar:B},material:$,pillarMaterial:Ve,position:{x:26,y:0,z:-26}});a(C),a(G)}{const{after:C,left:G}=L({box:{width:20,height:10,length:10,thickness:b,pillar:B},material:$,pillarMaterial:Ve,position:{x:0,y:0,z:-26}});a(C),a(G)}y.rotation.order="YXZ";const Me=new xn(new W(0,.35,0),new W(0,1,0),.35),Tn=new Vl,Po=new Do;Me.translate(new W(3,.35,0));const Fc=30,Fo=15;e.addAction(()=>{const C=Math.min(.05,Tn.getDelta())/Fo;for(let G=0;G<Fo;G++)e.test||(m(C),c(C),l())});const Ye=new W;let Ft=!1;const ht={};document.addEventListener("keydown",C=>{ht[C.code]=!0,ht.KeyF&&(F.visible=!F.visible),ht.KeyE&&s.forEach(G=>{G.position.distanceTo(y.position)<14&&(G.element.style.opacity!=1?(G.element.style.opacity=1,i=!0):(i=!1,G.element.style.opacity=0)),G.lookAt(y.position)})}),document.addEventListener("keyup",C=>{ht[C.code]=!1}),r.addEventListener("mousedown",()=>{e.test||(document.body.requestPointerLock(),performance.now())}),document.body.addEventListener("mousemove",C=>{document.pointerLockElement===document.body&&(y.rotation.y-=C.movementX/500,y.rotation.x-=C.movementY/500)});const pt=new W;S(0,-4.25,0),new Tf().load("models/.obj",function(C){C.scale.set(.01,.01,.01),C.position.set(0,-4,0),C.rotation.x=-Math.PI/2,x.add(C);const Ie=document.createElement("div");Ie.innerHTML=`<h1></h1>
Equus ferus caballus`,Ie.className="box";const Oe=new bi(Ie);Oe.rotation.x=-Math.PI/2,Oe.position.set(0,0,0),C.add(Oe),s.push(Oe),Ie.style.opacity=0;const Ze=document.createElement("div");Ze.textContent="E",Ze.className="hint";const Ge=new bi(Ze);Ze.style.opacity=0,Ge.rotation.x=Math.PI/2,Ge.position.set(0,0,150);const as=new ki;as.add(Ge),C.add(as),n.push({Hint:Ge,Box:as}),Oe.lookAt(y.position),Ge.lookAt(y.position)},function(C){console.log(C.loaded/C.total*100+"% loaded")},function(C){console.log("An error happened")}),Po.fromGraphNode(x),t=new wf,t.setSize(window.innerWidth,window.innerHeight),t.domElement.style.position="absolute",t.domElement.style.top="0px",t.domElement.style.pointerEvents="none",document.body.appendChild(t.domElement),t.domElement.style.pointerEvents="none",t.render(x,y),e.addAction(()=>{s.forEach(C=>{C.position.distanceTo(y.position)>15&&(i=!1,C.element.style.opacity=0),C.lookAt(y.position)}),n.forEach(({Hint:C,Box:G})=>{if(i)C.element.style.opacity=0;else if(G.position.distanceTo(y.position)>14)C.element.style.opacity=0;else{const Oe=new W;y.getWorldPosition(Oe);const Ze=new W;C.getWorldPosition(Ze);const Ge=new W(Oe.x,Ze.y,Oe.z);C.lookAt(Ge),C.element.style.opacity=1}}),t.render(x,y)})}return()=>{e&&(e.renderer.dispose(),t.dispose(),e.clear())}},[]),vn.jsx(vn.Fragment,{children:vn.jsx("canvas",{style:{display:"block",width:"100vw",height:"100vh"},ref:o})})}export{Rf as default};
