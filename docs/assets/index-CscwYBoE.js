import{g as Jt,a as K,c as ut,b as Qi,r as me,j as Vt}from"./index-MVaPmjd1.js";import{A as Ki,M as Ji,B as Wi,z as ts}from"./OrbitControls-BG2Z3rzr.js";import{W as es}from"./three.utils-Ddr1HZwV.js";const is="Behaviour",oi="Alpha",ai="Attraction",ss="Collision",hi="Color",ui="CrossZone",ci="Force",li="Gravity",fi="RandomDrift",di="Repulsion",yi="Rotate",mi="Scale",pi="Spring",ns="Initializer",_i="Body",Wt="BodySprite",te="Texture",gi="Life",vi="Mass",xi="Position",Ei="Radius",zi="VectorVelocity",Ti="PolarVelocity",bi="RadialVelocity",rs="Rate",wi=[Wt,te],os="Zone",Mi="BoxZone",Ai="LineZone",Pi="MeshZone",Oi="PointZone",as="ScreenZone",Si="SphereZone",hs="BaseRenderer",us="CustomRenderer";var cs={};const O=3.142,ee=500,F=O/180,Ft=100,Ii="euler",ls=()=>(!process||!cs,!1),H={easeLinear:function(e){return e},easeInQuad:function(e){return Math.pow(e,2)},easeOutQuad:function(e){return-(Math.pow(e-1,2)-1)},easeInOutQuad:function(e){return(e/=.5)<1?.5*Math.pow(e,2):-.5*((e-=2)*e-2)},easeInCubic:function(e){return Math.pow(e,3)},easeOutCubic:function(e){return Math.pow(e-1,3)+1},easeInOutCubic:function(e){return(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2)},easeInQuart:function(e){return Math.pow(e,4)},easeOutQuart:function(e){return-(Math.pow(e-1,4)-1)},easeInOutQuart:function(e){return(e/=.5)<1?.5*Math.pow(e,4):-.5*((e-=2)*Math.pow(e,3)-2)},easeInSine:function(e){return-Math.cos(e*(O/2))+1},easeOutSine:function(e){return Math.sin(e*(O/2))},easeInOutSine:function(e){return-.5*(Math.cos(O*e)-1)},easeInExpo:function(e){return e===0?0:Math.pow(2,10*(e-1))},easeOutExpo:function(e){return e===1?1:-Math.pow(2,-10*e)+1},easeInOutExpo:function(e){return e===0?0:e===1?1:(e/=.5)<1?.5*Math.pow(2,10*(e-1)):.5*(-Math.pow(2,-10*--e)+2)},easeInCirc:function(e){return-(Math.sqrt(1-e*e)-1)},easeOutCirc:function(e){return Math.sqrt(1-Math.pow(e-1,2))},easeInOutCirc:function(e){return(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},easeInBack:function(e){var t=1.70158;return e*e*((t+1)*e-t)},easeOutBack:function(e){var t=1.70158;return(e=e-1)*e*((t+1)*e+t)+1},easeInOutBack:function(e){var t=1.70158;return(e/=.5)<1?.5*(e*e*(((t*=1.525)+1)*e-t)):.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)}},{easeLinear:Ri,easeInQuad:ra,easeOutQuad:oa,easeInOutQuad:aa,easeInCubic:ha,easeOutCubic:ua,easeInOutCubic:ca,easeInQuart:la,easeOutQuart:fa,easeInOutQuart:da,easeInSine:ya,easeOutSine:ma,easeInOutSine:pa,easeInExpo:_a,easeOutExpo:ga,easeInOutExpo:va,easeInCirc:xa,easeOutCirc:Ea,easeInOutCirc:za,easeInBack:Ta,easeOutBack:ba,easeInOutBack:wa}=H,I=e=>H[e]?H[e]:H.easeLinear,pe=1/0,_e=0,ge=1,ve=!1,xe=!1,Ee=null,ze=null,Te=1,be=10,we=1,Me=1,Ae=!1,Pe=!1,Oe=Ri,Yt=.0167,$t=[xi,gi,Ei,vi,_i,Wt,te,Ti,bi,zi],Ci=[oi,ai,hi,ui,ci,li,fi,di,yi,mi,pi],fs=[Mi,Ai,Pi,Oi,Si],Se={getRGB:function(e){var t={};if(typeof e=="number")s=Math.floor(e),t.r=(e>>16&255)/255,t.g=(e>>8&255)/255,t.b=(e&255)/255;else if(typeof e=="string"){var i;if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(e))t.r=Math.min(255,parseInt(i[1],10))/255,t.g=Math.min(255,parseInt(i[2],10))/255,t.b=Math.min(255,parseInt(i[3],10))/255;else if(i=/^\#([A-Fa-f0-9]+)$/.exec(e)){var s=i[1];t.r=parseInt(s.charAt(0)+s.charAt(1),16)/255,t.g=parseInt(s.charAt(2)+s.charAt(3),16)/255,t.b=parseInt(s.charAt(4)+s.charAt(5),16)/255}}else t.r=e.r,t.g=e.g,t.b=e.b;return t}},ds={_id:0,_uids:new Map,getNewId:function(){return`PUID_${++this._id}`},id:function(e){if(this._uids.has(e))return this._uids.get(e);const t=this.getNewId();return this._uids.set(e,t),t}};var G={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var s=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0,o=Math.random()*4294967295|0,a=e[s&255]+e[s>>8&255]+e[s>>16&255]+e[s>>24&255]+"-"+e[n&255]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[r&63|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[o&255]+e[o>>8&255]+e[o>>16&255]+e[o>>24&255];return a.toUpperCase()}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,s,n){return s+(e-t)*(n-s)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*G.DEG2RAD},radToDeg:function(e){return e*G.RAD2DEG},isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function $(e,t,i,s){this._x=e||0,this._y=t||0,this._z=i||0,this._w=s!==void 0?s:1}Object.assign($,{slerp:function(e,t,i,s){return i.copy(e).slerp(t,s)},slerpFlat:function(e,t,i,s,n,r,o){var a=i[s+0],h=i[s+1],u=i[s+2],c=i[s+3],f=n[r+0],l=n[r+1],d=n[r+2],p=n[r+3];if(c!==p||a!==f||h!==l||u!==d){var m=1-o,y=a*f+h*l+u*d+c*p,g=y>=0?1:-1,_=1-y*y;if(_>Number.EPSILON){var v=Math.sqrt(_),M=Math.atan2(v,y*g);m=Math.sin(m*M)/v,o=Math.sin(o*M)/v}var z=o*g;if(a=a*m+f*z,h=h*m+l*z,u=u*m+d*z,c=c*m+p*z,m===1-o){var T=1/Math.sqrt(a*a+h*h+u*u+c*c);a*=T,h*=T,u*=T,c*=T}}e[t]=a,e[t+1]=h,e[t+2]=u,e[t+3]=c}});Object.defineProperties($.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}});Object.assign($.prototype,{isQuaternion:!0,set:function(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._w=s,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,s=e._y,n=e._z,r=e.order,o=Math.cos,a=Math.sin,h=o(i/2),u=o(s/2),c=o(n/2),f=a(i/2),l=a(s/2),d=a(n/2);return r==="XYZ"?(this._x=f*u*c+h*l*d,this._y=h*l*c-f*u*d,this._z=h*u*d+f*l*c,this._w=h*u*c-f*l*d):r==="YXZ"?(this._x=f*u*c+h*l*d,this._y=h*l*c-f*u*d,this._z=h*u*d-f*l*c,this._w=h*u*c+f*l*d):r==="ZXY"?(this._x=f*u*c-h*l*d,this._y=h*l*c+f*u*d,this._z=h*u*d+f*l*c,this._w=h*u*c-f*l*d):r==="ZYX"?(this._x=f*u*c-h*l*d,this._y=h*l*c+f*u*d,this._z=h*u*d-f*l*c,this._w=h*u*c+f*l*d):r==="YZX"?(this._x=f*u*c+h*l*d,this._y=h*l*c+f*u*d,this._z=h*u*d-f*l*c,this._w=h*u*c-f*l*d):r==="XZY"&&(this._x=f*u*c-h*l*d,this._y=h*l*c-f*u*d,this._z=h*u*d+f*l*c,this._w=h*u*c+f*l*d),t!==!1&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var i=t/2,s=Math.sin(i);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(i),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t=e.elements,i=t[0],s=t[4],n=t[8],r=t[1],o=t[5],a=t[9],h=t[2],u=t[6],c=t[10],f=i+o+c,l;return f>0?(l=.5/Math.sqrt(f+1),this._w=.25/l,this._x=(u-a)*l,this._y=(n-h)*l,this._z=(r-s)*l):i>o&&i>c?(l=2*Math.sqrt(1+i-o-c),this._w=(u-a)/l,this._x=.25*l,this._y=(s+r)/l,this._z=(n+h)/l):o>c?(l=2*Math.sqrt(1+o-i-c),this._w=(n-h)/l,this._x=(s+r)/l,this._y=.25*l,this._z=(a+u)/l):(l=2*Math.sqrt(1+c-i-o),this._w=(r-s)/l,this._x=(n+h)/l,this._y=(a+u)/l,this._z=.25*l),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var i=1e-6,s=e.dot(t)+1;return s<i?(s=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=s):(this._x=0,this._y=-e.z,this._z=e.y,this._w=s)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=s),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(G.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var i=this.angleTo(e);if(i===0)return this;var s=Math.min(1,t/i);return this.slerp(e,s),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var i=e._x,s=e._y,n=e._z,r=e._w,o=t._x,a=t._y,h=t._z,u=t._w;return this._x=i*u+r*o+s*h-n*a,this._y=s*u+r*a+n*o-i*h,this._z=n*u+r*h+i*a-s*o,this._w=r*u-i*o-s*a-n*h,this._onChangeCallback(),this},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);var i=this._x,s=this._y,n=this._z,r=this._w,o=r*e._w+i*e._x+s*e._y+n*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=r,this._x=i,this._y=s,this._z=n,this;var a=1-o*o;if(a<=Number.EPSILON){var h=1-t;return this._w=h*r+t*this._w,this._x=h*i+t*this._x,this._y=h*s+t*this._y,this._z=h*n+t*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(a),c=Math.atan2(u,o),f=Math.sin((1-t)*c)/u,l=Math.sin(t*c)/u;return this._w=r*f+this._w*l,this._x=i*f+this._x*l,this._y=s*f+this._y*l,this._z=n*f+this._z*l,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return t===void 0&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});function A(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0}Object.assign(A.prototype,{isVector3:!0,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new $;return function(i){return i&&i.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(i))}}(),applyAxisAngle:function(){var e=new $;return function(i,s){return this.applyQuaternion(e.setFromAxisAngle(i,s))}}(),applyMatrix3:function(e){var t=this.x,i=this.y,s=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*s,this.y=n[1]*t+n[4]*i+n[7]*s,this.z=n[2]*t+n[5]*i+n[8]*s,this},applyMatrix4:function(e){var t=this.x,i=this.y,s=this.z,n=e.elements,r=1/(n[3]*t+n[7]*i+n[11]*s+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*s+n[12])*r,this.y=(n[1]*t+n[5]*i+n[9]*s+n[13])*r,this.z=(n[2]*t+n[6]*i+n[10]*s+n[14])*r,this},applyQuaternion:function(e){var t=this.x,i=this.y,s=this.z,n=e.x,r=e.y,o=e.z,a=e.w,h=a*t+r*s-o*i,u=a*i+o*t-n*s,c=a*s+n*i-r*t,f=-n*t-r*i-o*s;return this.x=h*a+f*-n+u*-o-c*-r,this.y=u*a+f*-r+c*-n-h*-o,this.z=c*a+f*-o+h*-r-u*-n,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,i=this.y,s=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*s,this.y=n[1]*t+n[5]*i+n[9]*s,this.z=n[2]*t+n[6]*i+n[10]*s,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},cross:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var i=e.x,s=e.y,n=e.z,r=t.x,o=t.y,a=t.z;return this.x=s*a-n*o,this.y=n*r-i*a,this.z=i*o-s*r,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new A;return function(i){return e.copy(this).projectOnVector(i),this.sub(e)}}(),reflect:function(){var e=new A;return function(i){return this.sub(e.copy(i).multiplyScalar(2*this.dot(i)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(G.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,i){var s=Math.sin(t)*e;return this.x=s*Math.sin(i),this.y=Math.cos(t)*e,this.z=s*Math.cos(i),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=s,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,t*4)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,i){return i!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});function dt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(dt.prototype,{isMatrix4:!0,set:function(e,t,i,s,n,r,o,a,h,u,c,f,l,d,p,m){var y=this.elements;return y[0]=e,y[4]=t,y[8]=i,y[12]=s,y[1]=n,y[5]=r,y[9]=o,y[13]=a,y[2]=h,y[6]=u,y[10]=c,y[14]=f,y[3]=l,y[7]=d,y[11]=p,y[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new dt().fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(){var e=new A;return function(i){var s=this.elements,n=i.elements,r=1/e.setFromMatrixColumn(i,0).length(),o=1/e.setFromMatrixColumn(i,1).length(),a=1/e.setFromMatrixColumn(i,2).length();return s[0]=n[0]*r,s[1]=n[1]*r,s[2]=n[2]*r,s[3]=0,s[4]=n[4]*o,s[5]=n[5]*o,s[6]=n[6]*o,s[7]=0,s[8]=n[8]*a,s[9]=n[9]*a,s[10]=n[10]*a,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,s=e.y,n=e.z,r=Math.cos(i),o=Math.sin(i),a=Math.cos(s),h=Math.sin(s),u=Math.cos(n),c=Math.sin(n);if(e.order==="XYZ"){var f=r*u,l=r*c,d=o*u,p=o*c;t[0]=a*u,t[4]=-a*c,t[8]=h,t[1]=l+d*h,t[5]=f-p*h,t[9]=-o*a,t[2]=p-f*h,t[6]=d+l*h,t[10]=r*a}else if(e.order==="YXZ"){var m=a*u,y=a*c,g=h*u,_=h*c;t[0]=m+_*o,t[4]=g*o-y,t[8]=r*h,t[1]=r*c,t[5]=r*u,t[9]=-o,t[2]=y*o-g,t[6]=_+m*o,t[10]=r*a}else if(e.order==="ZXY"){var m=a*u,y=a*c,g=h*u,_=h*c;t[0]=m-_*o,t[4]=-r*c,t[8]=g+y*o,t[1]=y+g*o,t[5]=r*u,t[9]=_-m*o,t[2]=-r*h,t[6]=o,t[10]=r*a}else if(e.order==="ZYX"){var f=r*u,l=r*c,d=o*u,p=o*c;t[0]=a*u,t[4]=d*h-l,t[8]=f*h+p,t[1]=a*c,t[5]=p*h+f,t[9]=l*h-d,t[2]=-h,t[6]=o*a,t[10]=r*a}else if(e.order==="YZX"){var v=r*a,M=r*h,z=o*a,T=o*h;t[0]=a*u,t[4]=T-v*c,t[8]=z*c+M,t[1]=c,t[5]=r*u,t[9]=-o*u,t[2]=-h*u,t[6]=M*c+z,t[10]=v-T*c}else if(e.order==="XZY"){var v=r*a,M=r*h,z=o*a,T=o*h;t[0]=a*u,t[4]=-c,t[8]=h*u,t[1]=v*c+T,t[5]=r*u,t[9]=M*c-z,t[2]=z*c-M,t[6]=o*u,t[10]=T*c+v}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(){var e=new A(0,0,0),t=new A(1,1,1);return function(s){return this.compose(e,s,t)}}(),lookAt:function(){var e=new A,t=new A,i=new A;return function(n,r,o){var a=this.elements;return i.subVectors(n,r),i.lengthSq()===0&&(i.z=1),i.normalize(),e.crossVectors(o,i),e.lengthSq()===0&&(Math.abs(o.z)===1?i.x+=1e-4:i.z+=1e-4,i.normalize(),e.crossVectors(o,i)),e.normalize(),t.crossVectors(i,e),a[0]=e.x,a[4]=t.x,a[8]=i.x,a[1]=e.y,a[5]=t.y,a[9]=i.y,a[2]=e.z,a[6]=t.z,a[10]=i.z,this}}(),multiply:function(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,s=t.elements,n=this.elements,r=i[0],o=i[4],a=i[8],h=i[12],u=i[1],c=i[5],f=i[9],l=i[13],d=i[2],p=i[6],m=i[10],y=i[14],g=i[3],_=i[7],v=i[11],M=i[15],z=s[0],T=s[4],L=s[8],V=s[12],N=s[1],b=s[5],W=s[9],tt=s[13],et=s[2],it=s[6],st=s[10],nt=s[14],rt=s[3],ot=s[7],at=s[11],ht=s[15];return n[0]=r*z+o*N+a*et+h*rt,n[4]=r*T+o*b+a*it+h*ot,n[8]=r*L+o*W+a*st+h*at,n[12]=r*V+o*tt+a*nt+h*ht,n[1]=u*z+c*N+f*et+l*rt,n[5]=u*T+c*b+f*it+l*ot,n[9]=u*L+c*W+f*st+l*at,n[13]=u*V+c*tt+f*nt+l*ht,n[2]=d*z+p*N+m*et+y*rt,n[6]=d*T+p*b+m*it+y*ot,n[10]=d*L+p*W+m*st+y*at,n[14]=d*V+p*tt+m*nt+y*ht,n[3]=g*z+_*N+v*et+M*rt,n[7]=g*T+_*b+v*it+M*ot,n[11]=g*L+_*W+v*st+M*at,n[15]=g*V+_*tt+v*nt+M*ht,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new A;return function(i){for(var s=0,n=i.count;s<n;s++)e.x=i.getX(s),e.y=i.getY(s),e.z=i.getZ(s),e.applyMatrix4(this),i.setXYZ(s,e.x,e.y,e.z);return i}}(),determinant:function(){var e=this.elements,t=e[0],i=e[4],s=e[8],n=e[12],r=e[1],o=e[5],a=e[9],h=e[13],u=e[2],c=e[6],f=e[10],l=e[14],d=e[3],p=e[7],m=e[11],y=e[15];return d*(+n*a*c-s*h*c-n*o*f+i*h*f+s*o*l-i*a*l)+p*(+t*a*l-t*h*f+n*r*f-s*r*l+s*h*u-n*a*u)+m*(+t*h*c-t*o*l-n*r*c+i*r*l+n*o*u-i*h*u)+y*(-s*o*u-t*a*c+t*o*f+s*r*c-i*r*f+i*a*u)},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(e,t,i){var s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=i),this},getInverse:function(e,t){var i=this.elements,s=e.elements,n=s[0],r=s[1],o=s[2],a=s[3],h=s[4],u=s[5],c=s[6],f=s[7],l=s[8],d=s[9],p=s[10],m=s[11],y=s[12],g=s[13],_=s[14],v=s[15],M=d*_*f-g*p*f+g*c*m-u*_*m-d*c*v+u*p*v,z=y*p*f-l*_*f-y*c*m+h*_*m+l*c*v-h*p*v,T=l*g*f-y*d*f+y*u*m-h*g*m-l*u*v+h*d*v,L=y*d*c-l*g*c-y*u*p+h*g*p+l*u*_-h*d*_,V=n*M+r*z+o*T+a*L;if(V===0){var N="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(t===!0)throw new Error(N);return console.warn(N),this.identity()}var b=1/V;return i[0]=M*b,i[1]=(g*p*a-d*_*a-g*o*m+r*_*m+d*o*v-r*p*v)*b,i[2]=(u*_*a-g*c*a+g*o*f-r*_*f-u*o*v+r*c*v)*b,i[3]=(d*c*a-u*p*a-d*o*f+r*p*f+u*o*m-r*c*m)*b,i[4]=z*b,i[5]=(l*_*a-y*p*a+y*o*m-n*_*m-l*o*v+n*p*v)*b,i[6]=(y*c*a-h*_*a-y*o*f+n*_*f+h*o*v-n*c*v)*b,i[7]=(h*p*a-l*c*a+l*o*f-n*p*f-h*o*m+n*c*m)*b,i[8]=T*b,i[9]=(y*d*a-l*g*a-y*r*m+n*g*m+l*r*v-n*d*v)*b,i[10]=(h*g*a-y*u*a+y*r*f-n*g*f-h*r*v+n*u*v)*b,i[11]=(l*u*a-h*d*a-l*r*f+n*d*f+h*r*m-n*u*m)*b,i[12]=L*b,i[13]=(l*g*o-y*d*o+y*r*p-n*g*p-l*r*_+n*d*_)*b,i[14]=(y*u*o-h*g*o-y*r*c+n*g*c+h*r*_-n*u*_)*b,i[15]=(h*d*o-l*u*o+l*r*c-n*d*c-h*r*p+n*u*p)*b,this},scale:function(e){var t=this.elements,i=e.x,s=e.y,n=e.z;return t[0]*=i,t[4]*=s,t[8]*=n,t[1]*=i,t[5]*=s,t[9]*=n,t[2]*=i,t[6]*=s,t[10]*=n,t[3]*=i,t[7]*=s,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,s))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),s=Math.sin(t),n=1-i,r=e.x,o=e.y,a=e.z,h=n*r,u=n*o;return this.set(h*r+i,h*o-s*a,h*a+s*o,0,h*o+s*a,u*o+i,u*a-s*r,0,h*a-s*o,u*a+s*r,n*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){var s=this.elements,n=t._x,r=t._y,o=t._z,a=t._w,h=n+n,u=r+r,c=o+o,f=n*h,l=n*u,d=n*c,p=r*u,m=r*c,y=o*c,g=a*h,_=a*u,v=a*c,M=i.x,z=i.y,T=i.z;return s[0]=(1-(p+y))*M,s[1]=(l+v)*M,s[2]=(d-_)*M,s[3]=0,s[4]=(l-v)*z,s[5]=(1-(f+y))*z,s[6]=(m+g)*z,s[7]=0,s[8]=(d+_)*T,s[9]=(m-g)*T,s[10]=(1-(f+p))*T,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this},decompose:function(){var e=new A,t=new dt;return function(s,n,r){var o=this.elements,a=e.set(o[0],o[1],o[2]).length(),h=e.set(o[4],o[5],o[6]).length(),u=e.set(o[8],o[9],o[10]).length(),c=this.determinant();c<0&&(a=-a),s.x=o[12],s.y=o[13],s.z=o[14],t.copy(this);var f=1/a,l=1/h,d=1/u;return t.elements[0]*=f,t.elements[1]*=f,t.elements[2]*=f,t.elements[4]*=l,t.elements[5]*=l,t.elements[6]*=l,t.elements[8]*=d,t.elements[9]*=d,t.elements[10]*=d,n.setFromRotationMatrix(t),r.x=a,r.y=h,r.z=u,this}}(),makePerspective:function(e,t,i,s,n,r){r===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,a=2*n/(t-e),h=2*n/(i-s),u=(t+e)/(t-e),c=(i+s)/(i-s),f=-(r+n)/(r-n),l=-2*r*n/(r-n);return o[0]=a,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=h,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=f,o[14]=l,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,i,s,n,r){var o=this.elements,a=1/(t-e),h=1/(i-s),u=1/(r-n),c=(t+e)*a,f=(i+s)*h,l=(r+n)*u;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-f,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-l,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,s=0;s<16;s++)if(t[s]!==i[s])return!1;return!0},fromArray:function(e,t){t===void 0&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}});function B(e,t,i,s){this._x=e||0,this._y=t||0,this._z=i||0,this._order=s||B.DefaultOrder}B.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];B.DefaultOrder="XYZ";Object.defineProperties(B.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}});Object.assign(B.prototype,{isEuler:!0,set:function(e,t,i,s){return this._x=e,this._y=t,this._z=i,this._order=s||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var s=G.clamp,n=e.elements,r=n[0],o=n[4],a=n[8],h=n[1],u=n[5],c=n[9],f=n[2],l=n[6],d=n[10];return t=t||this._order,t==="XYZ"?(this._y=Math.asin(s(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(l,u),this._z=0)):t==="YXZ"?(this._x=Math.asin(-s(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(a,d),this._z=Math.atan2(h,u)):(this._y=Math.atan2(-f,r),this._z=0)):t==="ZXY"?(this._x=Math.asin(s(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(-f,d),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(h,r))):t==="ZYX"?(this._y=Math.asin(-s(f,-1,1)),Math.abs(f)<.99999?(this._x=Math.atan2(l,d),this._z=Math.atan2(h,r)):(this._x=0,this._z=Math.atan2(-o,u))):t==="YZX"?(this._z=Math.asin(s(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-f,r)):(this._x=0,this._y=Math.atan2(a,d))):t==="XZY"?(this._z=Math.asin(-s(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(l,u),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,i!==!1&&this._onChangeCallback(),this},setFromQuaternion:function(){var e=new dt;return function(i,s,n){return e.makeRotationFromQuaternion(i),this.setFromRotationMatrix(e,s,n)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new $;return function(i){return e.setFromEuler(this),this.setFromQuaternion(e,i)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new A(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var ys=0,ms=1,Di=2,ps=3,_s=4,gs=5;const j={toScreenPos:function(){var e=new A;return function(t,i,s){return e.copy(t),e.project(i),e.x=Math.round((e.x+1)*s.width/2),e.y=Math.round((-e.y+1)*s.height/2),e.z=0,e}}(),toSpacePos:function(){var e=new A,t=new A,i;return function(s,n,r){return e.set(s.x/r.width*2-1,-(s.y/r.height)*2+1,.5),e.unproject(n),t.copy(e.sub(n.position).normalize()),i=-n.position.z/t.z,e.copy(n.position),e.add(t.multiplyScalar(i)),e}}()},S={initValue:function(e,t){var i=e!=null&&e!=null?e:t;return i},isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},destroyArray:function(e){e.length=0},destroyObject:function(e){for(var t in e)delete e[t]},isUndefined:function(){for(var e in arguments){var t=arguments[e];if(t!==void 0)return!1}return!0},setVectorByObj:function(e,t){t.x!==void 0&&(e.position.x=t.x),t.y!==void 0&&(e.position.y=t.y),t.z!==void 0&&(e.position.z=t.z),t.vx!==void 0&&(e.velocity.x=t.vx),t.vy!==void 0&&(e.velocity.y=t.vy),t.vz!==void 0&&(e.velocity.z=t.vz),t.ax!==void 0&&(e.acceleration.x=t.ax),t.ay!==void 0&&(e.acceleration.y=t.ay),t.az!==void 0&&(e.acceleration.z=t.az),t.p!==void 0&&e.position.copy(t.p),t.v!==void 0&&e.velocity.copy(t.v),t.a!==void 0&&e.acceleration.copy(t.a),t.position!==void 0&&e.position.copy(t.position),t.velocity!==void 0&&e.velocity.copy(t.velocity),t.accelerate!==void 0&&e.acceleration.copy(t.accelerate)},setPrototypeByObj:function(e,t,i){for(var s in t)e.hasOwnProperty(s)&&(i?i.indexOf(s)<0&&(e[s]=this._getValue(t[s])):e[s]=this._getValue(t[s]));return e},_getValue:function(e){return e.constructor.type==="Span"?e.getValue():e}};var Zt={exports:{}},Ie=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(Ie){var Re=new Uint8Array(16);Zt.exports=function(){return Ie(Re),Re}}else{var Ce=new Array(16);Zt.exports=function(){for(var t=0,i;t<16;t++)t&3||(i=Math.random()*4294967296),Ce[t]=i>>>((t&3)<<3)&255;return Ce}}var vs=Zt.exports,ji=[];for(var ct=0;ct<256;++ct)ji[ct]=(ct+256).toString(16).substr(1);function xs(e,t){var i=t||0,s=ji;return[s[e[i++]],s[e[i++]],s[e[i++]],s[e[i++]],"-",s[e[i++]],s[e[i++]],"-",s[e[i++]],s[e[i++]],"-",s[e[i++]],s[e[i++]],"-",s[e[i++]],s[e[i++]],s[e[i++]],s[e[i++]],s[e[i++]],s[e[i++]]].join("")}var Es=xs,zs=vs,Ts=Es,De,Nt,Bt=0,Ut=0;function bs(e,t,i){var s=t&&i||0,n=t||[];e=e||{};var r=e.node||De,o=e.clockseq!==void 0?e.clockseq:Nt;if(r==null||o==null){var a=zs();r==null&&(r=De=[a[0]|1,a[1],a[2],a[3],a[4],a[5]]),o==null&&(o=Nt=(a[6]<<8|a[7])&16383)}var h=e.msecs!==void 0?e.msecs:new Date().getTime(),u=e.nsecs!==void 0?e.nsecs:Ut+1,c=h-Bt+(u-Ut)/1e4;if(c<0&&e.clockseq===void 0&&(o=o+1&16383),(c<0||h>Bt)&&e.nsecs===void 0&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Bt=h,Ut=u,Nt=o,h+=122192928e5;var f=((h&268435455)*1e4+u)%4294967296;n[s++]=f>>>24&255,n[s++]=f>>>16&255,n[s++]=f>>>8&255,n[s++]=f&255;var l=h/4294967296*1e4&268435455;n[s++]=l>>>8&255,n[s++]=l&255,n[s++]=l>>>24&15|16,n[s++]=l>>>16&255,n[s++]=o>>>8|128,n[s++]=o&255;for(var d=0;d<6;++d)n[s+d]=r[d];return t||Ts(n)}var ws=bs;const ie=Jt(ws);function je(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,s)}return i}function Le(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?je(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):je(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}const mt=(e,t)=>Le(Le({},e),t),w={randomAToB:function(e,t,i){return i?(Math.random()*(t-e)>>0)+e:e+Math.random()*(t-e)},randomFloating:function(e,t,i){return this.randomAToB(e-t,e+t,i)},randomZone:function(e){},degreeTransform:function(e){return e*O/180},toColor16:function(t){return"#"+t.toString(16)},randomColor:function(){return"#"+("00000"+(Math.random()*16777216<<0).toString(16)).slice(-6)},lerp:function(e,t,i){return t+(e-t)*i},getNormal:function(e,t){return e.x==0&&e.y==0?e.z==0?t.set(1,0,1):t.set(1,1,-e.y/e.z):e.x==0?t.set(1,0,1):t.set(-e.y/e.x,1,1),t.normalize()},axisRotate:function(e,t,i,s){var n=Math.cos(s),r=Math.sin(s),o=i.dot(t)*(1-n);e.copy(i),e.cross(t).scalar(r),e.addValue(t.x*n,t.y*n,t.z*n),e.addValue(i.x*o,i.y*o,i.z*o)}},Ms="ArraySpan",As="ColorSpan",Ps="Polar3D",Os="Span";class C{constructor(t,i,s){this._isArray=!1,this.type=Os,S.isArray(t)?(this._isArray=!0,this.a=t):(this.a=S.initValue(t,1),this.b=S.initValue(i,this.a),this._center=S.initValue(s,!1))}getValue(t){return this._isArray?this.a[this.a.length*Math.random()>>0]:this._center?w.randomFloating(this.a,this.b,t):w.randomAToB(this.a,this.b,t)}}const P=(e,t,i)=>e instanceof C?e:t===void 0?new C(e):i===void 0?new C(e,t):new C(e,t,i);var Ss=Math.floor,Is=Math.random;function Rs(e,t){return e+Ss(Is()*(t-e+1))}var Cs=Rs,Ds=Cs;function js(e){var t=e.length;return t?e[Ds(0,t-1)]:void 0}var Li=js;function Ls(e,t){for(var i=-1,s=e==null?0:e.length,n=Array(s);++i<s;)n[i]=t(e[i],i,e);return n}var Vs=Ls,Ns=Vs;function Bs(e,t){return Ns(t,function(i){return e[i]})}var Us=Bs;function Fs(e,t){for(var i=-1,s=Array(e);++i<e;)s[i]=t(i);return s}var Ys=Fs,$s=typeof ut=="object"&&ut&&ut.Object===Object&&ut,Vi=$s,Zs=Vi,ks=typeof self=="object"&&self&&self.Object===Object&&self,qs=Zs||ks||Function("return this")(),Ni=qs,Hs=Ni,Gs=Hs.Symbol,Bi=Gs,Ve=Bi,Ui=Object.prototype,Xs=Ui.hasOwnProperty,Qs=Ui.toString,k=Ve?Ve.toStringTag:void 0;function Ks(e){var t=Xs.call(e,k),i=e[k];try{e[k]=void 0;var s=!0}catch{}var n=Qs.call(e);return s&&(t?e[k]=i:delete e[k]),n}var Js=Ks,Ws=Object.prototype,tn=Ws.toString;function en(e){return tn.call(e)}var sn=en,Ne=Bi,nn=Js,rn=sn,on="[object Null]",an="[object Undefined]",Be=Ne?Ne.toStringTag:void 0;function hn(e){return e==null?e===void 0?an:on:Be&&Be in Object(e)?nn(e):rn(e)}var zt=hn;function un(e){return e!=null&&typeof e=="object"}var Tt=un,cn=zt,ln=Tt,fn="[object Arguments]";function dn(e){return ln(e)&&cn(e)==fn}var yn=dn,Ue=yn,mn=Tt,Fi=Object.prototype,pn=Fi.hasOwnProperty,_n=Fi.propertyIsEnumerable,gn=Ue(function(){return arguments}())?Ue:function(e){return mn(e)&&pn.call(e,"callee")&&!_n.call(e,"callee")},vn=gn,xn=Array.isArray,Yi=xn,pt={exports:{}};function En(){return!1}var zn=En;pt.exports;(function(e,t){var i=Ni,s=zn,n=t&&!t.nodeType&&t,r=n&&!0&&e&&!e.nodeType&&e,o=r&&r.exports===n,a=o?i.Buffer:void 0,h=a?a.isBuffer:void 0,u=h||s;e.exports=u})(pt,pt.exports);var Tn=pt.exports,bn=9007199254740991,wn=/^(?:0|[1-9]\d*)$/;function Mn(e,t){var i=typeof e;return t=t??bn,!!t&&(i=="number"||i!="symbol"&&wn.test(e))&&e>-1&&e%1==0&&e<t}var An=Mn,Pn=9007199254740991;function On(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Pn}var $i=On,Sn=zt,In=$i,Rn=Tt,Cn="[object Arguments]",Dn="[object Array]",jn="[object Boolean]",Ln="[object Date]",Vn="[object Error]",Nn="[object Function]",Bn="[object Map]",Un="[object Number]",Fn="[object Object]",Yn="[object RegExp]",$n="[object Set]",Zn="[object String]",kn="[object WeakMap]",qn="[object ArrayBuffer]",Hn="[object DataView]",Gn="[object Float32Array]",Xn="[object Float64Array]",Qn="[object Int8Array]",Kn="[object Int16Array]",Jn="[object Int32Array]",Wn="[object Uint8Array]",tr="[object Uint8ClampedArray]",er="[object Uint16Array]",ir="[object Uint32Array]",E={};E[Gn]=E[Xn]=E[Qn]=E[Kn]=E[Jn]=E[Wn]=E[tr]=E[er]=E[ir]=!0;E[Cn]=E[Dn]=E[qn]=E[jn]=E[Hn]=E[Ln]=E[Vn]=E[Nn]=E[Bn]=E[Un]=E[Fn]=E[Yn]=E[$n]=E[Zn]=E[kn]=!1;function sr(e){return Rn(e)&&In(e.length)&&!!E[Sn(e)]}var nr=sr;function rr(e){return function(t){return e(t)}}var or=rr,_t={exports:{}};_t.exports;(function(e,t){var i=Vi,s=t&&!t.nodeType&&t,n=s&&!0&&e&&!e.nodeType&&e,r=n&&n.exports===s,o=r&&i.process,a=function(){try{var h=n&&n.require&&n.require("util").types;return h||o&&o.binding&&o.binding("util")}catch{}}();e.exports=a})(_t,_t.exports);var ar=_t.exports,hr=nr,ur=or,Fe=ar,Ye=Fe&&Fe.isTypedArray,cr=Ye?ur(Ye):hr,lr=cr,fr=Ys,dr=vn,yr=Yi,mr=Tn,pr=An,_r=lr,gr=Object.prototype,vr=gr.hasOwnProperty;function xr(e,t){var i=yr(e),s=!i&&dr(e),n=!i&&!s&&mr(e),r=!i&&!s&&!n&&_r(e),o=i||s||n||r,a=o?fr(e.length,String):[],h=a.length;for(var u in e)(t||vr.call(e,u))&&!(o&&(u=="length"||n&&(u=="offset"||u=="parent")||r&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||pr(u,h)))&&a.push(u);return a}var Er=xr,zr=Object.prototype;function Tr(e){var t=e&&e.constructor,i=typeof t=="function"&&t.prototype||zr;return e===i}var br=Tr;function wr(e,t){return function(i){return e(t(i))}}var Mr=wr,Ar=Mr,Pr=Ar(Object.keys,Object),Or=Pr,Sr=br,Ir=Or,Rr=Object.prototype,Cr=Rr.hasOwnProperty;function Dr(e){if(!Sr(e))return Ir(e);var t=[];for(var i in Object(e))Cr.call(e,i)&&i!="constructor"&&t.push(i);return t}var jr=Dr;function Lr(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Vr=Lr,Nr=zt,Br=Vr,Ur="[object AsyncFunction]",Fr="[object Function]",Yr="[object GeneratorFunction]",$r="[object Proxy]";function Zr(e){if(!Br(e))return!1;var t=Nr(e);return t==Fr||t==Yr||t==Ur||t==$r}var kr=Zr,qr=kr,Hr=$i;function Gr(e){return e!=null&&Hr(e.length)&&!qr(e)}var Xr=Gr,Qr=Er,Kr=jr,Jr=Xr;function Wr(e){return Jr(e)?Qr(e):Kr(e)}var to=Wr,eo=Us,io=to;function so(e){return e==null?[]:eo(e,io(e))}var no=so,ro=Li,oo=no;function ao(e){return ro(oo(e))}var ho=ao,uo=Li,co=ho,lo=Yi;function fo(e){var t=lo(e)?uo:co;return t(e)}var yo=fo;const Zi=Jt(yo);class $e extends C{constructor(t){super(),this.type=Ms,this.items=Array.isArray(t)?t:[t]}getValue(){return Zi(this.items)}}const mo=e=>e?e instanceof $e?e:new $e(e):null;class Ze extends C{constructor(t){super(),this.type=As,this.shouldRandomize=t==="random",this.colors=Array.isArray(t)?t:[t]}getValue(){return this.shouldRandomize?w.randomColor():Zi(this.colors)}}const ke=e=>(e||(console.warn(`Invalid colors argument ${e} passed to createColorSpan. Defaulting to 'random'.`),e="random"),e instanceof Ze?e:new Ze(e)),gt="EULER",qe=(e,t,i)=>{e.sleep||(e.old.position.copy(e.position),e.old.velocity.copy(e.velocity),e.acceleration.scalar(1/e.mass),e.velocity.add(e.acceleration.scalar(t)),e.position.add(e.old.velocity.scalar(t)),i&&e.velocity.scalar(Math.pow(i,t/Yt)),e.acceleration.clear())},He=(e,t,i,s=gt)=>{switch(s){case gt:qe(e,t,i);break;default:qe(e,t,i)}};class x extends A{clear(){return this.x=0,this.y=0,this.z=0,this}scalar(t){return this.x*=t,this.y*=t,this.z*=t,this}addValue(t,i,s){return this.x+=t,this.y+=i,this.z+=s,this}toString(){return"x:"+this.x+"y:"+this.y+"z:"+this.z}eulerFromDir(t){return new B().setFromVector3(t)}}class se{constructor(t,i,s){this.type=Ps,this.radius=t||1,this.phi=s||0,this.theta=i||0}set(t,i,s){return this.radius=t||1,this.phi=s||0,this.theta=i||0,this}setRadius(t){return this.radius=t,this}setPhi(t){return this.phi=t,this}setTheta(t){return this.theta=t,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}toVector3D(){return new x(this.getX(),this.getY(),this.getZ())}getX(){return this.radius*Math.sin(this.theta)*Math.cos(this.phi)}getY(){return-this.radius*Math.sin(this.theta)*Math.sin(this.phi)}getZ(){return this.radius*Math.cos(this.theta)}normalize(){return this.radius=1,this}equals(t){return t.radius===this.radius&&t.phi===this.phi&&t.theta===this.theta}clear(){return this.radius=0,this.phi=0,this.theta=0,this}clone(){return new se(this.radius,this.phi,this.theta)}}const po="Particle",_o="Pool",go="System";class Ge{constructor(t){this.id=`particle-${ie()}`,this.type=po,this.life=pe,this.age=_e,this.energy=ge,this.dead=ve,this.sleep=xe,this.body=Ee,this.parent=ze,this.mass=Te,this.radius=be,this.alpha=we,this.scale=Me,this.useColor=Ae,this.useAlpha=Pe,this.easing=Oe,this.position=new x,this.velocity=new x,this.acceleration=new x,this.old={},this.old.position=this.position.clone(),this.old.velocity=this.velocity.clone(),this.old.acceleration=this.acceleration.clone(),this.behaviours=[],this.transform={},this.color={r:0,g:0,b:0},this.rotation=new x,this.distanceToCamera=0,S.setPrototypeByObj(this,t)}getDirection(){return Math.atan2(this.velocity.x,-this.velocity.y)*(180/O)}reset(){return this.life=pe,this.age=_e,this.energy=ge,this.dead=ve,this.sleep=xe,this.body=Ee,this.parent=ze,this.mass=Te,this.radius=be,this.alpha=we,this.scale=Me,this.useColor=Ae,this.useAlpha=Pe,this.easing=Oe,this.position.set(0,0,0),this.velocity.set(0,0,0),this.acceleration.set(0,0,0),this.old.position.set(0,0,0),this.old.velocity.set(0,0,0),this.old.acceleration.set(0,0,0),this.color.r=0,this.color.g=0,this.color.b=0,this.rotation.clear(),S.destroyObject(this.transform),this.removeAllBehaviours(),this}update(t,i){if(!this.sleep){this.age+=t;let s=this.behaviours.length;for(;s--;)this.behaviours[s].applyBehaviour(this,t,i)}if(this.age>=this.life)this.destroy();else{const s=this.easing(this.age/this.life);this.energy=Math.max(1-s,0)}}addBehaviour(t){this.behaviours.push(t),t.initialize(this)}addBehaviours(t){let i=t.length;for(;i--;)this.addBehaviour(t[i])}removeBehaviour(t){const i=this.behaviours.indexOf(t);i>-1&&this.behaviours.splice(i,1)}removeAllBehaviours(){S.destroyArray(this.behaviours)}destroy(){this.removeAllBehaviours(),this.energy=0,this.dead=!0,this.parent=null}}class kt{constructor(){this.type=_o,this.cID=0,this.list={}}create(t,...i){if(!this.canCreateNewObject(t))throw new Error("The pool is unable to create or clone the object supplied");if(this.cID++,this.canInstantiateObject(t))return new t(...i);if(this.canCloneObject(t))return t.clone()}canInstantiateObject(t){return typeof t=="function"}canCloneObject(t){return t.clone&&typeof t.clone=="function"}canCreateNewObject(t){return!!(this.canInstantiateObject(t)||this.canCloneObject(t))}getCount(){var t=0;for(var i in this.list)t+=this.list[i].length;return t++}get(t,...i){var s,n=t.__puid||ds.id(t);return this.list[n]&&this.list[n].length>0?s=this.list[n].pop():s=this.create(t,...i),s.__puid=t.__puid||n,s}expire(t){return this._getList(t.__puid).push(t)}destroy(){for(var t in this.list)this.list[t].length=0,delete this.list[t]}_getList(t){return t=t||"default",this.list[t]||(this.list[t]=[]),this.list[t]}}class ki{constructor(){this.listeners=null}set listeners(t){this._listeners=t}get listeners(){return this._listeners}addEventListener(t,i){return this.listeners?this.removeEventListener(t,i):this.listeners={},this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(i),i}removeEventListener(t,i){if(this.listeners&&this.listeners[t]){for(var s=this.listeners[t],n=0,r=s.length;n<r;n++)if(s[n]==i){r==1?delete this.listeners[t]:s.splice(n,1);break}}}removeAllEventListeners(t){t?this.listeners&&delete this.listeners[t]:this.listeners=null}dispatchEvent(t,i){var s=!1,n=this.listeners;if(t&&n){var r=n[t];if(!r)return s;r=r.slice();for(var o,a=r.length;a--;)o=r[a],s=s||o(i)}return!!s}hasEventListener(t){var i=this.listeners;return!!(i&&i[t])}}const qt="SYSTEM_UPDATE",Ht="PARTICLE_CREATED",Gt="PARTICLE_UPDATE",Xt="PARTICLE_DEAD",vo="EMITTER_ADDED",xo="EMITTER_REMOVED",Xe="EMITTER_DEAD",Eo="SYSTEM_UPDATE_AFTER";let D=class{constructor(t=ns,i=!0){this.type=t,this.isEnabled=i}init(t,i){this.isEnabled&&(i?(this.initialize(i),i.hasBeenInitialized=!0):(this.initialize(t),t.hasBeenInitialized=!0))}reset(){}initialize(t){}static requiresWebGlApi(){return!1}static fromJSON(t){}};class ne extends D{constructor(t,i,s,n=!0){super(_i,n),this.body=mo(t),this.w=i,this.h=s||i}initialize(t){var i=this.body.getValue();this.w?t.body={width:this.w,height:this.h,body:i}:t.body=i}static fromJSON(t){const{body:i,width:s,height:n,isEnabled:r=!0}=t;return new ne(i,s,n,r)}}function Qe(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,s)}return i}function Ke(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Qe(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Qe(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}const vt={AdditiveBlending:Di,CustomBlending:gs,MultiplyBlending:_s,NoBlending:ys,NormalBlending:ms,SubtractiveBlending:ps},X={color:16711680,blending:Di,fog:!0},Y=Ke(Ke({},X),{},{blending:"AdditiveBlending"}),zo=1,To=1;function Je(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,s)}return i}function lt(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?Je(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Je(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}class re extends D{constructor(t,i,s=X,n=!0){super(Wt,n);const{Sprite:r,SpriteMaterial:o,TextureLoader:a}=t;this.materialProperties=mt(X,s),new a().load(i,h=>{this.texture=h,this.material=new o(lt(lt({},{map:h}),this.materialProperties)),this.sprite=new r(this.material)},void 0,h=>{throw new Error(h)})}initialize(t){t.body=this.sprite}static fromJSON(t,i){const{texture:s,materialProperties:n=Y,isEnabled:r=!0}=t,o=a=>{const{blending:h}=a;return lt(lt({},a),{},{blending:h?vt[h]:vt[Y.blending]})};return new re(i,s,mt(Y,o(n)),r)}}const bo=new B,qi={particleEuler:null,initialize:function(e,t,i){let s=i.length;for(;s--;)i[s].init(e,t);e.bindEmitter&&this.bindEmitter(e,t)},bindEmitter:function(e,t){const{rotation:{x:i,y:s,z:n}}=e;t.position.add(e.position),t.velocity.add(e.velocity),t.acceleration.add(e.acceleration),t.velocity.applyEuler(bo.set(i,s,n))}};class bt extends D{constructor(t,i,s,n=!0){super(gi,n),this.lifePan=P(t,i,s)}initialize(t){this.lifePan.a==1/0||this.lifePan.a=="infi"?t.life=1/0:t.life=this.lifePan.getValue()}static fromJSON(t){const{min:i,max:s,center:n=!1,isEnabled:r=!0}=t;return new bt(i,s,n,r)}}class wt extends D{constructor(t,i,s=!1,n=!0){super(vi,n),this.massPan=P(t,i,s)}initialize(t){t.mass=this.massPan.getValue()}static fromJSON(t){const{min:i,max:s,center:n=!1,isEnabled:r=!0}=t;return new wt(i,s,n,r)}}let Z=class{constructor(t=os){this.type=t,this.vector=new x(0,0,0),this.random=0,this.crossType="dead",this.log=!0,this.supportsCrossing=!0}getPosition(){return null}crossing(t){if(!this.supportsCrossing)return console.warn(`${this.constructor.name} does not support the crossing method`);switch(this.crossType){case"bound":this._bound(t);break;case"cross":this._cross(t);break;case"dead":this._dead(t);break}}isBoxZone(){return!1}isLineZone(){return!1}isMeshZone(){return!1}isPointZone(){return!1}isScreenZone(){return!1}isSphereZone(){return!1}_dead(t){}_bound(t){}_cross(t){}};class oe extends Z{constructor(t,i,s,l,r,o){super(Mi);var a,h,u,c,f,l;S.isUndefined(i,s,l,r,o)?(a=h=u=0,c=f=l=t||100):S.isUndefined(l,r,o)?(a=h=u=0,c=t,f=i,l=s):(a=t,h=i,u=s,c=l,f=r,l=o),this.x=a,this.y=h,this.z=u,this.width=c,this.height=f,this.depth=l,this.friction=.85,this.max=6}isBoxZone(){return!0}getPosition(){return this.vector.x=this.x+w.randomAToB(-.5,.5)*this.width,this.vector.y=this.y+w.randomAToB(-.5,.5)*this.height,this.vector.z=this.z+w.randomAToB(-.5,.5)*this.depth,this.vector}_dead(t){(t.position.x+t.radius<this.x-this.width/2||t.position.x-t.radius>this.x+this.width/2)&&(t.dead=!0),(t.position.y+t.radius<this.y-this.height/2||t.position.y-t.radius>this.y+this.height/2)&&(t.dead=!0),(t.position.z+t.radius<this.z-this.depth/2||t.position.z-t.radius>this.z+this.depth/2)&&(t.dead=!0)}_bound(t){t.position.x-t.radius<this.x-this.width/2?(t.position.x=this.x-this.width/2+t.radius,t.velocity.x*=-this.friction,this._static(t,"x")):t.position.x+t.radius>this.x+this.width/2&&(t.position.x=this.x+this.width/2-t.radius,t.velocity.x*=-this.friction,this._static(t,"x")),t.position.y-t.radius<this.y-this.height/2?(t.position.y=this.y-this.height/2+t.radius,t.velocity.y*=-this.friction,this._static(t,"y")):t.position.y+t.radius>this.y+this.height/2&&(t.position.y=this.y+this.height/2-t.radius,t.velocity.y*=-this.friction,this._static(t,"y")),t.position.z-t.radius<this.z-this.depth/2?(t.position.z=this.z-this.depth/2+t.radius,t.velocity.z*=-this.friction,this._static(t,"z")):t.position.z+t.radius>this.z+this.depth/2&&(t.position.z=this.z+this.depth/2-t.radius,t.velocity.z*=-this.friction,this._static(t,"z"))}_static(t,i){t.velocity[i]*t.acceleration[i]>0||Math.abs(t.velocity[i])<Math.abs(t.acceleration[i])*.0167*this.max&&(t.velocity[i]=0,t.acceleration[i]=0)}_cross(t){t.position.x+t.radius<this.x-this.width/2&&t.velocity.x<=0?t.position.x=this.x+this.width/2+t.radius:t.position.x-t.radius>this.x+this.width/2&&t.velocity.x>=0&&(t.position.x=this.x-this.width/2-t.radius),t.position.y+t.radius<this.y-this.height/2&&t.velocity.y<=0?t.position.y=this.y+this.height/2+t.radius:t.position.y-t.radius>this.y+this.height/2&&t.velocity.y>=0&&(t.position.y=this.y-this.height/2-t.radius),t.position.z+t.radius<this.z-this.depth/2&&t.velocity.z<=0?t.position.z=this.z+this.depth/2+t.radius:t.position.z-t.radius>this.z+this.depth/2&&t.velocity.z>=0&&(t.position.z=this.z-this.depth/2-t.radius)}}class wo extends Z{constructor(t,i,s,n,r,o){super(Ai),t instanceof x?(this.x1=t.x,this.y1=t.y,this.z1=t.z,this.x2=n.x,this.y2=n.y,this.z2=n.z):(this.x1=t,this.y1=i,this.z1=s,this.x2=n,this.y2=r,this.z2=o),this.supportsCrossing=!1}isLineZone(){return!0}getPosition(){return this.random=Math.random(),this.vector.x=this.x1+this.random*(this.x2-this.x1),this.vector.y=this.y1+this.random*(this.y2-this.y1),this.vector.z=this.z1+this.random*(this.z2-this.z1),this.vector}}class Mo extends Z{constructor(t,i=1,s){if(super(Pi),this.geometry=null,this.scale=i,this.supportsCrossing=!1,t.type&&t.type==="Geometry"&&(this.geometry=t),t.geometry&&(this.geometry=t.geometry),!this.geometry)throw new Error("MeshZone unable to set geometry from the supplied bounds");this.geometry.isBufferGeometry&&(this.geometry=new s().fromBufferGeometry(this.geometry))}isMeshZone(){return!0}getPosition(){const t=this.geometry.vertices,i=t[t.length*Math.random()>>0];return this.vector.x=i.x*this.scale,this.vector.y=i.y*this.scale,this.vector.z=i.z*this.scale,this.vector}}class Ao extends Z{constructor(t,i,s){super(Oi);var n;S.isUndefined(t,i,s)?n=0:n=t,this.x=n,this.y=n,this.z=n,this.supportsCrossing=!1}isPointZone(){return!0}getPosition(){return this.vector.x=this.x,this.vector.y=this.y,this.vector.z=this.z,this.vector}}class ae extends Z{constructor(t,i,s,n){super(as),this.camera=t,this.renderer=i,this.dis=s||20,n=n||"1234";for(var r=1;r<5;r++)this["d"+r]=n.indexOf(r+"")>=0}isScreenZone(){return!0}_dead(t){var i=j.toScreenPos(t.position,this.camera,this.renderer.domElement),s=this.renderer.domElement;(i.y+t.radius<-this.dis&&this.d1||i.y-t.radius>s.height+this.dis&&this.d3)&&(t.dead=!0),(i.x+t.radius<-this.dis&&this.d4||i.x-t.radius>s.width+this.dis&&this.d2)&&(t.dead=!0)}_bound(t){var i=j.toScreenPos(t.position,this.camera,this.renderer.domElement),s=this.renderer.domElement;(i.y+t.radius<-this.dis||i.y-t.radius>s.height+this.dis)&&(t.velocity.y*=-1),(i.x+t.radius<-this.dis||i.x-t.radius>s.width+this.dis)&&(t.velocity.y*=-1)}}ae.prototype.getPosition=function(){var e=new x,t;return function(){return t=this.renderer.domElement,e.x=Math.random()*t.width,e.y=Math.random()*t.height,this.vector.copy(j.toSpacePos(e,this.camera,t)),this.vector}}();ae.prototype._cross=function(){var e=new x;return function(t){var i=j.toScreenPos(t.position,this.camera,this.renderer.domElement),s=this.renderer.domElement;i.y+t.radius<-this.dis?(e.x=i.x,e.y=s.height+this.dis+t.radius,t.position.y=j.toSpacePos(e,this.camera,s).y):i.y-t.radius>s.height+this.dis&&(e.x=i.x,e.y=-this.dis-t.radius,t.position.y=j.toSpacePos(e,this.camera,s).y),i.x+t.radius<-this.dis?(e.y=i.y,e.x=s.width+this.dis+t.radius,t.position.x=j.toSpacePos(e,this.camera,s).x):i.x-t.radius>s.width+this.dis&&(e.y=i.y,e.x=-this.dis-t.radius,t.position.x=j.toSpacePos(e,this.camera,s).x)}}();class he extends Z{constructor(t,i,s,n){super(Si);let r,o;S.isUndefined(i,s,n)?(r=0,o=t||100):(r=t,o=n),this.x=r,this.y=r,this.z=r,this.radius=o,this.the=this.phi=0}isSphereZone(){return!0}_dead(t){var i=t.position.distanceTo(this);i-t.radius>this.radius&&(t.dead=!0)}_cross(){console.warn(`${this.constructor.name} does not support the _cross method`)}}he.prototype.getPosition=function(){var e,t,i;return function(){return this.random=Math.random(),i=this.random*this.radius,e=O*Math.random(),t=O*2*Math.random(),this.vector.x=this.x+i*Math.sin(e)*Math.cos(t),this.vector.y=this.y+i*Math.sin(t)*Math.sin(e),this.vector.z=this.z+i*Math.cos(e),this.vector}}();he.prototype._bound=function(){var e=new x,t=new x,i;return function(s){var n=s.position.distanceTo(this);n+s.radius>=this.radius&&(e.copy(s.position).sub(this).normalize(),t.copy(s.velocity),i=2*t.dot(e),s.velocity.sub(e.scalar(i)))}}();const Hi=Object.freeze(Object.defineProperty({__proto__:null,BoxZone:oe,LineZone:wo,MeshZone:Mo,PointZone:Ao,ScreenZone:ae,SphereZone:he},Symbol.toStringTag,{value:"Module"})),Po=["zoneType"];class J extends D{constructor(){super(xi),this.reset.apply(this,arguments)}reset(){this.zones?this.zones.length=0:this.zones=[],this.zones=this.zones.concat(Array.prototype.slice.call(arguments))}addZone(){this.zones=this.zones.concat(Array.prototype.slice.call(arguments))}static fromJSON(t){const{zoneType:i}=t,s=Qi(t,Po);if(!fs.includes(i))throw new Error(`The zone type ${i} is invalid or not yet supported`);return new J(new Hi[i](...Object.values(s)))}}J.prototype.initialize=function(){let e;return function(t){e=this.zones[Math.random()*this.zones.length>>0],e.getPosition(),t.position.x=e.vector.x,t.position.y=e.vector.y,t.position.z=e.vector.z}}();class Mt extends D{constructor(t,i,s=!1,n=!0){super(Ei,n),this.radius=P(t,i,s)}reset(t,i,s=!1){this.radius=P(t,i,s)}initialize(t){t.radius=this.radius.getValue(),t.transform.oldRadius=t.radius}static fromJSON(t){const{width:i,height:s,center:n=!1,isEnabled:r=!0}=t;return new Mt(i,s,n,r)}}class U extends D{constructor(t=zo,i=To){super(rs),this.numPan=P(t),this.timePan=P(i),this.startTime=0,this.nextTime=0,this.init()}init(){this.startTime=0,this.nextTime=this.timePan.getValue()}getValue(t){return this.startTime+=t,this.startTime>=this.nextTime?(this.init(),this.numPan.b==1?this.numPan.getValue("Float")>.5?1:0:this.numPan.getValue("Int")):0}static fromJSON(t){const{particlesMin:i,particlesMax:s,perSecondMin:n,perSecondMax:r}=t;return new U(new C(i,s),new C(n,r))}}function We(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,s)}return i}function ft(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?We(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):We(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}class At extends D{constructor(t,i,s=X,n=!0){super(te,n);const{Sprite:r,SpriteMaterial:o}=t;this.materialProperties=mt(X,s),this.texture=i,this.material=new o(ft(ft({},{map:i}),this.materialProperties)),this.sprite=new r(this.material)}initialize(t){t.body=this.sprite}static fromJSON(t,i){const{loadedTexture:s,materialProperties:n=Y,isEnabled:r=!0}=t,o=a=>{const{blending:h}=a;return ft(ft({},a),{},{blending:h?vt[h]:vt[Y.blending]})};return new At(i,s,mt(Y,o(n)),r)}}class Pt extends D{constructor(t,i=!0){super(t,i),this.dirVec=new x(0,0,0)}normalize(t){return t*Ft}}Pt.prototype.initialize=function(){var e,t=new x(0,0,1),i=new x(0,0,0);return function(n){return e=this.tha*Math.random(),this._useV&&this.dirVec.copy(this.dir).scalar(this.radiusPan.getValue()),w.getNormal(this.dirVec,t),i.copy(this.dirVec).applyAxisAngle(t,e),i.applyAxisAngle(this.dirVec.normalize(),Math.random()*O*2),n.velocity.copy(i),this}}();class ue extends Pt{constructor(t,i,s=!0){super(Ti,s),this.tha=i*F,this.dirVec=t.toVector3D(),this._useV=!1}static fromJSON(t){const{polarRadius:i,polarTheta:s,polarPhi:n,velocityTheta:r,isEnabled:o=!0}=t;return new ue(new se(i,s,n),r,o)}}class Ot extends Pt{constructor(t,i,s,n=!0){super(bi,n),this.radiusPan=P(t),this.dir=i.clone().normalize(),this.tha=s*F,this._useV=!0}static fromJSON(t){const{radius:i,x:s,y:n,z:r,theta:o,isEnabled:a=!0}=t;return new Ot(i,new x(s,n,r),o,a)}}class ce extends Pt{constructor(t,i,s=!0){super(zi,s),this.radiusPan=P(1),this.dir=t.clone(),this.tha=i*F,this._useV=!0}static fromJSON(t){const{x:i,y:s,z:n,theta:r,isEnabled:o=!0}=t;return new ce(new x(i,s,n),r,o)}}const xt=Object.freeze(Object.defineProperty({__proto__:null,Body:ne,BodySprite:re,InitializerUtil:qi,Life:bt,Mass:wt,PolarVelocity:ue,Position:J,RadialVelocity:Ot,Radius:Mt,Rate:U,Texture:At,VectorVelocity:ce},Symbol.toStringTag,{value:"Module"})),Oo=.006,So=!0,Io=new U(1,.1),Ro=!1,Co=void 0;var Do=zt,jo=Tt,Lo="[object Number]";function Vo(e){return typeof e=="number"||jo(e)&&Do(e)==Lo}var No=Vo;const q=Jt(No),Bo="Emitter";class Qt extends Ge{constructor(t){super(t),this.type=Bo,this.particles=[],this.initializers=[],this.behaviours=[],this.emitterBehaviours=[],this.currentEmitTime=0,this.totalEmitTimes=-1,this.damping=Oo,this.bindEmitter=So,this.bindEmitterEvent=Ro,this.rate=Io,this.isEmitting=!1,this.id=`emitter-${ie()}`,this.cID=0,this.name="Emitter",this.index=Co,this.eventDispatcher=new ki}dispatch(t,i=this){this.eventDispatcher.dispatchEvent(t,i)}setRate(t){return this.rate=t,this}setPosition(t={}){const{position:i}=this,{x:s=i.x,y:n=i.y,z:r=i.z}=t;return this.position.set(s,n,r),this}setRotation(t={}){const{rotation:i}=this,{x:s=i.x,y:n=i.y,z:r=i.z}=t;return this.rotation.set(s,n,r),this}emit(t=1/0,i=1/0){return this.currentEmitTime=0,this.totalEmitTimes=q(t)?t:1/0,t===1?this.life=t:this.life=q(i)?i:1/0,this.rate.init(),this.isEmitting=!0,this}experimental_emit(){const{isEmitting:t,totalEmitTimes:i,life:s}=this;return t||(this.currentEmitTime=0,i||this.setTotalEmitTimes(1/0),s||this.setLife(1/0),this.rate.init(),this.isEmitting=!0),this}setTotalEmitTimes(t=1/0){return this.totalEmitTimes=q(t)?t:1/0,this}setLife(t=1/0){return this.totalEmitTimes===1?this.life=this.totalEmitTimes:this.life=q(t)?t:1/0,this}stopEmit(){this.totalEmitTimes=-1,this.currentEmitTime=0,this.isEmitting=!1}removeAllParticles(){let t=this.particles.length;for(;t--;)this.particles[t].dead=!0}addInitializer(t){return this.initializers.push(t),this}addInitializers(t){let i=t.length;for(;i--;)this.addInitializer(t[i]);return this}setInitializers(t){return this.initializers=t,this}removeInitializer(t){const i=this.initializers.indexOf(t);return i>-1&&this.initializers.splice(i,1),this}removeAllInitializers(){return S.destroyArray(this.initializers),this}addBehaviour(t){return this.behaviours.push(t),this}addBehaviours(t){let i=t.length;for(;i--;)this.addBehaviour(t[i]);return this}setBehaviours(t){return this.behaviours=t,this}removeBehaviour(t){const i=this.behaviours.indexOf(t);return i>-1&&this.behaviours.splice(i,1),this}removeAllBehaviours(){return S.destroyArray(this.behaviours),this}addEmitterBehaviour(t){return this.emitterBehaviours.push(t),t.initialize(this),this}addEmitterBehaviours(t){let i=t.length;for(;i--;)this.addEmitterBehaviour(t[i]);return this}setEmitterBehaviours(t){const i=t.length;this.emitterBehaviours=t;for(let s=0;s<i;s++)this.emitterBehaviours[s].initialize(this);return this}removeEmitterBehaviour(t){const i=this.emitterBehaviours.indexOf(t);return i>-1&&this.emitterBehaviours.splice(i,1),this}removeAllEmitterBehaviours(){return S.destroyArray(this.emitterBehaviours),this}addOnEmitterDeadEventListener(t){return this.eventDispatcher.addEventListener(`${this.id}_${Xe}`,()=>t()),this}createParticle(){const t=this.parent.pool.get(Ge),i=this.particles.length;return this.setupParticle(t,i),this.parent&&this.parent.dispatch(Ht,t),this.bindEmitterEvent&&this.dispatch(Ht,t),t}setupParticle(t,i){const{initializers:s,behaviours:n}=this;qi.initialize(this,t,s),t.addBehaviours(n),t.parent=this,t.index=i,this.particles.push(t)}update(t){if(!this.isEmitting)return;this.age+=t,(this.dead||this.age>=this.life)&&this.destroy(),this.generate(t),this.integrate(t);let i=this.particles.length;for(;i--;){const s=this.particles[i];s.dead&&(this.parent&&this.parent.dispatch(Xt,s),this.bindEmitterEvent&&this.dispatch(Xt,s),this.parent.pool.expire(s.reset()),this.particles.splice(i,1))}this.updateEmitterBehaviours(t)}updateEmitterBehaviours(t){if(this.sleep)return;const i=this.emitterBehaviours.length;for(let s=0;s<i;s++)this.emitterBehaviours[s].applyBehaviour(this,t,s)}integrate(t){const i=this.parent?this.parent.integrationType:gt,s=1-this.damping;He(this,t,s,i);let n=this.particles.length;for(;n--;){const r=this.particles[n];r.update(t,n),He(r,t,s,i),this.parent&&this.parent.dispatch(Gt,r),this.bindEmitterEvent&&this.dispatch(Gt,r)}}generate(t){if(this.totalEmitTimes===1){let i=this.rate.getValue(99999);for(i>0&&(this.cID=i);i--;)this.createParticle();this.totalEmitTimes=0;return}if(this.currentEmitTime+=t,this.currentEmitTime<this.totalEmitTimes){let i=this.rate.getValue(t);for(i>0&&(this.cID=i);i--;)this.createParticle()}}destroy(){this.dead=!0,this.energy=0,this.totalEmitTimes=-1,this.particles.length==0&&(this.isEmitting=!1,this.removeAllInitializers(),this.removeAllBehaviours(),this.dispatch(`${this.id}_${Xe}`),this.parent&&this.parent.removeEmitter(this))}}const Kt=1/0,ti=1e3,ei=100,yt=Ri,ii=.03,Uo=.002,Fo=4e-6,Yo="dead";let R=class{constructor(t=1/0,i=yt,s=is,n=!0){this.type=s,this.isEnabled=n,this.id=`behaviour-${ie()}`,this.life=t,this.easing=i,this.age=0,this.energy=1,this.dead=!1}reset(t=Kt,i=yt){this.life=t,this.easing=i||yt}set life(t){this._life=q(t)?t:Kt}get life(){return this._life}normalizeForce(t){return t.scalar(Ft)}normalizeValue(t){return t*Ft}initialize(t){}applyBehaviour(t,i,s){this.isEnabled&&this.mutate(t,i,s)}mutate(t,i,s){}energize(t,i){if(this.dead)return;if(this.age+=i,this.age>=this.life){this.energy=0,this.dead=!0;return}const s=this.easing(t.age/t.life);this.energy=Math.max(1-s,0)}destroy(){}fromJSON(t){}};class le extends R{constructor(t=1,i=null,s,n,r=!0){super(s,n,oi,r),this.alphaA=t,this.alphaB=i,this.reset(t,i)}get same(){return this._same}set same(t){this._same=t}reset(t=1,i=null,s,n){this.same=i==null,this.alphaA=P(t),this.alphaB=P(i),s&&super.reset(s,n)}initialize(t){t.useAlpha=!0,t.transform.alphaA=this.alphaA.getValue(),t.transform.alphaB=this.same?t.transform.alphaA:this.alphaB.getValue()}mutate(t,i,s){this.energize(t,i,s),t.alpha=w.lerp(t.transform.alphaA,t.transform.alphaB,this.energy),t.alpha<Uo&&(t.alpha=0)}static fromJSON(t){const{alphaA:i,alphaB:s,life:n,easing:r,isEnabled:o=!0}=t;return new le(i,s,n,I(r),o)}}class St extends R{constructor(t=new x,i=ei,s=ti,n=Kt,r=yt,o=!0){super(n,r,ai,o),this.targetPosition=t,this.radius=s,this.force=this.normalizeValue(i),this.radiusSq=this.radius*this.radius,this.attractionForce=new x,this.lengthSq=0}reset(t=new x,i=ei,s=ti,n,r){this.targetPosition=t,this.radius=s,this.force=this.normalizeValue(i),this.radiusSq=this.radius*this.radius,this.attractionForce=new x,this.lengthSq=0,n&&super.reset(n,r)}mutate(t,i,s){this.energize(t,i,s),this.attractionForce.copy(this.targetPosition),this.attractionForce.sub(t.position),this.lengthSq=this.attractionForce.lengthSq(),this.lengthSq>Fo&&this.lengthSq<this.radiusSq&&(this.attractionForce.normalize(),this.attractionForce.scalar(1-this.lengthSq/this.radiusSq),this.attractionForce.scalar(this.force),t.acceleration.add(this.attractionForce))}static fromJSON(t){const{x:i,y:s,z:n,force:r,radius:o,life:a,easing:h,isEnabled:u=!0}=t;return new St(new x(i,s,n),r,o,a,I(h),u)}}class $o extends R{constructor(t,i,s,n,r,o=!0){super(n,r,ss,o),this.reset(t,i,s)}reset(t,i,s,n,r){this.emitter=t,this.useMass=i,this.onCollide=s,this.particles=[],this.delta=new x,n&&super.reset(n,r)}mutate(t,i,s){const n=this.emitter?this.emitter.particles.slice(s):this.particles.slice(s);let r,o,a,h,u,c,f=n.length;for(;f--;)r=n[f],r!=t&&(this.delta.copy(r.position).sub(t.position),o=this.delta.lengthSq(),h=t.radius+r.radius,o<=h*h&&(a=h-Math.sqrt(o),a+=.5,u=this._getAverageMass(t,r),c=this._getAverageMass(r,t),t.position.add(this.delta.clone().normalize().scalar(a*-u)),r.position.add(this.delta.normalize().scalar(a*c)),this.onCollide&&this.onCollide(t,r)))}_getAverageMass(t,i){return this.useMass?i.mass/(t.mass+i.mass):.5}fromJSON(t){}}class It extends R{constructor(t,i,s,n,r=!0){super(s,n,hi,r),this.reset(t,i)}get same(){return this._same}set same(t){this._same=t}reset(t,i,s,n){this.same=i==null,this.colorA=ke(t),this.colorB=ke(i),s&&super.reset(s,n)}initialize(t){t.transform.colorA=Se.getRGB(this.colorA.getValue()),t.useColor=!0,t.transform.colorB=this.same?t.transform.colorA:Se.getRGB(this.colorB.getValue())}mutate(t,i,s){this.energize(t,i,s),this._same?(t.color.r=t.transform.colorA.r,t.color.g=t.transform.colorA.g,t.color.b=t.transform.colorA.b):(t.color.r=w.lerp(t.transform.colorA.r,t.transform.colorB.r,this.energy),t.color.g=w.lerp(t.transform.colorA.g,t.transform.colorB.g,this.energy),t.color.b=w.lerp(t.transform.colorA.b,t.transform.colorB.b,this.energy))}static fromJSON(t){const{colorA:i,colorB:s,life:n,easing:r,isEnabled:o=!0}=t;return new It(i,s,n,I(r),o)}}class Rt extends R{constructor(t,i,s,n,r){super(s,n,ui,r),this.reset(t,i)}reset(t,i=Yo,s,n){this.zone=t,this.zone.crossType=i,s&&super.reset(s,n)}mutate(t,i,s){this.energize(t,i,s),this.zone.crossing.call(this.zone,t)}static fromJSON(t){const{zoneType:i,zoneParams:s,crossType:n,life:r,easing:o,isEnabled:a=!0}=t,h=new Hi[i](...Object.values(s));return new Rt(h,n,r,I(o),a)}}class Ct extends R{constructor(t,i,s,n,r,o=!0){super(n,r,ci,o),this.reset(t,i,s)}reset(t,i,s){this.force=this.normalizeForce(new x(t,i,s)),this.force.id=Math.random()}mutate(t,i,s){this.energize(t,i,s),t.acceleration.add(this.force)}static fromJSON(t){const{fx:i,fy:s,fz:n,life:r,easing:o,isEnabled:a=!0}=t;return new Ct(i,s,n,r,I(o),a)}}class Dt extends Ct{constructor(t,i,s,n=!0){super(0,-t,0,i,s,n),this.type=li}static fromJSON(t){const{gravity:i,life:s,easing:n,isEnabled:r=!0}=t;return new Dt(i,s,I(n),r)}}class fe extends R{constructor(t,i,s,n=ii,r,o,a=!0){super(r,o,fi,a),this.reset(t,i,s,n),this.time=0}reset(t,i,s,n=ii,r,o){this.randomForce=this.normalizeForce(new x(t,i,s)),this.delayPan=P(n),this.time=0,r&&super.reset(r,o)}mutate(t,i,s){if(this.energize(t,i,s),this.time+=i,this.time>=this.delayPan.getValue()){const n=w.randomAToB(-this.randomForce.x,this.randomForce.x),r=w.randomAToB(-this.randomForce.y,this.randomForce.y),o=w.randomAToB(-this.randomForce.z,this.randomForce.z);t.acceleration.addValue(n,r,o),this.time=0}}static fromJSON(t){const{x:i,y:s,z:n,delay:r,life:o,easing:a,isEnabled:h=!0}=t;return new fe(i,s,n,r,o,I(a),h)}}class de extends St{constructor(t,i,s,n,r,o=!0){super(t,i,s,n,r,o),this.force*=-1,this.type=di}reset(t,i,s,n,r){super.reset(t,i,s,n,r),this.force*=-1}static fromJSON(t){const{x:i,y:s,z:n,force:r,radius:o,life:a,easing:h,isEnabled:u=!0}=t;return new de(new x(i,s,n),r,o,a,I(h),u)}}class jt extends R{constructor(t,i,s,n,r,o=!0){super(n,r,yi,o),this.reset(t,i,s)}get rotationType(){return this._rotationType}set rotationType(t){this._rotationType=t}reset(t,i,s,n,r){this.x=t||0,this.y=i||0,this.z=s||0,t===void 0||t=="same"?this.rotationType="same":i==null?this.rotationType="set":s===void 0?this.rotationType="to":(this.rotationType="add",this.x=P(this.x*F),this.y=P(this.y*F),this.z=P(this.z*F)),n&&super.reset(n,r)}initialize(t){switch(this.rotationType){case"same":break;case"set":this._setRotation(t.rotation,this.x);break;case"to":t.transform.fR=t.transform.fR||new x,t.transform.tR=t.transform.tR||new x,this._setRotation(t.transform.fR,this.x),this._setRotation(t.transform.tR,this.y);break;case"add":t.transform.addR=new x(this.x.getValue(),this.y.getValue(),this.z.getValue());break}}_setRotation(t,i){if(t=t||new x,i=="random"){var s=w.randomAToB(-O,O),n=w.randomAToB(-O,O),r=w.randomAToB(-O,O);t.set(s,n,r)}else i instanceof x&&t.copy(i)}mutate(t,i,s){switch(this.energize(t,i,s),this.rotationType){case"same":t.rotation||(t.rotation=new x),t.rotation.eulerFromDir(t.velocity);break;case"set":break;case"to":t.rotation.x=w.lerp(t.transform.fR.x,t.transform.tR.x,this.energy),t.rotation.y=w.lerp(t.transform.fR.y,t.transform.tR.y,this.energy),t.rotation.z=w.lerp(t.transform.fR.z,t.transform.tR.z,this.energy);break;case"add":t.rotation.add(t.transform.addR);break}}static fromJSON(t){const{x:i,y:s,z:n,life:r,easing:o,isEnabled:a=!0}=t;return new jt(i,s,n,r,I(o),a)}}class Lt extends R{constructor(t,i,s,n,r=!0){super(s,n,mi,r),this.reset(t,i)}get same(){return this._same}set same(t){this._same=t}reset(t,i,s,n){this.same=i==null,this.scaleA=P(t||1),this.scaleB=P(i),s&&super.reset(s,n)}initialize(t){t.transform.scaleA=this.scaleA.getValue(),t.transform.oldRadius=t.radius,t.transform.scaleB=this.same?t.transform.scaleA:this.scaleB.getValue()}mutate(t,i,s){this.energize(t,i,s),t.scale=w.lerp(t.transform.scaleA,t.transform.scaleB,this.energy),t.scale<5e-4&&(t.scale=0),t.radius=t.transform.oldRadius*t.scale}static fromJSON(t){const{scaleA:i,scaleB:s,life:n,easing:r,isEnabled:o=!0}=t;return new Lt(i,s,n,I(r),o)}}class ye extends R{constructor(t,i,s,n,r,o,a,h=!0){super(o,a,pi,h),this.reset(t,i,s,n,r)}reset(t,i,s,n,r){this.pos?this.pos.set(t,i,s):this.pos=new x(t,i,s),this.spring=n||.1,this.friction=r||.98}mutate(t,i,s){this.energize(t,i,s),t.velocity.x+=(this.pos.x-t.position.x)*this.spring,t.velocity.y+=(this.pos.y-t.position.y)*this.spring,t.velocity.z+=(this.pos.z-t.position.z)*this.spring}static fromJSON(t){const{x:i,y:s,z:n,spring:r,friction:o,life:a,easing:h,isEnabled:u=!0}=t;return new ye(i,s,n,r,o,a,I(h),u)}}const Gi=Object.freeze(Object.defineProperty({__proto__:null,Alpha:le,Attraction:St,Behaviour:R,Collision:$o,Color:It,CrossZone:Rt,Force:Ct,Gravity:Dt,RandomDrift:fe,Repulsion:de,Rotate:jt,Scale:Lt,Spring:ye},Symbol.toStringTag,{value:"Module"})),Zo=e=>U.fromJSON(e),ko=(e,t)=>{const i=[];return e.forEach(s=>{const{type:n,properties:r}=s;if(!$t.includes(n))throw new Error(`The initializer type ${n} is invalid or not yet supported`);wi.includes(n)?i.push(xt[n].fromJSON(r,t)):i.push(xt[n].fromJSON(r))}),i},si=e=>{const t=[];return e.forEach(i=>{const{type:s,properties:n}=i;if(!Ci.includes(s))throw new Error(`The behaviour type ${s} is invalid or not yet supported`);t.push(Gi[s].fromJSON(n))}),t},qo=(e,t,i,s)=>{const{preParticles:n=ee,integrationType:r=Ii,emitters:o=[]}=e,a=new i(t,n,r);return o.forEach(h=>{const u=new s,{rate:c,rotation:f,initializers:l,behaviours:d,emitterBehaviours:p=[],position:m,totalEmitTimes:y=1/0,life:g=1/0}=h;u.setRate(Zo(c)).setRotation(f).setInitializers(ko(l,t)).setBehaviours(si(d)).setEmitterBehaviours(si(p)).setPosition(m).emit(y,g),a.addEmitter(u)}),a};function ni(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),i.push.apply(i,s)}return i}function Et(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};t%2?ni(Object(i),!0).forEach(function(s){K(e,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ni(Object(i)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(i,s))})}return e}const Ho={shouldAutoEmit:!0},Go=e=>U.fromJSON(e),Xo=(e,t)=>new Promise((i,s)=>{if(!e.length)return i([]);const n=e.length,r=[],o=e.filter(({properties:h})=>!h.texture),a=e.filter(({properties:h})=>h.texture);o.forEach(h=>{const{type:u,properties:c}=h;if(!$t.includes(u))return s(`The initializer type ${u} is invalid or not yet supported`);if(wi.includes(u)?r.push(xt[u].fromJSON(c,t)):r.push(xt[u].fromJSON(c)),r.length===n)return i(r)}),a.forEach(h=>{const{type:u,properties:c,properties:{texture:f}}=h,l=new t.TextureLoader;if(!$t.includes(u))return s(`The initializer type ${u} is invalid or not yet supported`);l.load(f,d=>{if(r.push(At.fromJSON(Et(Et({},c),{},{loadedTexture:d}),t)),r.length===n)return i(r)},void 0,s)})}),ri=e=>new Promise((t,i)=>{if(!e.length)return t([]);const s=e.length,n=[];e.forEach(r=>{const{type:o,properties:a}=r;if(!Ci.includes(o))return i(`The behaviour type ${o} is invalid or not yet supported`);if(n.push(Gi[o].fromJSON(a)),n.length===s)return t(n)})}),Qo=(e,t,i,s)=>new Promise((n,r)=>{if(!e.length)return n([]);const o=[],a=e.length;if(!a)return n(o);e.forEach(h=>{const u=new t,{rate:c,rotation:f,initializers:l,behaviours:d,emitterBehaviours:p=[],position:m,totalEmitTimes:y=1/0,life:g=1/0}=h;u.setRate(Go(c)).setRotation(f).setPosition(m),Xo(l,i).then(_=>(u.setInitializers(_),ri(d))).then(_=>(u.setBehaviours(_),ri(p))).then(_=>(u.setEmitterBehaviours(_),Promise.resolve(u))).then(_=>{if(o.push(s?_.emit(y,g):_.setTotalEmitTimes(y).setLife(g)),o.length===a)return n(o)}).catch(r)})}),Ko=(e,t,i,s,n={})=>new Promise((r,o)=>{const{preParticles:a=ee,integrationType:h=Ii,emitters:u=[]}=e,c=new i(a,h),{shouldAutoEmit:f}=Et(Et({},Ho),n);Qo(u,s,t,f).then(l=>{const d=l.length;if(!d)return r(c);l.forEach(p=>{c.addEmitter(p),c.emitters.length===d&&r(c)})}).catch(o)});class Q{constructor(t=ee,i=gt){this.type=go,this.canUpdate=!0,this.preParticles=t,this.integrationType=i,this.emitters=[],this.renderers=[],this.pool=new kt,this.eventDispatcher=new ki}static fromJSON(t,i){return qo(t,i,Q,Qt)}static fromJSONAsync(t,i,s){return Ko(t,i,Q,Qt,s)}dispatch(t,i=this){this.eventDispatcher.dispatchEvent(t,i)}addRenderer(t){return this.renderers.push(t),t.init(this),this}removeRenderer(t){return this.renderers.splice(this.renderers.indexOf(t),1),t.remove(this),this}addEmitter(t){const i=this.emitters.length;return t.parent=this,t.index=i,this.emitters.push(t),this.dispatch(vo,t),this}removeEmitter(t){return t.parent!==this?this:(t.parent=null,t.index=void 0,this.emitters.splice(this.emitters.indexOf(t),1),this.dispatch(xo,t),this)}emit({onStart:t,onUpdate:i,onEnd:s}){t&&t(),i&&this.eventDispatcher.addEventListener(qt,i);const n=this.emitters.map(r=>{const{life:o}=r;return o===1/0?(s&&s(),r.experimental_emit(),Promise.resolve()):new Promise(a=>{r.addOnEmitterDeadEventListener(()=>{s&&s(),a()}),r.experimental_emit()})});try{return Promise.all(n)}catch(r){console.warn(r)}}update(t=Yt){const i=t||Yt;if(this.canUpdate){if(i>0){let s=this.emitters.length;for(;s--;){const n=this.emitters[s];n.update(i),n.isEmitting&&this.dispatch(qt)}}this.dispatch(Eo)}return Promise.resolve()}getCount(){const t=this.emitters.length;let i=0,s;for(s=0;s<t;s++)i+=this.emitters[s].particles.length;return i}destroy(){const t=this.emitters.length;this.canUpdate=!1;for(let i=0;i<t;i++)this.emitters[i]&&this.emitters[i].destroy(),delete this.emitters[i];for(let i=0;i<t;i++)this.renderers[i]&&this.renderers[i].destroy&&(this.renderers[i].destroy(),delete this.renderers[i]);this.emitters.length=0,this.pool.destroy(),this.canUpdate=!0}}class Jo{constructor(t=hs){this.type=t}init(t){var i=this;this.system=t,this.system.eventDispatcher.addEventListener(qt,function(s){i.onSystemUpdate.call(i,s)}),this.system.eventDispatcher.addEventListener(Ht,function(s){i.onParticleCreated.call(i,s)}),this.system.eventDispatcher.addEventListener(Gt,function(s){i.onParticleUpdate.call(i,s)}),this.system.eventDispatcher.addEventListener(Xt,function(s){i.onParticleDead.call(i,s)}),this.logRendererType()}remove(){this.system=null}onParticleCreated(t){}onParticleUpdate(t){}onParticleDead(t){}onSystemUpdate(t){}logRendererType(){ls&&console.log(`${this.type}`)}}class Wo extends Jo{constructor(){super(us),this.targetPool=new kt,this.materialPool=new kt}onSystemUpdate(){}onParticleCreated(t){}onParticleUpdate(t){}onParticleDead(t){}}window.a=Q;const ta=()=>{const e=new oe(600);return e.friction=.1,e.max=7,e},Xi=new J;Xi.addZone(new oe(500,1100,500));const ea=e=>{const t=new Qt;return t.setRate(new U(new C(1,50),new C(.2,.5))).addInitializers([new wt(1),new Mt(1),Xi,new bt(5,10),new Ot(400,new x(0,-1,0),0)]).addBehaviours([new jt("random","random"),new Lt(1,1),new Dt(6),new Rt(e,"bound"),new It(16711680,"random",1/0,H.easeOutQuart)]).setPosition({x:0,y:0}).emit(),t};function Oa(){const e=me.useRef(null);return me.useEffect(()=>{const t=e.current;if(t){let i=function(m,y){requestAnimationFrame(()=>i(m,y)),m.update(),y.renderer.render(y.scene,y.camera)};const s=new es(t);s.init(),s.update(),s.updateSize(),s.addOrbitControls();const{scene:n,camera:r,renderer:o}=s;r.position.set(500,100,500);const a=new Ki(4210752,10);s.createModel(a),r.lookAt(0,0,0);const h=new Q,u=new Wo,c=new Ji(new Wi(1,1,1),new ts),f=ta(),l=ea(f);u.onParticleCreated=function(m){m.target=this.targetPool.get(c),m.target.position.copy(m.position),n.add(m.target)},u.onParticleUpdate=function(m){const y=m.scale*1;m.target.position.copy(m.position),m.target.rotation.set(m.rotation.x,m.rotation.y,m.rotation.z),m.target.scale.set(y,y,y)},u.onParticleDead=function(m){this.targetPool.expire(m.target),n.remove(m.target),m.target=null};const d=s,p=h.addEmitter(l).addRenderer(u);i(p,d)}},[]),Vt.jsx(Vt.Fragment,{children:Vt.jsx("canvas",{style:{display:"block",width:"100vw",height:"100vh"},ref:e})})}export{Oa as default};
